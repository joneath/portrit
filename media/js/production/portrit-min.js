jQuery.easing.jswing=jQuery.easing.swing;
jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){if((b/=e/2)<1)return d/2*b*b+c;return-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){if((b/=e/2)<1)return d/
2*b*b*b+c;return d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){if((b/=e/2)<1)return d/2*b*b*b*b+c;return-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){if((b/=e/2)<1)return d/2*b*b*b*b*b+c;return d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,
b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){if(b==0)return c;if(b==e)return c+d;if((b/=e/2)<1)return d/2*Math.pow(2,10*(b-1))+c;return d/2*(-Math.pow(2,-10*--b)+2)+c},
easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){if((b/=e/2)<1)return-d/2*(Math.sqrt(1-b*b)-1)+c;return d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){a=1.70158;var f=0,g=d;if(b==0)return c;if((b/=e)==1)return c+d;f||(f=e*0.3);if(g<Math.abs(d)){g=d;a=f/4}else a=f/(2*Math.PI)*Math.asin(d/g);return-(g*Math.pow(2,10*(b-=1))*Math.sin((b*e-a)*2*Math.PI/f))+c},easeOutElastic:function(a,
b,c,d,e){a=1.70158;var f=0,g=d;if(b==0)return c;if((b/=e)==1)return c+d;f||(f=e*0.3);if(g<Math.abs(d)){g=d;a=f/4}else a=f/(2*Math.PI)*Math.asin(d/g);return g*Math.pow(2,-10*b)*Math.sin((b*e-a)*2*Math.PI/f)+d+c},easeInOutElastic:function(a,b,c,d,e){a=1.70158;var f=0,g=d;if(b==0)return c;if((b/=e/2)==2)return c+d;f||(f=e*0.3*1.5);if(g<Math.abs(d)){g=d;a=f/4}else a=f/(2*Math.PI)*Math.asin(d/g);if(b<1)return-0.5*g*Math.pow(2,10*(b-=1))*Math.sin((b*e-a)*2*Math.PI/f)+c;return g*Math.pow(2,-10*(b-=1))*Math.sin((b*
e-a)*2*Math.PI/f)*0.5+d+c},easeInBack:function(a,b,c,d,e,f){if(f==undefined)f=1.70158;return d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){if(f==undefined)f=1.70158;return d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){if(f==undefined)f=1.70158;if((b/=e/2)<1)return d/2*b*b*(((f*=1.525)+1)*b-f)+c;return d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(a,b,c,d,e){return d-jQuery.easing.easeOutBounce(a,e-b,0,d,e)+c},easeOutBounce:function(a,b,c,d,e){return(b/=
e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+0.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+0.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+0.984375)+c},easeInOutBounce:function(a,b,c,d,e){if(b<e/2)return jQuery.easing.easeInBounce(a,b*2,0,d,e)*0.5+c;return jQuery.easing.easeOutBounce(a,b*2-e,0,d,e)*0.5+d*0.5+c}});
(function(a){function b(e,f,g){f="("+g.replace(d,"\\$1")+")";return e.replace(RegExp(f,"gi"),"<strong>$1</strong>")}function c(e,f){this.el=a(e);this.el.attr("autocomplete","off");this.suggestions=[];this.data=[];this.badQueries=[];this.selectedIndex=-1;this.currentValue=this.el.val();this.intervalId=0;this.cachedResponse=[];this.onChangeInterval=null;this.ignoreValueChange=false;this.serviceUrl=f.serviceUrl;this.isLocal=false;this.options={autoSubmit:false,minChars:1,maxHeight:300,deferRequestBy:0,
width:0,highlight:true,params:{},fnFormatResult:b,delimiter:null,mobile:false,zIndex:9999};this.initialize();this.setOptions(f)}var d=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");a.fn.autocomplete=function(e){return new c(this.get(0)||a("<input />"),e)};c.prototype={killerFn:null,initialize:function(){var e,f,g;e=this;f=Math.floor(Math.random()*1048576).toString(16);g="Autocomplete_"+f;this.killerFn=function(h){if(a(h.target).parents(".autocomplete").size()===0){e.killSuggestions();
e.disableKillerFn()}};if(!this.options.width)this.options.width=this.el.width();this.mainContainerId="AutocompleteContainter_"+f;a('<div id="'+this.mainContainerId+'" style="position:absolute;z-index:9999;"><div class="autocomplete-w1"><div class="autocomplete" id="'+g+'" style="display:none; width:300px;"></div></div></div>').appendTo("body");this.container=a("#"+g);this.fixPosition();window.opera?this.el.keypress(function(h){e.onKeyPress(h)}):this.el.keydown(function(h){e.onKeyPress(h)});this.el.keyup(function(h){e.onKeyUp(h)});
this.el.blur(function(){e.enableKillerFn()});this.el.focus(function(){e.fixPosition()})},setOptions:function(e){var f=this.options;a.extend(f,e);if(f.lookup){this.isLocal=true;if(a.isArray(f.lookup))f.lookup={suggestions:f.lookup,data:[]}}a("#"+this.mainContainerId).css({zIndex:f.zIndex});this.container.css({maxHeight:f.maxHeight+"px",width:f.width})},clearCache:function(){this.cachedResponse=[];this.badQueries=[]},disable:function(){this.disabled=true},enable:function(){this.disabled=false},fixPosition:function(){var e=
this.el.offset();if(mobile){f=this.el.parent().position().top+this.el.height()+60;e=e.left-10}else{var f=this.el.parent().position().top+this.el.height()+63;e=e.left-10}a("#"+this.mainContainerId).css({top:f+this.el.innerHeight()+"px",left:e+"px"})},enableKillerFn:function(){a(document).bind("click",this.killerFn)},disableKillerFn:function(){a(document).unbind("click",this.killerFn)},killSuggestions:function(){var e=this;this.stopKillSuggestions();this.intervalId=window.setInterval(function(){e.hide();
e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(e){if(!(this.disabled||!this.enabled)){switch(e.keyCode){case 27:this.el.val(this.currentValue);this.hide();break;case 9:case 13:if(this.selectedIndex===-1){this.hide();return}this.select(this.selectedIndex);if(e.keyCode===9)return;break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}e.stopImmediatePropagation();e.preventDefault()}},onKeyUp:function(e){if(!this.disabled){switch(e.keyCode){case 38:case 40:return}clearInterval(this.onChangeInterval);
if(this.currentValue!==this.el.val())if(this.options.deferRequestBy>0){var f=this;this.onChangeInterval=setInterval(function(){f.onValueChange()},this.options.deferRequestBy)}else this.onValueChange()}},onValueChange:function(){clearInterval(this.onChangeInterval);this.currentValue=this.el.val();var e=this.getQuery(this.currentValue);this.selectedIndex=-1;if(this.ignoreValueChange)this.ignoreValueChange=false;else e===""||e.length<this.options.minChars?this.hide():this.getSuggestions(e)},getQuery:function(e){var f;
f=this.options.delimiter;if(!f)return a.trim(e);e=e.split(f);return a.trim(e[e.length-1])},getSuggestionsLocal:function(e){var f,g,h,j,m;g=this.options.lookup;h=g.suggestions.length;f={suggestions:[],data:[]};e=e.toLowerCase();for(m=0;m<h;m++){j=g.suggestions[m];if(j.toLowerCase().indexOf(e)===0){f.suggestions.push(j);f.data.push(g.data[m])}}return f},getSuggestions:function(e){var f,g;if((f=this.isLocal?this.getSuggestionsLocal(e):this.cachedResponse[e])&&a.isArray(f.suggestions)){this.suggestions=
f.suggestions;this.data=f.data;this.suggest()}else if(!this.isBadQuery(e)){g=this;g.options.params.query=e;a.get(this.serviceUrl,g.options.params,function(h){g.processResponse(h)},"text")}},isBadQuery:function(e){for(var f=this.badQueries.length;f--;)if(e.indexOf(this.badQueries[f])===0)return true;return false},hide:function(){this.enabled=false;this.selectedIndex=-1;this.container.hide()},suggest:function(){if(this.suggestions.length===0)this.hide();else{var e,f,g,h,j,m,l,i;e=this;f=this.suggestions.length;
h=this.options.fnFormatResult;j=this.getQuery(this.currentValue);l=function(k){return function(){e.activate(k)}};i=function(k){return function(){e.select(k)}};this.container.hide().empty();for(m=0;m<f;m++){g=this.suggestions[m];g=a((e.selectedIndex===m?'<div class="selected"':"<div")+' title="'+g+'">'+h(g,this.data[m],j)+"</div>");g.mouseover(l(m));g.click(i(m));this.container.append(g)}this.enabled=true;this.container.show()}},processResponse:function(e){var f;try{f=eval("("+e+")")}catch(g){return}if(!a.isArray(f.data))f.data=
[];if(!this.options.noCache){this.cachedResponse[f.query]=f;f.suggestions.length===0&&this.badQueries.push(f.query)}if(f.query===this.getQuery(this.currentValue)){this.suggestions=f.suggestions;this.data=f.data;this.suggest()}},activate:function(e){var f,g;f=this.container.children();this.selectedIndex!==-1&&f.length>this.selectedIndex&&a(f.get(this.selectedIndex)).removeClass();this.selectedIndex=e;if(this.selectedIndex!==-1&&f.length>this.selectedIndex){g=f.get(this.selectedIndex);a(g).addClass("selected")}return g},
deactivate:function(e,f){e.className="";if(this.selectedIndex===f)this.selectedIndex=-1},select:function(e){var f;if(f=this.suggestions[e]){this.el.val(f);if(this.options.autoSubmit){f=this.el.parents("form");f.length>0&&f.get(0).submit()}this.ignoreValueChange=true;this.hide();this.onSelect(e)}},moveUp:function(){if(this.selectedIndex!==-1)if(this.selectedIndex===0){this.container.children().get(0).className="";this.selectedIndex=-1;this.el.val(this.currentValue)}else this.adjustScroll(this.selectedIndex-
1)},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(e){var f,g,h;f=this.activate(e).offsetTop;g=this.container.scrollTop();h=g+this.options.maxHeight-25;if(f<g)this.container.scrollTop(f);else f>h&&this.container.scrollTop(f-this.options.maxHeight+25);this.el.val(this.getValue(this.suggestions[e]))},onSelect:function(e){var f,g;f=this.options.onSelect;g=this.suggestions[e];e=this.data[e];this.el.val(this.getValue(g));
a.isFunction(f)&&f(g,e,this.el)},getValue:function(e){var f,g;f=this.options.delimiter;if(!f)return e;g=this.currentValue;f=g.split(f);if(f.length===1)return e;return g.substr(0,g.length-f[f.length-1].length)+e}}})(jQuery);
(function(){function a(i,k){var n;this.element=typeof i=="object"?i:document.getElementById(i);this.wrapper=this.element.parentNode;this.element.style.webkitTransitionProperty="-webkit-transform";this.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)";this.element.style.webkitTransitionDuration="0";this.element.style.webkitTransform=j+"0,0"+m;this.options={bounce:c,momentum:c,checkDOMChanges:true,topOnDOMChanges:false,hScrollbar:c,vScrollbar:c,fadeScrollbar:d||!e,shrinkScrollbar:d||
!e,desktopCompatibility:false,overflow:"auto",snap:false,bounceLock:false,scrollbarColor:"rgba(0,0,0,0.5)",onScrollEnd:function(){}};if(typeof k=="object")for(n in k)this.options[n]=k[n];if(this.options.desktopCompatibility)this.options.overflow="hidden";this.onScrollEnd=this.options.onScrollEnd;delete this.options.onScrollEnd;this.wrapper.style.overflow=this.options.overflow;this.refresh();window.addEventListener("onorientationchange"in window?"orientationchange":"resize",this,false);if(e||this.options.desktopCompatibility){this.element.addEventListener(f,
this,false);this.element.addEventListener(g,this,false);this.element.addEventListener(h,this,false)}this.options.checkDOMChanges&&this.element.addEventListener("DOMSubtreeModified",this,false)}function b(i,k,n,q,u){var v=document;this.dir=i;this.fade=n;this.shrink=q;this.uid=++l;this.bar=v.createElement("div");this.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+
u+";-webkit-transform:"+j+"0,0"+m+";"+(i=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px");this.wrapper=v.createElement("div");this.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+this.uid+this.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(n?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+(this.dir==
"horizontal"?"bottom:2px;left:2px;right:7px;height:5px":"top:2px;right:2px;bottom:7px;width:5px;");this.wrapper.appendChild(this.bar);k.appendChild(this.wrapper)}a.prototype={x:0,y:0,enabled:true,handleEvent:function(i){switch(i.type){case f:this.touchStart(i);break;case g:this.touchMove(i);break;case h:this.touchEnd(i);break;case "webkitTransitionEnd":this.transitionEnd();break;case "orientationchange":case "resize":this.refresh();break;case "DOMSubtreeModified":this.onDOMModified(i)}},onDOMModified:function(i){var k=
this;if(i.target.parentNode==k.element){setTimeout(function(){k.refresh()},0);if(k.options.topOnDOMChanges&&(k.x!=0||k.y!=0))k.scrollTo(0,0,"0")}},refresh:function(){var i=this.x,k=this.y;this.scrollWidth=this.wrapper.clientWidth;this.scrollHeight=this.wrapper.clientHeight;this.scrollerWidth=this.element.offsetWidth;this.scrollerHeight=this.element.offsetHeight;this.maxScrollX=this.scrollWidth-this.scrollerWidth;this.maxScrollY=this.scrollHeight-this.scrollerHeight;this.directionY=this.directionX=
0;if(this.scrollX)if(this.maxScrollX>=0)i=0;else if(this.x<this.maxScrollX)i=this.maxScrollX;if(this.scrollY)if(this.maxScrollY>=0)k=0;else if(this.y<this.maxScrollY)k=this.maxScrollY;if(this.options.snap){this.maxPageX=-Math.floor(this.maxScrollX/this.scrollWidth);this.maxPageY=-Math.floor(this.maxScrollY/this.scrollHeight);k=this.snap(i,k);i=k.x;k=k.y}if(i!=this.x||k!=this.y){this.setTransitionTime("0");this.setPosition(i,k,true)}this.scrollX=this.scrollerWidth>this.scrollWidth;this.scrollY=!this.options.bounceLock&&
!this.scrollX||this.scrollerHeight>this.scrollHeight;if(this.options.hScrollbar&&this.scrollX){this.scrollBarX=this.scrollBarX||new b("horizontal",this.wrapper,this.options.fadeScrollbar,this.options.shrinkScrollbar,this.options.scrollbarColor);this.scrollBarX.init(this.scrollWidth,this.scrollerWidth)}else if(this.scrollBarX)this.scrollBarX=this.scrollBarX.remove();if(this.options.vScrollbar&&this.scrollY&&this.scrollerHeight>this.scrollHeight){this.scrollBarY=this.scrollBarY||new b("vertical",this.wrapper,
this.options.fadeScrollbar,this.options.shrinkScrollbar,this.options.scrollbarColor);this.scrollBarY.init(this.scrollHeight,this.scrollerHeight)}else if(this.scrollBarY)this.scrollBarY=this.scrollBarY.remove()},setPosition:function(i,k,n){this.x=i;this.y=k;this.element.style.webkitTransform=j+this.x+"px,"+this.y+"px"+m;if(!n){this.scrollBarX&&this.scrollBarX.setPosition(this.x);this.scrollBarY&&this.scrollBarY.setPosition(this.y)}},setTransitionTime:function(i){i=i||"0";this.element.style.webkitTransitionDuration=
i;if(this.scrollBarX){this.scrollBarX.bar.style.webkitTransitionDuration=i;this.scrollBarX.wrapper.style.webkitTransitionDuration=c&&this.options.fadeScrollbar?"300ms":"0"}if(this.scrollBarY){this.scrollBarY.bar.style.webkitTransitionDuration=i;this.scrollBarY.wrapper.style.webkitTransitionDuration=c&&this.options.fadeScrollbar?"300ms":"0"}},touchStart:function(i){var k;if(this.enabled){i.preventDefault();i.stopPropagation();this.scrolling=true;this.moved=false;this.distY=this.distX=0;this.setTransitionTime("0");
if(this.options.momentum||this.options.snap){k=new WebKitCSSMatrix(window.getComputedStyle(this.element).webkitTransform);if(k.e!=this.x||k.f!=this.y){document.removeEventListener("webkitTransitionEnd",this,false);this.setPosition(k.e,k.f);this.moved=true}}this.touchStartX=e?i.changedTouches[0].pageX:i.pageX;this.scrollStartX=this.x;this.touchStartY=e?i.changedTouches[0].pageY:i.pageY;this.scrollStartY=this.y;this.scrollStartTime=i.timeStamp;this.directionY=this.directionX=0}},touchMove:function(i){if(this.scrolling){var k=
e?i.changedTouches[0].pageX:i.pageX,n=e?i.changedTouches[0].pageY:i.pageY,q=this.scrollX?k-this.touchStartX:0,u=this.scrollY?n-this.touchStartY:0,v=this.x+q,o=this.y+u;i.stopPropagation();this.touchStartX=k;this.touchStartY=n;if(v>=0||v<this.maxScrollX)v=this.options.bounce?Math.round(this.x+q/3):v>=0||this.maxScrollX>=0?0:this.maxScrollX;if(o>=0||o<this.maxScrollY)o=this.options.bounce?Math.round(this.y+u/3):o>=0||this.maxScrollY>=0?0:this.maxScrollY;if(this.distX+this.distY>5){if(this.distX-3>this.distY){o=
this.y;u=0}else if(this.distY-3>this.distX){v=this.x;q=0}this.setPosition(v,o);this.moved=true;this.directionX=q>0?-1:1;this.directionY=u>0?-1:1}else{this.distX+=Math.abs(q);this.distY+=Math.abs(u)}}},touchEnd:function(i){if(this.scrolling){var k=i.timeStamp-this.scrollStartTime,n=e?i.changedTouches[0]:i,q,u;q=0;u=this.x;var v=this.y;this.scrolling=false;if(this.moved)if(!this.options.snap&&k>250)this.resetPosition();else{if(this.options.momentum){i=this.scrollX===true?this.momentum(this.x-this.scrollStartX,
k,this.options.bounce?-this.x+this.scrollWidth/5:-this.x,this.options.bounce?this.x+this.scrollerWidth-this.scrollWidth+this.scrollWidth/5:this.x+this.scrollerWidth-this.scrollWidth):{dist:0,time:0};n=this.scrollY===true?this.momentum(this.y-this.scrollStartY,k,this.options.bounce?-this.y+this.scrollHeight/5:-this.y,this.options.bounce?(this.maxScrollY<0?this.y+this.scrollerHeight-this.scrollHeight:0)+this.scrollHeight/5:this.y+this.scrollerHeight-this.scrollHeight):{dist:0,time:0};q=Math.max(Math.max(i.time,
n.time),1);u=this.x+i.dist;v=this.y+n.dist}if(this.options.snap){i=this.snap(u,v);u=i.x;v=i.y;q=Math.max(i.time,q)}this.scrollTo(u,v,q+"ms")}else{this.resetPosition();if(e){for(q=n.target;q.nodeType!=1;)q=q.parentNode;u=document.createEvent("MouseEvents");u.initMouseEvent("click",true,true,i.view,1,n.screenX,n.screenY,n.clientX,n.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,0,null);u._fake=true;q.dispatchEvent(u)}}}},transitionEnd:function(){document.removeEventListener("webkitTransitionEnd",this,
false);this.resetPosition()},resetPosition:function(){var i=this.x,k=this.y;if(this.x>=0)i=0;else if(this.x<this.maxScrollX)i=this.maxScrollX;if(this.y>=0||this.maxScrollY>0)k=0;else if(this.y<this.maxScrollY)k=this.maxScrollY;if(i!=this.x||k!=this.y)this.scrollTo(i,k);else{if(this.moved){this.onScrollEnd();this.moved=false}this.scrollBarX&&this.scrollBarX.hide();this.scrollBarY&&this.scrollBarY.hide()}},snap:function(i,k){i=this.directionX>0?Math.floor(i/this.scrollWidth):this.directionX<0?Math.ceil(i/
this.scrollWidth):Math.round(i/this.scrollWidth);this.pageX=-i;i*=this.scrollWidth;if(i>0)i=this.pageX=0;else if(i<this.maxScrollX){this.pageX=this.maxPageX;i=this.maxScrollX}k=this.directionY>0?Math.floor(k/this.scrollHeight):this.directionY<0?Math.ceil(k/this.scrollHeight):Math.round(k/this.scrollHeight);this.pageY=-k;k*=this.scrollHeight;if(k>0)k=this.pageY=0;else if(k<this.maxScrollY){this.pageY=this.maxPageY;k=this.maxScrollY}return{x:i,y:k,time:Math.round(Math.max(Math.abs(this.x-i)/this.scrollWidth*
500,Math.abs(this.y-k)/this.scrollHeight*500))}},scrollTo:function(i,k,n){if(this.x==i&&this.y==k)this.resetPosition();else{this.moved=true;this.setTransitionTime(n||"350ms");this.setPosition(i,k);n==="0"||n=="0s"||n=="0ms"?this.resetPosition():document.addEventListener("webkitTransitionEnd",this,false)}},scrollToPage:function(i,k,n){if(!this.options.snap){this.pageX=-Math.round(this.x/this.scrollWidth);this.pageY=-Math.round(this.y/this.scrollHeight)}if(i=="next")i=++this.pageX;else if(i=="prev")i=
--this.pageX;if(k=="next")k=++this.pageY;else if(k=="prev")k=--this.pageY;i=-i*this.scrollWidth;k=-k*this.scrollHeight;k=this.snap(i,k);i=k.x;k=k.y;this.scrollTo(i,k,n||"500ms")},scrollToElement:function(i,k){if(i=typeof i=="object"?i:this.element.querySelector(i)){var n=this.scrollX?-i.offsetLeft:0,q=this.scrollY?-i.offsetTop:0;if(n>=0)n=0;else if(n<this.maxScrollX)n=this.maxScrollX;if(q>=0)q=0;else if(q<this.maxScrollY)q=this.maxScrollY;this.scrollTo(n,q,k)}},momentum:function(i,k,n,q){k=Math.abs(i)/
k*1E3;var u=k*k/2.5/1E3,v=0;if(i>0&&u>n){k=k*n/u/2.5;u=n}else if(i<0&&u>q){k=k*q/u/2.5;u=q}u*=i<0?-1:1;v=k/1.2;return{dist:Math.round(u),time:Math.round(v)}},destroy:function(i){window.removeEventListener("onorientationchange"in window?"orientationchange":"resize",this,false);this.element.removeEventListener(f,this,false);this.element.removeEventListener(g,this,false);this.element.removeEventListener(h,this,false);document.removeEventListener("webkitTransitionEnd",this,false);this.options.checkDOMChanges&&
this.element.removeEventListener("DOMSubtreeModified",this,false);if(this.scrollBarX)this.scrollBarX=this.scrollBarX.remove();if(this.scrollBarY)this.scrollBarY=this.scrollBarY.remove();i&&this.wrapper.parentNode.removeChild(this.wrapper);return null}};b.prototype={init:function(i,k){var n=document,q=Math.PI;if(this.dir=="horizontal"){if(this.maxSize!=this.wrapper.offsetWidth){this.maxSize=this.wrapper.offsetWidth;n=n.getCSSCanvasContext("2d","scrollbar"+this.uid+this.dir,this.maxSize,5);n.fillStyle=
"rgb(0,0,0)";n.beginPath();n.arc(2.5,2.5,2.5,q/2,-q/2,false);n.lineTo(this.maxSize-2.5,0);n.arc(this.maxSize-2.5,2.5,2.5,-q/2,q/2,false);n.closePath();n.fill()}}else if(this.maxSize!=this.wrapper.offsetHeight){this.maxSize=this.wrapper.offsetHeight;n=n.getCSSCanvasContext("2d","scrollbar"+this.uid+this.dir,5,this.maxSize);n.fillStyle="rgb(0,0,0)";n.beginPath();n.arc(2.5,2.5,2.5,q,0,false);n.lineTo(5,this.maxSize-2.5);n.arc(2.5,this.maxSize-2.5,2.5,0,q,false);n.closePath();n.fill()}this.size=Math.max(Math.round(this.maxSize*
this.maxSize/k),6);this.maxScroll=this.maxSize-this.size;this.toWrapperProp=this.maxScroll/(i-k);this.bar.style[this.dir=="horizontal"?"width":"height"]=this.size+"px"},setPosition:function(i){this.wrapper.style.opacity!="1"&&this.show();i=Math.round(this.toWrapperProp*i);if(i<0){i=this.shrink?i+i*3:0;if(this.size+i<7)i=-this.size+6}else if(i>this.maxScroll){i=this.shrink?i+(i-this.maxScroll)*3:this.maxScroll;if(this.size+this.maxScroll-i<7)i=this.size+this.maxScroll-6}i=this.dir=="horizontal"?j+
i+"px,0"+m:j+"0,"+i+"px"+m;this.bar.style.webkitTransform=i},show:function(){if(c)this.wrapper.style.webkitTransitionDelay="0";this.wrapper.style.opacity="1"},hide:function(){if(c)this.wrapper.style.webkitTransitionDelay="350ms";this.wrapper.style.opacity="0"},remove:function(){this.wrapper.parentNode.removeChild(this.wrapper);return null}};var c="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,d=/iphone|ipad/gi.test(navigator.appVersion),e="ontouchstart"in window,f=e?"touchstart":"mousedown",
g=e?"touchmove":"mousemove",h=e?"touchend":"mouseup",j="translate"+(c?"3d(":"("),m=c?",0)":")",l=0;window.iScroll=a})();
var isIphone=false,isTierIphone=false,isTierRichCss=false,isTierGenericMobile=false,engineWebKit="webkit",deviceAndroid="android",deviceIphone="iphone",deviceIpod="ipod",deviceIpad="ipad",deviceMacPpc="macintosh",deviceNuvifone="nuvifone",deviceSymbian="symbian",deviceS60="series60",deviceS70="series70",deviceS80="series80",deviceS90="series90",deviceWinMob="windows ce",deviceWindows="windows",deviceIeMob="iemobile",devicePpc="ppc",enginePie="wm5 pie",deviceBB="blackberry",vndRIM="vnd.rim",deviceBBStorm=
"blackberry95",deviceBBBold="blackberry97",deviceBBTour="blackberry96",deviceBBCurve="blackberry89",devicePalm="palm",deviceWebOS="webos",engineBlazer="blazer",engineXiino="xiino",deviceKindle="kindle",vndwap="vnd.wap",wml="wml",deviceBrew="brew",deviceDanger="danger",deviceHiptop="hiptop",devicePlaystation="playstation",deviceNintendoDs="nitro",deviceNintendo="nintendo",deviceWii="wii",deviceXbox="xbox",deviceArchos="archos",engineOpera="opera",engineNetfront="netfront",engineUpBrowser="up.browser",
engineOpenWeb="openweb",deviceMidp="midp",uplink="up.link",engineTelecaQ="teleca q",devicePda="pda",mini="mini",mobile="mobile",mobi="mobi",maemo="maemo",maemoTablet="tablet",linux="linux",qtembedded="qt embedded",mylocom2="com2",manuSonyEricsson="sonyericsson",manuericsson="ericsson",manuSamsung1="sec-sgh",manuSony="sony",manuHtc="htc",svcDocomo="docomo",svcKddi="kddi",svcVodafone="vodafone",uagent=navigator.userAgent.toLowerCase();
function DetectIphone(){return uagent.search(deviceIphone)>-1?DetectIpad()||DetectIpod()?false:true:false}function DetectIpod(){return uagent.search(deviceIpod)>-1?true:false}function DetectIpad(){return uagent.search(deviceIpad)>-1&&DetectWebkit()?true:false}function DetectIphoneOrIpod(){return uagent.search(deviceIphone)>-1||uagent.search(deviceIpod)>-1?true:false}function DetectAndroid(){return uagent.search(deviceAndroid)>-1?true:false}
function DetectAndroidWebKit(){return DetectAndroid()&&DetectWebkit()?true:false}function DetectWebkit(){return uagent.search(engineWebKit)>-1?true:false}function DetectS60OssBrowser(){return DetectWebkit()?uagent.search(deviceS60)>-1||uagent.search(deviceSymbian)>-1?true:false:false}function DetectSymbianOS(){return uagent.search(deviceSymbian)>-1||uagent.search(deviceS60)>-1||uagent.search(deviceS70)>-1||uagent.search(deviceS80)>-1||uagent.search(deviceS90)>-1?true:false}
function DetectWindowsMobile(){if(uagent.search(deviceWinMob)>-1||uagent.search(deviceIeMob)>-1||uagent.search(enginePie)>-1)return true;if(uagent.search(devicePpc)>-1&&!(uagent.search(deviceMacPpc)>-1))return true;return uagent.search(manuHtc)>-1&&uagent.search(deviceWindows)>-1?true:false}function DetectBlackBerry(){if(uagent.search(deviceBB)>-1)return true;return uagent.search(vndRIM)>-1?true:false}function DetectBlackBerryTouch(){return uagent.search(deviceBBStorm)>-1?true:false}
function DetectBlackBerryHigh(){return DetectBlackBerry()?DetectBlackBerryTouch()||uagent.search(deviceBBBold)>-1||uagent.search(deviceBBTour)>-1||uagent.search(deviceBBCurve)>-1?true:false:false}function DetectBlackBerryLow(){return DetectBlackBerry()?DetectBlackBerryHigh()?false:true:false}function DetectPalmOS(){return uagent.search(devicePalm)>-1||uagent.search(engineBlazer)>-1||uagent.search(engineXiino)>-1?DetectPalmWebOS()?false:true:false}
function DetectPalmWebOS(){return uagent.search(deviceWebOS)>-1?true:false}function DetectGarminNuvifone(){return uagent.search(deviceNuvifone)>-1?true:false}
function DetectSmartphone(){if(DetectIphoneOrIpod())return true;if(DetectS60OssBrowser())return true;if(DetectSymbianOS())return true;if(DetectWindowsMobile())return true;if(DetectAndroid())return true;if(DetectBlackBerry())return true;if(DetectPalmWebOS())return true;if(DetectPalmOS())return true;if(DetectGarminNuvifone())return true;return false}function DetectArchos(){return uagent.search(deviceArchos)>-1?true:false}function DetectBrewDevice(){return uagent.search(deviceBrew)>-1?true:false}
function DetectDangerHiptop(){return uagent.search(deviceDanger)>-1||uagent.search(deviceHiptop)>-1?true:false}function DetectMaemoTablet(){if(uagent.search(maemo)>-1)return true;return uagent.search(maemoTablet)>-1&&uagent.search(linux)?true:false}function DetectSonyMylo(){return uagent.search(manuSony)>-1?uagent.search(qtembedded)>-1||uagent.search(mylocom2)>-1?true:false:false}
function DetectOperaMobile(){return uagent.search(engineOpera)>-1?uagent.search(mini)>-1||uagent.search(mobi)>-1?true:false:false}function DetectSonyPlaystation(){return uagent.search(devicePlaystation)?true:false}function DetectNintendo(){return uagent.search(deviceNintendo)>-1||uagent.search(deviceWii)>-1||uagent.search(deviceNintendoDs)>-1?true:false}function DetectXbox(){return uagent.search(deviceXbox)?true:false}
function DetectGameConsole(){if(DetectSonyPlaystation())return true;if(DetectNintendo())return true;return DetectXbox()?true:false}function DetectKindle(){return uagent.search(deviceKindle)>-1?true:false}
function DetectMobileQuick(){if(DetectIpad())return false;if(DetectSmartphone())return true;if(uagent.search(deviceMidp)>-1||DetectBrewDevice())return true;if(DetectOperaMobile())return true;if(uagent.search(engineNetfront)>-1)return true;if(uagent.search(engineUpBrowser)>-1)return true;if(uagent.search(engineOpenWeb)>-1)return true;if(DetectDangerHiptop())return true;if(DetectMaemoTablet())return true;if(DetectArchos())return true;if(uagent.search(devicePda)>-1)return true;if(uagent.search(mobile)>
-1)return true;if(DetectKindle())return true;return false}function DetectMobileLong(){if(DetectMobileQuick())return true;if(DetectGameConsole())return true;if(DetectSonyMylo())return true;if(uagent.search(manuSamsung1)>-1||uagent.search(manuSonyEricsson)>-1||uagent.search(manuericsson)>-1)return true;if(uagent.search(svcDocomo)>-1)return true;if(uagent.search(svcKddi)>-1)return true;if(uagent.search(svcVodafone)>-1)return true;return false}
function DetectTierIphone(){if(DetectIphoneOrIpod())return true;if(DetectAndroid())return true;if(DetectAndroidWebKit())return true;if(DetectPalmWebOS())return true;if(DetectGarminNuvifone())return true;return DetectMaemoTablet()?true:false}
function DetectTierRichCss(){if(DetectMobileQuick()){if(DetectTierIphone())return false;if(DetectWebkit())return true;if(DetectS60OssBrowser())return true;if(DetectBlackBerryHigh())return true;if(DetectWindowsMobile())return true;return uagent.search(engineTelecaQ)>-1?true:false}else return false}function DetectTierOtherPhones(){if(DetectMobileLong()){if(DetectTierIphone())return false;return DetectTierRichCss()?false:true}else return false}
(function(a){var b,c;b=function(d){var e=this,f=d.is("form")?d:d.find("form").first(),g=f.find("input:file").first(),h={namespace:"file_upload",cssClass:"file_upload",dragDropSupport:true,dropZone:d,url:f.attr("action"),method:f.attr("method"),fieldName:g.attr("name"),multipart:true,multiFileRequest:false,formData:function(){return f.serializeArray()},withCredentials:false,forceIframeUpload:false},j={},m={},l={},i=/^http(s)?:\/\//,k=function(p,r){var s=0;this.complete=function(){s+=1;s===r&&p()}},
n=function(){return typeof XMLHttpRequest!=="undefined"&&typeof File!=="undefined"&&(!h.multipart||typeof FormData!=="undefined"||typeof FileReader!=="undefined")},q=function(){a.each(j,function(p,r){a(document).unbind(p,r)});a.each(m,function(p,r){h.dropZone.unbind(p,r)});a.each(l,function(p,r){g.unbind(p,r)})},u=function(p,r,s,t){if(typeof t.onProgress==="function")s.upload.onprogress=function(x){t.onProgress(x,p,r,s,t)};if(typeof t.onLoad==="function")s.onload=function(x){t.onLoad(x,p,r,s,t)};
if(typeof t.onAbort==="function")s.onabort=function(x){t.onAbort(x,p,r,s,t)};if(typeof t.onError==="function")s.onerror=function(x){t.onError(x,p,r,s,t)}},v=function(p){if(typeof p.formData==="function")return p.formData();else if(a.isArray(p.formData))return p.formData;else if(p.formData){var r=[];a.each(p.formData,function(s,t){r.push({name:s,value:t})});return r}return[]},o=function(p,r,s){var t=new FormData,x;a.each(v(s),function(y,B){t.append(B.name,B.value)});for(x=0;x<p.length;x+=1)t.append(s.fieldName,
p[x]);r.send(t)},w=function(p,r){var s=new FileReader;s.onload=function(t){p.content=t.target.result;r()};s.readAsBinaryString(p)},z=function(p,r,s){var t="";a.each(s,function(x,y){t+="--"+p+'\r\nContent-Disposition: form-data; name="'+unescape(encodeURIComponent(y.name))+'"\r\n\r\n'+unescape(encodeURIComponent(y.value))+"\r\n"});a.each(r,function(x,y){t+="--"+p+'\r\nContent-Disposition: form-data; name="'+unescape(encodeURIComponent(h.fieldName))+'"; filename="'+unescape(encodeURIComponent(y.name))+
'"\r\nContent-Type: '+y.type+"\r\n\r\n"+y.content+"\r\n"});t+="--"+p+"--\r\n";return t},C=function(p,r,s){var t="----MultiPartFormBoundary"+(new Date).getTime(),x,y;r.setRequestHeader("Content-Type","multipart/form-data; boundary="+t);x=new k(function(){r.sendAsBinary(z(t,p,v(s)))},p.length);for(y=0;y<p.length;y+=1)w(p[y],x.complete)},D=function(p,r,s,t){var x;x=t.url;if(i.test(x)){var y=location.host,B=location.protocol.length+2,F=x.indexOf(y,B);y=F+y.length;x=(F===B||F===x.indexOf("@",B)+1)&&(x.length===
y||a.inArray(x.charAt(y),["/","?","#"])!==-1)?true:false}else x=true;u(p,r,s,t);s.open(t.method,t.url,true);if(x)s.setRequestHeader("X-Requested-With","XMLHttpRequest");else if(t.withCredentials)s.withCredentials=true;if(t.multipart){p=typeof r==="number"?[p[r]]:p;if(typeof FormData!=="undefined")o(p,s,t);else typeof FileReader!=="undefined"?C(p,s,t):a.error("Browser does neither support FormData nor FileReader interface")}else{t=p[r];x&&s.setRequestHeader("X-File-Name",unescape(encodeURIComponent(t.name)));
s.setRequestHeader("Content-Type",t.type);s.send(t)}},E=function(p,r,s){var t=new XMLHttpRequest,x=a.extend({},h);typeof h.initUpload==="function"?h.initUpload(p,r,s,t,x,function(){D(r,s,t,x)}):D(r,s,t,x)},A=function(p,r){var s;if(h.multiFileRequest)E(p,r);else for(s=0;s<r.length;s+=1)E(p,r,s)},H=function(p,r){var s=v(r);f.find(":input").not(":disabled").attr("disabled",true).addClass(r.namespace+"_disabled");a.each(s,function(t,x){a('<input type="hidden"/>').attr("name",x.name).val(x.value).addClass(r.namespace+
"_form_data").insertBefore(g)});p.insertAfter(g)},I=function(p,r){p.remove();f.find("."+r.namespace+"_disabled").removeAttr("disabled").removeClass(r.namespace+"_disabled");f.find("."+r.namespace+"_form_data").remove()},G=function(p,r,s){r.unbind("abort").bind("abort",function(t){r.readyState=0;r.unbind("load").attr("src","javascript".concat(":false;"));typeof s.onAbort==="function"&&s.onAbort(t,[{name:p.val(),type:null,size:null}],0,r,s)}).unbind("load").bind("load",function(t){r.readyState=4;typeof s.onLoad===
"function"&&s.onLoad(t,[{name:p.val(),type:null,size:null}],0,r,s)});f.attr("action",s.url).attr("target",r.attr("name"));H(p,s);r.readyState=2;f.get(0).submit();I(p,s)},J=function(p,r){var s=a('<iframe src="javascript:false;" style="display:none" name="iframe_'+h.namespace+"_"+(new Date).getTime()+'"></iframe>'),t=a.extend({},h);s.readyState=0;s.abort=function(){s.trigger("abort")};s.bind("load",function(){s.unbind("load");typeof h.initUpload==="function"?h.initUpload(p,[{name:r.val(),type:null,
size:null}],0,s,t,function(){G(r,s,t)}):G(r,s,t)}).appendTo(f)};this.onDocumentDragOver=function(p){if(typeof h.onDocumentDragOver==="function"&&h.onDocumentDragOver(p)===false)return false;p.preventDefault()};this.onDocumentDrop=function(p){if(typeof h.onDocumentDrop==="function"&&h.onDocumentDrop(p)===false)return false;p.preventDefault()};this.onDragOver=function(p){if(typeof h.onDragOver==="function"&&h.onDragOver(p)===false)return false;var r=p.originalEvent.dataTransfer;if(r)r.dropEffect=r.effectAllowed=
"copy";p.preventDefault()};this.onDrop=function(p){if(typeof h.onDrop==="function"&&h.onDrop(p)===false)return false;var r=p.originalEvent.dataTransfer;r&&r.files&&n()&&A(p,r.files);p.preventDefault()};this.onChange=function(p){if(typeof h.onChange==="function"&&h.onChange(p)===false)return false;!h.forceIframeUpload&&p.target.files&&n()?A(p,p.target.files):J(p,a(p.target));p=g.clone(true);a("<form/>").append(p).get(0).reset();g.replaceWith(p);g=p};this.init=function(p){p&&a.extend(h,p);if(d.data(h.namespace))a.error('FileUpload with namespace "'+
h.namespace+'" already assigned to this element');else{d.data(h.namespace,e).addClass(h.cssClass);h.dropZone.addClass(h.cssClass);if(h.dragDropSupport){if(typeof h.onDocumentDragEnter==="function")j["dragenter."+h.namespace]=h.onDocumentDragEnter;if(typeof h.onDocumentDragLeave==="function")j["dragleave."+h.namespace]=h.onDocumentDragLeave;j["dragover."+h.namespace]=e.onDocumentDragOver;j["drop."+h.namespace]=e.onDocumentDrop;a(document).bind(j);if(typeof h.onDragEnter==="function")m["dragenter."+
h.namespace]=h.onDragEnter;if(typeof h.onDragLeave==="function")m["dragleave."+h.namespace]=h.onDragLeave;m["dragover."+h.namespace]=e.onDragOver;m["drop."+h.namespace]=e.onDrop;h.dropZone.bind(m)}l["change."+h.namespace]=e.onChange;g.bind(l)}};this.destroy=function(){q();d.removeData(h.namespace).removeClass(h.cssClass);h.dropZone.removeClass(h.cssClass)}};c={init:function(d){return this.each(function(){(new b(a(this))).init(d)})},destroy:function(d){return this.each(function(){d=d?d:"file_upload";
var e=a(this).data(d);e?e.destroy():a.error('No FileUpload with namespace "'+d+'" assigned to this element')})}};a.fn.fileUpload=function(d){if(c[d])return c[d].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof d==="object"||!d)return c.init.apply(this,arguments);else a.error("Method "+d+" does not exist on jQuery.fileUpload")}})(jQuery);
$(document).ready(function(){$("#back").click(function(){window.location.hash!=="#"&&window.location.hash!==""&&window.location.hash!=="#/"&&window.location.hash!=null&&window.history.back()});$("#home, #logo_link").click(function(){display_type=selected_photo=selected_album_id=selected_user="";if(view_active=="main"&&default_view!="wall")mobile?$("#wall_view").trigger("touchend"):$("#wall_view").click();else{default_view="wall";update_urls()}});$("#settings").click(function(){window.location.hash=
"/settings";typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Settings","Shown",""])});$("#give_feedback a").live("click",show_feedback);$("#feedback_cont").click(function(){return false});$("#submit_feedback").click(function(){var a=$("#feedback_message").val();a!=""?$.post("/submit_feedback/",{message:a},function(){$("#feedback_message").val("");$("#feedback_cont_wrap").hide();$("#feedback_reponse").show()}):$("#error_text").text("We need at least a few letters to know how you feel.")});$(document).bind("keyup",
function(a){a=a.keyCode;if(a!==13)if(a===39)if(view_active=="album"){init_profile_view();transition_to_profile()}else if(view_active=="info")transition_to_album();else if(view_active==="gallery")$("#forward_gallery, #forward_gallery_mobile").click();else{if(view_active=="nom_detail")comment_form_shown||$(".next_photo").click()}else if(a===37)if(view_active=="gallery")$("#back_gallery, #back_gallery_mobile").click();else{if(view_active=="nom_detail")comment_form_shown||$(".prev_photo").click()}else if(a===
27)hide_search_view();else{search_string=String.fromCharCode(a).toUpperCase();search_active===false&&a<=90&&a>=48&&comment_form_shown===false&&fb_session!==null&&show_search_view()}});$("#search_cont").click(function(a){a.stopPropagation()});$("#search_control").click(function(a){a.stopPropagation();$("#close_search").removeClass().addClass("close_img "+close_size);show_search_view()});$("#close_search").click(function(){hide_search_view()});$("#logout").bind("click",function(){FB.logout(function(){if(window.sessionStorage!==
undefined){sessionStorage.clear();sessionStorage.clear()}window.location.href="/"});$("#cont").fadeOut("fast",function(){$(this).html("");$("#cont").fadeIn("fast").append('<div id="logout_cont"><div id="loader"><img src="http://portrit.s3.amazonaws.com/img/album-loader-dark.gif"/></div><h1>Logging out. Hold on to your butts!</h1></div>')})})});var window_href=window.location.href;if(window_href.indexOf("?ref=nf")>0)window.location.href=window_href.replace("?ref=nf","");
function render_login_cont(){$("#login_cont").append('<div id="login_header"><img id="login_logo" src="http://portrit.s3.amazonaws.com/img/logo_blank.png"/></div><div id="login_content"><div id="login_top_cont"><div id="tagline_top"><h2>What\'s Portrit?</h2><p id="tagline_main">Award the best photos. It\'s up to you and your Facebook friends to find who\'s got the best pics.</p><p id="tagline_end">Let\'s make photos more social.</p><div class="clear"></div></div><div id="login_right_cont"><img id="login" src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_large_long.gif"/><p style="text-align:center;">To start, simply click the Connect with Facebook button above.</p></div><div class="clear"></div></div><div id="login_bottom_cont"><div id="point_1" class="login_points"><div class="point_header"><h2 id="point_1_text">1</h2><h3>Nominate</h3></div><div class="clear"></div><div class="login_points_cont"><img src="http://portrit.s3.amazonaws.com/img/landing/nominate.png"/><div class="login_points_bottom"><h4>Nominate your friend\'s rockin\' pics.</h4><p>Be nice and courteous or evil and sick, it\'s up to you.</p></div></div></div><div id="point_2" class="login_points"><div class="point_header"><h2 id="point_2_text">2</h2><h3>Vote</h3></div><div class="clear"></div><div class="login_points_cont"><img src="http://portrit.s3.amazonaws.com/img/landing/vote.png"/><div class="login_points_bottom"><h4>Give your vote to the best.</h4><p>The power is in your hands. Use it wisely.</p></div></div></div><div id="point_3" class="login_points"><div class="point_header"><h2 id="point_3_text">3</h2><h3>Earn</h3></div><div class="clear"></div><div class="login_points_cont"><img src="http://portrit.s3.amazonaws.com/img/landing/earn.png"/><div class="login_points_bottom"><h4>Earn trophies for your amazing photos.</h4><p>No longer search through thousands of your friend\'s photos to find the best.</p></div></div></div><div class="clear"></div></div><div id="login_screenshot_cont"><div id="login_screenshot_left_cont"><h2>Take the tour</h2><img src="http://portrit.s3.amazonaws.com/img/landing/spacebear.png"/><p>Find out what Portrit is all about before you join.</p></div><div id="login_screenshot_right_cont"><div id="screenshot_cont"><div id="left_large_wrap"><div id="left_large"></div></div><div id="right_large_wrap"><div id="right_large"></div></div><div id="screenshots"><div class="screenshot active" value="1"><img src="http://portrit.s3.amazonaws.com/img/landing/1.jpg"/></div><div class="screenshot" value="2"><img src="http://portrit.s3.amazonaws.com/img/landing/2.jpg"/></div><div class="screenshot" value="3"><img src="http://portrit.s3.amazonaws.com/img/landing/3.jpg"/></div><div class="screenshot" value="4"><img src="http://portrit.s3.amazonaws.com/img/landing/4.jpg"/></div><div class="screenshot" value="5"><img src="http://portrit.s3.amazonaws.com/img/landing/5.jpg"/></div></div><div id="screenshot_position_controls"><div class="screenshot_control active" value="1"></div><div class="screenshot_control" value="2"></div><div class="screenshot_control" value="3"></div><div class="screenshot_control" value="4"></div><div class="screenshot_control" value="5"></div></div></div></div><div class="clear"></div></div><div class="clear"></div></div>');$("#right_large_wrap").bind("click",
function(){var a=$("#screenshots .active"),b=parseInt($(a).attr("value")),c=null;b=c=b==5?1:b+1;c=$(".screenshot[value="+c+"]");$(c).css("left",500).show().animate({left:"0"},{duration:300,queue:false,complete:function(){$(this).addClass("active")}});$(a).animate({left:"-500px"},{duration:300,queue:false,complete:function(){$(this).hide().removeClass("active").css("left",0);$("#screenshot_position_controls .active").removeClass("active");$(".screenshot_control[value="+b+"]").addClass("active")}})});
$("#left_large_wrap").bind("click",function(){var a=$("#screenshots .active"),b=parseInt($(a).attr("value")),c=null;b=c=b==1?5:b-1;c=$(".screenshot[value="+c+"]");$(c).css("left",-500).show().animate({left:"0"},{duration:300,queue:false,complete:function(){$(this).addClass("active")}});$(a).animate({left:"500px"},{duration:300,queue:false,complete:function(){$(this).hide().removeClass("active").css("left",0);$("#screenshot_position_controls .active").removeClass("active");$(".screenshot_control[value="+
b+"]").addClass("active")}})});$(".screenshot_control").bind("click",function(){var a=parseInt($(this).attr("value")),b=$("#screenshots .active"),c=parseInt($(b).attr("value")),d=null;if(a!=c){d=a;var e=0,f=0;if(a>c){e=500;f=-500}else{e=-500;f=500}c=d;d=$(".screenshot[value="+d+"]");$(d).css("left",e).show().animate({left:"0"},{duration:300,queue:false,complete:function(){$(this).addClass("active")}});$(b).animate({left:f},{duration:300,queue:false,complete:function(){$(this).hide().removeClass("active").css("left",
0);$("#screenshot_position_controls .active").removeClass("active");$(".screenshot_control[value="+c+"]").addClass("active")}})}});$("#login").bind("click",function(){if(window.sessionStorage!==undefined)try{sessionStorage.removeItem("me");sessionStorage.removeItem("friends")}catch(a){}FB.login(handleSessionResponse,{perms:"read_stream,publish_stream,user_photos,user_videos,friends_photos,friends_videos,friends_status,user_photo_video_tags,friends_photo_video_tags"})})}
var watch_hashtag_interval=null;
function handleSessionResponse(a){clearTimeout(fb_server_timeout);clearInterval(watch_hashtag_interval);$("#content_loading").remove();if(window.location.hash=="")window.location.hash="#/";if(a.session){$("#login").unbind("click");$("#login_cont").remove();global_hash_tag=window.location.hash;$("#header").show();$(".footer_hover").unbind("click");fb_session=a.session;$("#login_cont").remove();$("#wrapper").css({background:"none"});$("#login_loader").show();watch_hashtag_interval=setInterval(watch_hashtag,
75);login_fb_user()}else{view_active="login";render_login_cont();mobile&&$("div#login_header").css({"padding-bottom":"0px"});$(".footer_hover").bind("click",function(){setTimeout(function(){update_view()},75)});$("#header").hide();attach_login_handlers()}}
function attach_login_handlers(){var a=1,b=null,c=null,d=null,e=null,f=955;$("#landing_back").bind("click",function(){b=$(".tagline_top:visible");d=$(".slideshow .active");if(a==1){a=5;c=$(".tagline_top:last");e=$(".slideshow li:last")}else{a-=1;c=$(b).prev();e=$(d).prev()}if(!mobile||tablet)$(e).animate({left:"500px"},250,function(){$(d).removeClass("active");$(this).addClass("active").css("z-index",parseInt($(d).css("z-index"))+1);$(this).animate({left:"41px"},250)});else{$(e).css({"-moz-transform":"translate(0px, 400px)",
"-webkit-transform":"translate(0px, 400px)"});$(d).removeClass("active");setTimeout(function(){$(e).addClass("active").css("z-index",parseInt($(d).css("z-index"))+1);$(e).css({"-moz-transform":"translate(0px, 0px)","-webkit-transform":"translate(0px, 0px)"})},250)}$(b).fadeOut(250,function(){$(c).fadeIn(250)})});$("#landing_forward").bind("click",function(){b=$(".tagline_top:visible");d=$(".slideshow .active");if(a==5){a=1;c=$(".tagline_top:first");e=$(".slideshow li:first")}else{a+=1;c=$(b).next();
e=$(d).next()}if(!mobile||tablet)$(d).animate({left:"500px"},250,function(){$(d).removeClass("active");$(e).addClass("active");$(d).css("z-index",f);$(this).animate({left:"41px"},250)});else{$(d).css({"-moz-transform":"translate(0px, 400px)","-webkit-transform":"translate(0px, 400px)"});$(d).removeClass("active");setTimeout(function(){$(e).addClass("active");$(d).css("z-index",f);$(d).css({"-moz-transform":"translate(0px, 0px)","-webkit-transform":"translate(0px, 0px)"})},250)}f-=1;$(b).fadeOut(250,
function(){$(c).fadeIn(250)})})}Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,c)};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a,b){if(b==null)b=0;else if(b<0)b=Math.max(0,this.length+b);var c=0,d=0;c=b;for(d=this.length;c<d;c++)if(this[c]===a)return c;return-1};
Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,c)};jQuery.jQueryRandom=0;jQuery.extend(jQuery.expr[":"],{random:function(a,b,c,d){if(b==0)jQuery.jQueryRandom=Math.floor(Math.random()*d.length);return b==jQuery.jQueryRandom}});var is_array=function(a){return a&&typeof a==="object"&&typeof a.length==="number"&&typeof a.splice==="function"&&!a.propertyIsEnumerable("length")};
function getUrlVars(){for(var a={},b=window.location.hash.split("/"),c=null,d=0;d<b.length;d++){c=b[d].split("=");if(c.length>0)for(var e=0;e<c.length;e++)a[c[0]]=c[1]==undefined?"":c[1];else a[b[d]]=""}return a}function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}
function getScrollXY(){var a=0,b=0;if(typeof window.pageYOffset=="number"){b=window.pageYOffset;a=window.pageXOffset}else if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){b=document.body.scrollTop;a=document.body.scrollLeft}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){b=document.documentElement.scrollTop;a=document.documentElement.scrollLeft}return[a,b]}
function parseURL(a){var b={href:a};a=a.replace("//","/").split("/");b.protocol=a[0];b.host=a[1];a[1]=a[1].split(":");b.hostname=a[1][0];b.port=a[1].length>1?a[1][1]:"";a.splice(0,2);b.pathname="/"+a.join("/");b.pathname=b.pathname.split("#");b.hash=b.pathname.length>1?"#"+b.pathname[1]:"";b.pathname=b.pathname[0];b.pathname=b.pathname.split("?");b.search=b.pathname.length>1?"?"+b.pathname[1]:"";b.pathname=b.pathname[0];return b}
Date.prototype.setISO8601=function(a){a=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?"));var b=0,c=new Date(a[1],0,1);a[3]&&c.setMonth(a[3]-1);a[5]&&c.setDate(a[5]);a[7]&&c.setHours(a[7]);a[8]&&c.setMinutes(a[8]);a[10]&&c.setSeconds(a[10]);a[12]&&c.setMilliseconds(Number("0."+a[12])*1E3);if(a[14]){b=Number(a[16])*60+Number(a[17]);b*=a[15]=="-"?1:-1}b-=c.getTimezoneOffset();time=Number(c)+b*60*1E3;this.setTime(Number(time))};
function isValidEmailAddress(a){return RegExp(/^[a-zA-Z0-9\._%-]+@[A-Z0-9\.-]+\.[a-zA-Z]{2,4}(?:(?:[,][a-zA-Z0-9\._%-]+@[a-zA-Z0-9\.-]+))?$/i).test(a)}function isEmpty(a){for(var b in a)if(a.hasOwnProperty(b))return false;return true}
function secondsToHms(a){a=Number(a);var b=Math.floor(a/86400),c=Math.floor(a/3600),d=Math.floor(a%3600/60);a=Math.floor(a%3600%60);return b>1?b+" Days ago":b==1?b+" Day ago":c>1?c+" Hours ago":c==1?c+" Hour ago":d>1?d+" Minutes ago":d==1?d+" Minute ago":a>=10?a+" Seconds ago":"Right now"}function getGetOrdinal(a){var b=["th","st","nd","rd"],c=a%100;return a+(b[(c-20)%10]||b[c]||b[0])}
var account_type="BASIC",account_data=null,side_bar_initialized=false,side_bar_scroll=null,reEscape=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g"),portrit_favicon='<img class="post_favicon" src="http://portrit.s3.amazonaws.com/img/favicon.png"/>',slide_trans_time=350,upgrade_timeout=null,album=null,albums=null,touch_album=null,swipe_timer=null,first_x=null,first_y=null,last_x=null,last_y=null,myScroll_photos=null,myScroll_profile=null,first_touch=true,click_hold_timer=null,mouse_up=
false,click_hold=false,scroll_to_user=null,selected_user="",selected_album_id="",selected_album=null,selected_photo="",selected_photo_hold=null,selected_photo_group=[],prev_photo_id=null,photo_large_view=false,view_active="",display_type="",tablet=mobile=false,user_profile=null,user_likes=null,user_movies=null,user_books=null,user_feed=null,my_feed=null,my_photo_feed=null,fb_session=null,photo_comment_cache={},start_z_index=100,comment_form_shown=false,peek_ended=false,peek_on=false,peeked_photos=
[],global_hash_tag="#",search_string="",search_active=false,user_videos=null,kill_friend_shown=false,reattach_friend=false,mutual_friend_data=null,mutual_friend_top=0,friends=null,friend_array=[],friends_alpha=[],referral_count=0,gallery_scroll=null,photo_load_once=false,update_feed_interval=null,scroll_pos_stack=[],default_view=null,stream_view=null,load_more_feed=false,initial_feed_load=true,photo_filter=null,user_winning_noms_cache={},fb_server_timeout=null;user_notifications={new_noms:{},comments:{}};
close_size="normal";me=null;
if(DetectMobileQuick()===true){mobile=true;close_size="mobile";var meta_html=typeof _gaq!=="undefined"?'<link rel="stylesheet" href="http://portrit.s3.amazonaws.com/styles/production/mobile-4.css"/><meta id="viewport_meta" name="viewport" content="width=520, user-scalable=no"/><link rel="shortcut icon" href="http://portrit.s3.amazonaws.com/img/favicon.ico"><link rel="apple-touch-icon" href="http://portrit.s3.amazonaws.com/img/icon128.png"/><link rel="apple-touch-icon-precomposed" href="http://portrit.s3.amazonaws.com/img/icon128.png"/>':'<link rel="stylesheet" href="/site_media/styles/trunk/mobile.css"/><meta id="viewport_meta" name="viewport" content="width=520, user-scalable=no"/><link rel="shortcut icon" href="/site_media/img/favicon.ico"><link rel="apple-touch-icon" href="/site_media/img/icon128.png"/><link rel="apple-touch-icon-precomposed" href="/site_media/img/icon128.png"/>';
$("head").append(meta_html);var window_width=520;$("body, html, #header, #cont, #wrapper").css({margin:"0 auto","min-width":window_width,width:window_width,"max-width":window_width});if(window.orientation!=0){window_width=720;$("#viewport_meta").attr("content","width=520, user-scalable=no, target-densityDpi=160")}else{window_width=520;$("#viewport_meta").attr("content","width=520, user-scalable=no, target-densityDpi=260")}}else if(DetectIpad()===true){close_size="mobile";tablet=mobile=true;meta_html=
typeof _gaq!=="undefined"?'<link rel="stylesheet" href="http://portrit.s3.amazonaws.com/styles/production/tablet-4.css"/><link rel="shortcut icon" href="http://portrit.s3.amazonaws.com/img/favicon.ico"><link rel="apple-touch-icon" href="http://portrit.s3.amazonaws.com/img/icon128.png"/><link rel="apple-touch-icon-precomposed" href="http://portrit.s3.amazonaws.com/img/icon128.png"/>':'<link rel="stylesheet" href="/site_media/styles/trunk/tablet.css"/><link rel="shortcut icon" href="/site_media/img/favicon.ico"><link rel="apple-touch-icon" href="/site_media/img/icon128.png"/><link rel="apple-touch-icon-precomposed" href="/site_media/img/icon128.png"/>';
$("head").append(meta_html)}function update_urls(){var a="",b="",c="",d="",e=true;if(selected_user!==""){a="user="+selected_user;e=false}if(selected_album_id!==""){b="/album="+selected_album_id;e=false}if(selected_photo!==""){c="/gallery";e=false}if(e===true)if(display_type==="wall")d="display="+display_type;else if(display_type==="alpha")d="display="+display_type;window.location.hash="#/"+d+a+b+c}function find_friend(a,b){for(var c=-1,d=0;d<b.length;d++)if(b[d].id===a)c=d;return c}
function render_settings(){var a="";var b=a="switch_off";if(allow_notifications)a="switch_on";if(allow_portrit_album)b="switch_on";a='<div id="settings_cont"><h1>Settings</h1><div id="allow_notifications_cont"><label for="allow_notifications">Allow Portrit to notify your Facebook account: </label><div id="allow_notifications" value="fb_auto_post" class="switch '+a+'"></div><div class="clear"></div></div><div id="allow_portrit_album_cont"><label for="allow_portrit_album">Allow Portrit to post winning trophies back to Facebook: </label><div id="allow_portrit_album" value="portrit_album" class="switch '+
b+'"></div><div class="clear"></div></div><a id="clear_db" class="sick large">Clear cache</a><span> - Only use when in dire straits!</span></div>';$("#context_cont").append(a);setTimeout(function(){$("#context_cont").fadeIn(100)},450)}
function attach_settings_handlers(){$("#clear_db").live("click",function(){if(window.sessionStorage!==undefined){$(this).next().text("Cache has been cleared. Good luck!").delay(4500).fadeOut();$(this).remove();sessionStorage.clear();sessionStorage.clear()}});$("#allow_notifications, #allow_portrit_album").live("click",function(){var a=false,b=$(this).attr("value");if($(this).hasClass("switch_on")){if(b=="fb_auto_post")allow_notifications=true;else if(b=="portrit_album")allow_portrit_album=true;a=
true}else{if(b=="fb_auto_post")allow_notifications=false;else if(b=="portrit_album")allow_portrit_album=false;a=false}$.post("/change_user_permissions/",{permission:b,check:a},function(){})})}
function get_referral_html(){for(var a="",b=0;b<friend_array.length;b++)a+='<div class="friend_ref_cont" id="ref_'+b+'" value="'+friend_array[b].id+'" name="'+friend_array[b].name+'" onclick="void(0)"><img src="https://graph.facebook.com/'+friend_array[b].id+'/picture?type=square"><h4>'+friend_array[b].name+"</h4></div>";return a}
function get_payments_html(){return'<h4 id="or_right">OR</h4><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="B9RVRDG5LJQYG"><input type="image" src="https://www.paypal.com/en_US/i/btn/btn_buynowCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"><img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1"></form><form action="https://checkout.google.com/api/checkout/v2/checkoutForm/Merchant/449086731763420" id="BB_BuyButtonForm" method="post" name="BB_BuyButtonForm" target="_top"><input name="item_name_1" type="hidden" value="Portrit Social Account"/><input name="item_description_1" type="hidden" value="Unlocks the social features of Portrit! Allows user to comment and like friend\'s posts and pictures."/><input name="item_quantity_1" type="hidden" value="1"/><input name="item_price_1" type="hidden" value="0.99"/><input name="item_currency_1" type="hidden" value="USD"/><input name="shopping-cart.items.item-1.digital-content.url" type="hidden" value="http://portrit.com/upgrade_user/"/><input name="_charset_" type="hidden" value="utf-8"/><input alt="" src="https://checkout.google.com/buttons/buy.gif?merchant_id=449086731763420&amp;w=117&amp;h=48&amp;style=white&amp;variant=text&amp;loc=en_US" type="image"/></form>'}
function render_upgrade(a){var b="",c="",d="",e="",f=0,g="";d="";comment_form_shown=true;if(a=="social"){b="<h3>Want to be more social?</h3>";c='<div id="here_basic"><img src="http://portrit.s3.amazonaws.com/img/here_basic_arrow.png"/><h3>You are here</h3></div>';if(referrals<=3){f=3-referrals;g="Only "+f+" referrals to go!"}else{f=0;g=""}d=get_referral_html();e=get_payments_html();d='<div id="payment_types_cont"><h1>Upgrade Options</h1><div id="pay_cont"><h2 class="title_right">Buy Us a Beer!</h2><div class="clear"></div>'+
e+'</div><div id="refferal_cont"><h2 class="title_left">Refer Your Friends</h2><h3 class="title_right">'+g+'</h3><div class="clear"></div><p>Send an invite to '+f+' of your friends to unlock new features. Best part is, your friends don\'t even need to accept! Our thanks to you for spreading the word.</p><div id="refferal_cont_scroll"><div id="refferal_scroller">'+d+'</div></div><div id="reffered_friends"></div></div><div class="clear"></div></div>'}else if(a=="plus"){b="";c='<div id="here_social"><img src="http://portrit.s3.amazonaws.com/img/here_social_arrow.png"/><h3>You are here</h3></div>';
if(referrals<=10){f=10-referrals;g="Only "+f+" referrals to go!"}else{f=0;g=""}d=get_referral_html();e=get_payments_html();d=""}b='<h1 id="about_title">Thinking About Upgrading?</h1>'+b+'<div style="position: relative;"><table id="account_levels" border="0" cellspacing="0"><tr><th id="account_diffs"><h2>Account Levels:</h2></th><th><h4 id="basic_title">Basic</h4></th><th><h4 id="social_title">Social <span>Most Popular</span></h4></th><th><h4 id="plus_title">Plus <span>Coming soon!</span></h4></th></tr><tr><td><h5 class="table_img_heading">Friend Canvas</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">View Friend\'s Albums</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">Photo Gallery</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">Touch Friendly</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">View Friend\'s Stream</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">Comment and Like Friend\'s Post</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/cross_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">Hide the Friends You Don\'t Care About</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/cross_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">Create a List of Your Favorite Friends</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/cross_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5 class="table_img_heading">Secret Plus Features</h5></td><td><img class="column_1" src="http://portrit.s3.amazonaws.com/img/cross_24.png"/></td><td><img class="column_2" src="http://portrit.s3.amazonaws.com/img/cross_24.png"/></td><td><img class="column_3" src="http://portrit.s3.amazonaws.com/img/check_24.png"/></td></tr><tr><td><h5>Price</h5></td><td>Free!</td><td>3 Referrals or $0.99</td><td>Coming soon!</td></tr></table>'+
c+'</div><div class="clear"></div>'+d+'<div class="clear"></div>';$("#context_cont").append(b);mobile&&a!="plus"?setTimeout(function(){$("#context_cont").fadeIn(100,function(){new iScroll("refferal_scroller")})},450):setTimeout(function(){$("#context_cont").fadeIn(100)},450);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Upgrade","Shown",""])}
function render_tour(){$("#context_cont").append("<h1>Welcome to the Portrit Tour</h1>");setTimeout(function(){$("#context_cont").fadeIn(100)},450);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Tour","Shown",""])}
function render_about(){var a='<div id="facebook_frame"><iframe src="http://www.facebook.com/plugins/likebox.php?href=http%3A%2F%2Fwww.facebook.com%2Fapps%2Fapplication.php%3Fid%3D126374870731237&amp;width=292&amp;connections=10&amp;stream=true&amp;header=true&amp;height=587" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:292px; height:587px;" allowTransparency="true"></iframe></div>';if(mobile&&!tablet)a="";a='<h1 id="about_title">About</h1><div id="about_right_cont"><div id="find_us"><h3>Find us on the tubes</h3><ul><li><h4>Blog</h4><a target="_blank" href="http://blog.portrit.com">Posterous</a></li><li><h4>Twitter</h4><a target="_blank" href="http://twitter.com/#!/portritinc">@portritinc</a></li></ul></div>'+
a+'</div><div id="about_left_cont"><img src="http://portrit.s3.amazonaws.com/img/about_graphic.jpg"/><p>Portrit aims to make photo sharing more social. It\'s up to your social circle to find and award the best photos out there. No longer do you need to look through thousands of your friend\'s photos to find the best ones. On Portrit, you and your friends filter the lame photos from the sick ones.</p><p>Co-founded by Jonathan Eatherly and Jerry Lin in 2010.</p></div><div class="clear"></div>';$("#context_cont").append(a);
setTimeout(function(){$("#context_cont").fadeIn(100)},450);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","About","Shown",""])}
function render_contact(){$("#contact_nav li").live("click",function(){var a=$(this).attr("name");if(a==="contact"){$("#contact_explain").text("Comments? Love us? Hate us? Found a bug and what to share? Dont hold back, give it to use real.");$("#bug_form_cont").hide();$("#contact_form_cont").show();$("#contact_nav li").css({opacity:"0.7"});$(this).css({opacity:"1.0"})}else if(a==="bug"){$("#contact_explain").text("Found a problem with the site? Please use the form below to describe the issue in as much detail as possible so we know how to reproduce it.");
$("#contact_form_cont").hide();$("#bug_form_cont").show();$("#contact_nav li").css({opacity:"0.7"});$(this).css({opacity:"1.0"})}});$("#contact_form .button, #bug_form .button").live("click",function(){var a=this,b=$(this).parent().parent();if($(b).attr("id")=="contact_form"){b=false;var c=$("#contact_email").val(),d=$("#contact_reason").val(),e=$("#contact_message_cont textarea").val();if(isValidEmailAddress(c))$("#contact_email_cont .invalid_data").remove();else{b=true;$("#contact_email_cont .invalid_data").remove();
$("#contact_email").after('<div class="invalid_data"></div>')}if(d<1||d>6){b=true;$("#contact_reason_cont .invalid_data").remove();$("#contact_reason").after('<div class="invalid_data"></div>')}else $("#contact_reason_cont .invalid_data").remove();if(e==""){b=true;$("#contact_message_cont .invalid_data").remove();$("#contact_message_cont > textarea").after('<div class="invalid_data"></div>')}else $("#contact_message_cont .invalid_data").remove();if(!b){$(a).hide();$("#contact_form .submit_cont").append('<img class="submit_pending" src="http://portrit.s3.amazonaws.com/img/ajax-loader-light.gif"/>');
$.post("/contact_portrit/",{email:c,reason:d,message:e},function(){$(".submit_pending").remove();$(a).show();$("#contact_form .submit_pending").remove();$("#contact_email").val("");$("#contact_reason").val("");$("#contact_message_cont textarea").val("");$("#contact_form .submit_cont").append("<h2>Thanks for your message. We will get to it soon.</h2>");$(".submit_cont h2").animate({opacity:0},5E3,function(){$(this).remove()})})}}else if($(b).attr("id")=="bug_form"){b=false;c=$("#bug_email").val();
d=$("#bug_where").val();e=$("#bug_what").val();var f=$("#bug_op").val(),g=$("#bug_browser").val();if(isValidEmailAddress(c))$("#bug_email_cont .invalid_data").remove();else{b=true;$("#bug_email_cont .invalid_data").remove();$("#bug_email").after('<div class="invalid_data"></div>')}if(d==""){b=true;$("#bug_where_cont .invalid_data").remove();$("#bug_where").after('<div class="invalid_data"></div>')}else $("#bug_where_cont .invalid_data").remove();if(e==""){b=true;$("#bug_what_cont .invalid_data").remove();
$("#bug_what").after('<div class="invalid_data"></div>')}else $("#bug_what_cont .invalid_data").remove();if(f==""){b=true;$("#bug_op_cont .invalid_data").remove();$("#bug_op").after('<div class="invalid_data"></div>')}else $("#bug_op_cont .invalid_data").remove();if(g==""){b=true;$("#bug_browser_cont .invalid_data").remove();$("#bug_browser").after('<div class="invalid_data"></div>')}else $("#bug_browser_cont .invalid_data").remove();if(!b){$(a).hide();$("#bug_form .submit_cont").append('<img class="submit_pending" src="http://portrit.s3.amazonaws.com/img/ajax-loader-light.gif"/>');
$.post("/submit_bug_report/",{email:c,where:d,message:e,os:f,browser:g},function(){$("#bug_form .submit_pending").remove();$(a).show();$("#bug_email").val("");$("#bug_where").val("");$("#bug_what").val("");$("#bug_op").val("");$("#bug_browser").val("");$("#bug_form .submit_cont").append("<h2>Thanks for your report. It's people like you that keep this place nice.</h2>");$(".submit_cont h2").animate({opacity:0},5E3,function(){$(this).remove()})})}}return false});$("#context_cont").append('<div id="contact_header"><h1 id="contact_title">Tell Us What\'s Up</h1><p id="contact_explain">Comments? Love us? Hate us? Found a bug and want to share? Dont hold back, give it to us real.</p></div><div id="contact_nav"><ul><li id="tab_contact" name="contact" style="opacity: 1.0;" onclick="void(0)"><span>Send us a Message</span></li><li name="bug" id="tab_bug" onclick="void(0)"><span>File a Bug Report</span></li></div><div class="clear"></div><div id="contact_form_cont"><form action="" method="POST" id="contact_form"><div id="contact_email_cont"><label for="contact_email">Your email address</label><input type="text" id="contact_email"/><div class="clear"></div></div><div id="contact_reason_cont"><label for="contact_reason">Reason for contacting us</label><select id="contact_reason" name="contact_reason"><option value>Please choose one (required)</option><option value="1">Portrit support & help</option><option value="2">General feedback</option><option value="3">Report abuse or Terms of Use violation</option><option value="4">Partnership opportunities</option><option value="5">Press Inquiry</option><option value="6">Advertise with Portrit</option></select><div class="clear"></div></div><div id="contact_message_cont"><label for="contact_message">Message</label><textarea name="contact_message"></textarea><div class="clear"></div></div><div class="submit_cont"><span class="button sick">Send Message</span></div></form></div><div id="bug_form_cont" style="display:none;"><form action="" method="POST" id="bug_form"><div id="bug_email_cont"><label for="bug_email">Your email address</label><input type="text" id="bug_email"/><div class="clear"></div></div><div id="bug_where_cont"><label for="bug_where">Where?</label><input id="bug_where" type="text" name="bug_where"/><div class="clear"></div></div><div id="bug_what_cont"><label for="bug_what">What Happened?</label><textarea id="bug_what" name="bug_what"/><div class="clear"></div></div><div id="bug_op_cont"><label for="bug_op">Operating System</label><input id="bug_op" type="text" name="bug_op"/><div class="clear"></div></div><div id="bug_browser_cont"><label for="bug_browser">Web Browser</label><input id="bug_browser" type="text" name="bug_browser"/><div class="clear"></div></div><div class="submit_cont"><span class="button sick">Submit Report</span></div></form></div><div class="clear"></div>');
setTimeout(function(){$("#context_cont").fadeIn(100)},450);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Contact","Shown",""])}
function render_terms(){$("#context_cont").append('<h1 id="terms_title">Terms of Use</h1><p>The following Terms of Use outline your obligations when using the Portrit website. You can also review our Privacy Policy, which outlines our obligations and practices towards handling any personal information that you may provide to us.</p><h2 class="terms_sub_title">1. Acceptance of Terms</h2><p>The web pages available at portrit.com, and all linked pages ("Site"), are owned and operated by Portrit, Inc. ("Portrit"), a Oregon corporation, and is accessed by you under the Terms of Use described below ("Terms of Use").<br/><br/>Please read these terms of use carefully before using Portrit or its services. By accessing Portrit or using any part of the Site you agree to become bound by these terms and conditions. If you do not agree to all the terms and conditions, then you may not access Portrit, or use the content or any services offered. Portrit\'s acceptance is expressly conditioned upon your assent to all these terms and conditions, to the exclusion of all other terms; if these terms and conditions are considered an offer by Portrit, acceptance is expressly limited to these terms.</p><h2 class="terms_sub_title">2. Modifications of the Terms of Use</h2><p>Portrit reserves the right, at its sole discretion, to modify or replace the Terms of Use at any time. If the alterations constitute a material change to the Terms of Use, Portrit will notify you by posting an announcement on the Site. What constitutes a "material change" will be determined at Portrit\'s sole discretion, in good faith and using common sense and reasonable judgment. You shall be responsible for reviewing and becoming familiar with any such modifications. Use of the Services by you following such notification constitutes your acceptance of the terms and conditions of the Terms of Use as modified.</p><h2 class="terms_sub_title">3. Description of the Service</h2><p>Subject to full compliance with the Terms of Use, Portrit may offer to provide certain services and content, as described more fully on the Site, ("Services"). Services shall include, but not be limited to, any service and content Portrit performs for you, as well as the offering of any materials displayed, transmitted or performed on the Site or through the Services (including, but not limited to text, user comments, information, photographs, images, illustrations, audio clips and video clips, also known as the "Content"). Portrit may change, suspend or discontinue the Services for any reason, at any time, including the availability of any feature. Portrit may also impose limits on certain features and services or restrict your access to parts or all of the Services without notice or liability.</p><h2 class="terms_sub_title">4. Portrit Privacy Policy</h2><p>Portrit\'s current privacy policy is available at <a href="http://portrit.com/#/context=privacy">portrit.com/#/context=privacy</a> (the "Privacy Policy"), which is incorporated by this reference.</p><h2 class="terms_sub_title">5. Indemnity</h2><p>You will indemnify and hold harmless Portrit, its parents, subsidiaries, affiliates, customers, vendors, officers and employees from any liability, damage or cost (including reasonable attorneys. fees and cost) from (i) any claim or demand made by any third party due to or arising out of your access to the Site, use of the Services, violation of the Terms of Use by you, or the infringement by you, or any third party using your account or Facebook User ID, of any intellectual property or other right of any person or entity.</p><h2 class="terms_sub_title">6. Warranty Disclaimers</h2><p>You acknowledge that Portrit has no control over, and no duty to take any action regarding: which users gain access to the Site or use the Services; what effects the Content may have on you; how you may interpret or use the Content; or what actions you may take as a result of having been exposed to the Content. You release Portrit from all liability for you having acquired or not acquired Content through the Site or the Services. The Site or Services may contain, or direct you to sites containing, information that some people may find offensive or inappropriate. Portrit makes no representations concerning any content contained in or accessed through the Site or Services, and Portrit will not be responsible or liable for the accuracy, copyright compliance, legality or decency of material contained in or accessed through the Site or the Services. THE SERVICE, CONTENT, AND SITE ARE PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING, WITHOUT LIMITATION, IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NON-INFRINGEMENT. SOME STATES DO NOT ALLOW LIMITATIONS ON HOW LONG AN IMPLIED WARRANTY LASTS, SO THE ABOVE LIMITATIONS MAY NOT APPLY TO YOU.</p><h2 class="terms_sub_title">7. Links </h2><p>The Services may provide, or third parties may provide, links to other World Wide Web sites or resources. Because Portrit has no control over such sites and resources, you acknowledge and agree that Portrit is not responsible for the availability of such external sites or resources, and does not endorse and is not responsible or liable for any Content, advertising, products or other materials on or available from such sites or resources. You further acknowledge and agree that Portrit shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with use of or reliance on any such Content, goods or services available on or through any such site or resource.</p><h2 class="terms_sub_title">8. Limitation of Liability</h2><p>In no event shall Portrit or its suppliers be liable under contract, tort or strict liability, negligence or other legal theory (i) with respect to the Site, the Service or any content for any lost profits or special, indirect, incidental, punitive or consequential damages of any kind whatsoever, substitute goods or services (however arising), or (ii) for any direct damages in excess of (in the aggregate) $100. Some states do not allow the exclusion or limitation of incidental or consequential damages, so the above limitations and exclusions may not apply to you.</p><h2 class="terms_sub_title">9. Termination</h2><p>Portrit may terminate or suspend any and all Services and your Portrit account immediately, without prior notice or liability, if you breach any of the terms or conditions of the Terms of Use. Upon termination of your account, your right to use the Services will immediately cease. If you wish to terminate your Portrit account, you may simply discontinue using the Services. All provisions of the Terms of Use which by their nature should survive termination shall survive termination, including, without limitation, ownership provisions, warranty disclaimers, indemnity and limitations of liability.</p><h2 class="terms_sub_title">10. Miscellaneous</h2><p>No agency, partnership, joint venture, or employment is created as a result of the Terms of Use and you do not have any authority of any kind to bind Portrit in any respect whatsoever. The failure of either party to exercise in any respect any right provided for herein shall not be deemed a waiver of any further rights hereunder. Portrit shall not be liable for any failure to perform its obligations hereunder where such failure results from any cause beyond Portrit\'s reasonable control, including, without limitation, mechanical, electronic or communications failure or degradation (including "line-noise" interference). If any provision of the Terms of Use is found to be unenforceable or invalid, that provision shall be limited or eliminated to the minimum extent necessary so that the Terms of Use shall otherwise remain in full force and effect and enforceable. The Terms of Use is not assignable, transferable or sublicensable by you except with Portrit\'s prior written consent. Portrit may transfer, assign or delegate the Terms of Use and its rights and obligations without consent. The Terms of Use shall be governed by and construed in accordance with the laws of the state of Oregon, as if made within Oregon between two residents thereof, and the parties submit to the exclusive jurisdiction of the Superior Court of Oregon and the United States District Court for the District of Oregon. Notwithstanding the foregoing sentence, (but without limiting Portrit\'s right to seek injunctive or other equitable relief in any court of competent jurisdiction), any disputes arising with respect to this Agreement shall be referred to an arbitrator affiliated with JAMS, The Resolution Experts. The arbitrator shall be selected by joint agreement of the parties. In the event the parties cannot agree on an arbitrator within thirty (30) days of the initiating party providing the other party with written notice that it plans to seek arbitration, the parties shall each select an arbitrator affiliated with JAMS, which arbitrators shall jointly select a third such arbitrator to resolve the dispute. The written decision of the arbitrator shall be final and binding on the parties. The arbitration proceeding shall be carried on and heard in Ashland, Oregon using the English language and pursuant to the rules of JAMS. In any action or proceeding to enforce rights under the Terms of Use, the prevailing party will be entitled to recover costs and attorneys\' fees. Both parties agree that the Terms of Use is the complete and exclusive statement of the mutual understanding of the parties and supersedes and cancels all previous written and oral agreements, communications and other understandings relating to the subject matter of the Terms of Use, and that all modifications must be in a writing signed by both parties, except as otherwise provided herein.</p>');setTimeout(function(){$("#context_cont").fadeIn(100)},
450);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Terms","Shown",""])}
function render_privacy(){$("#context_cont").append('<div id="privacy_cont"><h1 id="privacy_title">Privacy Policy</h1><p>Portrit is founded on the principles of complete separation of user data. Portrit knows that you care about how your personal information is used and shared, and we take your privacy very seriously. Please read the following to learn more about our privacy policy. By visiting the Portrit website, you are accepting the practices outlined in this Privacy Policy.</p><p>This Privacy Policy covers Portrit\'s treatment of personal information that Portrit gathers when you are on the Portrit website and when you use Portrit services. This policy does not apply to the practices of third parties that Portrit does not own or control, or to individuals that Portrit does not employ or manage.</p><h2>Information Collected by Portrit</h2><p>We only collect personal information that is relevant to the purpose of our website, which is to enable users to discover and share information with one another. This information allows us to provide you with a customized and efficient experience. We do not process this information in a way that is incompatible with this objective. We collect the following types of information from our Portrit users:</p><h3>Information You Provide to Us:</h3><p class="indent">We receive and store any information you enter on our website or provide to us in any other way. You can choose not to provide us with certain information, but then you may not be able to take advantage of many of our special features.</p><h3>Automatic Information:</h3><p class="indent">We receive and store certain types of information whenever you interact with us. Portrit and its authorized agents automatically receive and record certain "traffic data" on their server logs from your browser including your IP address, Portrit cookie information, and the page you requested. Portrit uses this traffic data to help diagnose problems with its servers, analyze trends and administer the website.</p><p class="indent">Portrit is built off of the Facebook Open Grah API and as such Portrit abides by the API giudlines as well as any user Facebook privacy policies and permissions.</p><p class="indent">We will collect data from your Facebook account to enable features like friend lists, nominating photos, votes, and winning trophies. This data is shared across your friends to allow for a consistant experience for the other users of Portrit. We only store the most basic personal information, such as name, facebook id, album ids, and photo ids. You can delete any personal data we have, including votes, comments, nominations, and trophies by going to the settings and requesting to "Remove My Content".</p><h2>Sharing Your Information</h2><p>Rest assured that the information gathered about who is using Portrit will be neither rented nor sold to anyone and that we will share your personal information only as described below.</p><ul><li><p>Portrit Personnel: Portrit personnel and authorized consultants and/or contractors may have access to user analytics information if necessary in the normal course of Portrit business.</p></li><li><p>Business Transfers: In some cases, we may choose to buy or sell assets. In these types of transactions, user analytics information is typically one of the business assets that is transferred. Moreover, if Portrit, or substantially all of its assets, were acquired, user analytics information would be one of the assets that is transferred.</p></li></ul><h2>Keeping Information Secure</h2><ul><li><p>Your Portrit account information is protected by your Facebook account login username and password. Protect against unauthorized access to your password and to your computer by logging off once you have finished using a shared computer.</p></li><li><p>Only employees who need personal information to perform a specific job (for example, a customer service representative) are granted access to it. All of our employees are kept up to date on our privacy and security practices.</p></li></ul><h2>Changes to this Privacy Policy</h2><p>Portrit may amend this Privacy Policy from time to time, at its sole discretion. Use of information we collect now is subject to the Privacy Policy in effect at the time such information is used. If we make changes to the Privacy Policy, we will notify you by posting an announcement on the Portrit website so you are always aware of what information we collect, how we use it, and under what circumstances if any, it is disclosed.</p><h2>Conditions of Use</h2><p>If you decide to visit Portrit website, your visit and any possible dispute over privacy is subject to this Privacy Policy and our Terms of Use, including limitations on damages, arbitration of disputes, and application of Oregon state law.</p><h2>Effective Date of this Privacy Policy</h2><p>This Privacy Policy is effective as of January 31, 2011 and last updated January 28, 2011.</p></div>');setTimeout(function(){$("#context_cont").fadeIn(100)},
450);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Privacy","Shown",""])}function info_context_delagate(a){comment_form_shown=true;if(a==="about"){view_active="about";render_about()}else if(a==="contact"){view_active="contact";render_contact()}else if(a==="terms"){view_active="terms";render_terms()}else if(a==="privacy"){view_active="privacy";render_privacy()}else if(a==="settings"){view_active="settings";render_settings()}}
function show_feedback(a){comment_form_shown=true;a.stopPropagation();mobile?$("#wrapper").css({opacity:"0.3"}):$("#wrapper").animate({opacity:"0.3"},200);$("#feedback_cont_wrap").show();$("#feedback_reponse").hide();$("#feedback").show();$("#feedback_message").focus();$(document).bind("click",hide_feedback);$("#close_feedback").removeClass().addClass("close_img "+close_size);$("#close_feedback, #close_feedback_button").bind("click",hide_feedback);return false}
function hide_feedback(){comment_form_shown=false;if(mobile){$("#wrapper").css({opacity:"1.0"});$("#feedback").hide()}else{$("#wrapper").animate({opacity:1},300);$("#feedback").fadeOut()}$(document).unbind("click",hide_feedback);$("#close_feedback, #close_feedback_button").unbind("click",hide_feedback)}var startX,dx,direction,swipe_el=null,swipe_listener=null;
function cancelTouch(){swipe_el.removeEventListener("touchmove",onTouchMove);swipe_el.removeEventListener("touchend",onTouchEnd);direction=startY=startX=null}function onTouchMove(a){if(a.touches.length>1)cancelTouch();else{dx=a.touches[0].pageX-startX;a=a.touches[0].pageY-startY;if(direction==null)direction=dx;else if(direction<0&&dx>0||direction>0&&dx<0||Math.abs(a)>100)cancelTouch()}}
function onTouchEnd(){cancelTouch();if(Math.abs(dx)>200)swipe_listener({target:swipe_el,direction:dx>0?"right":"left"})}function onTouchStart(a){if(a.touches.length==1){dx=0;startX=a.touches[0].pageX;startY=a.touches[0].pageY;swipe_el.addEventListener("touchmove",onTouchMove,true);swipe_el.addEventListener("touchend",onTouchEnd,false)}}function addSwipeListener(a,b){swipe_el=a;swipe_listener=b;swipe_el.addEventListener("touchstart",onTouchStart,false)}
function set_mobile_css(){var a="";if(mobile&&!tablet)a=typeof _gaq!=="undefined"?'<link rel="stylesheet" href="http://portrit.s3.amazonaws.com/styles/production/mobile-3.css"/>':'<link rel="stylesheet" href="/site_media/styles/trunk/mobile.css"/>';else if(mobile&&tablet)if(typeof _gaq!=="undefined")a='<link rel="stylesheet" href="http://portrit.s3.amazonaws.com/styles/production/tablet-3.css"/>';$("head").append(a)}var notifcation_cache=[];
function wait_for_message(){$.ajax({type:"GET",url:"/watch_update/",data:{user:me.id},dataType:"json",async:true,cache:false,timeout:3E4,success:handle_update,error:function(){setTimeout(wait_for_message,5E3)}})}
function handle_update(a,b){if(a&&a.method)if(a.method=="new_nom"){for(var c=0;c<a.payload.nom_data.length;c++)if(a.payload.nom_data[c].nominator!=me.id){if(a.payload.nom_data[c].nominatee==me.id){render_notification("new_nom",a.payload.nom_data[c]);update_notifications(a.payload.nom_data[c],"new_nom");notifcation_cache.unshift({data:a.payload.nom_data[c],method:"new_nom"})}if(my_feed){active_noms_cache[a.payload.nom_data[c].id]=a.payload.nom_data[c];if(active_nom_cats_map[a.payload.nom_data[c].nomination_category.replace(" ",
"_").toLowerCase()])active_nom_cats_map[a.payload.nom_data[c].nomination_category.replace(" ","_").toLowerCase()].push(a.payload.nom_data[c].id);else active_nom_cats_map[a.payload.nom_data[c].nomination_category.replace(" ","_").toLowerCase()]=[a.payload.nom_data[c].id];for(var d=0;d<my_feed.length;d++)my_feed[d].cat_name==a.payload.nom_data[c].nomination_category&&my_feed[d].noms.push(a.payload.nom_data[c])}user_winning_noms_cache[a.payload.nom_data[c].nominatee]&&a.payload.nom_data[c].nominator!=
me.id&&user_winning_noms_cache[a.payload.nom_data[c].nominatee].active_nom_objs.push(a.payload.nom_data[c])}if($("#empty_noms_cont").length>0&&$("#new_noms_action").length==0){$("#scroller").prepend('<div id="new_noms_action" style="display:none;"><h2>New nominations have arrived! Click to view.</h2></div>');$("#new_noms_action").fadeIn();$("#new_noms_action").bind("click",function(){$("#new_noms_action").unbind("click");stream_view="";recent_noms_click()})}else if(view_active=="main"&&default_view==
"wall"&&stream_view=="recent_noms")inject_nom_stream(a.payload.nom_data);else if(view_active=="main"&&default_view=="wall")update_feed(a.payload);else view_active=="nom_detail"&&inject_nom_detail(a.payload.nom_data);$("#empty_noms_cont")}else if(a.method=="vote"){if(a.payload.vote_user!=me.id){if(active_noms_cache)if(active_noms_cache[a.payload.nom_id]){active_noms_cache[a.payload.nom_id].vote_count=a.payload.vote_count;active_noms_cache[a.payload.nom_id].votes.push({vote_user:a.payload.vote_user,
vote_name:a.payload.vote_name})}if(view_active=="main"&&default_view=="wall"&&stream_view=="recent_noms")update_vote_count(a.payload);else if(view_active=="main"&&default_view=="wall")update_vote_count(a.payload);else view_active=="nom_detail"&&update_vote_count(a.payload)}if(user_winning_noms_cache[a.payload.nominatee]){d=user_winning_noms_cache[a.payload.nominatee].active_nom_objs;for(c=0;c<d.length;c++)if(a.payload.nom_id==d[c].id)d[c].vote_count=a.payload.vote_count}}else if(a.method=="new_comment"){if(a.payload.comment_sender_id!=
me.id){render_notification("new_comment",a.payload);update_notifications(a.payload,"new_comment");notifcation_cache.unshift({data:a.payload,method:"new_comment"});if(view_active=="nom_detail")a.payload.id==$("#main_nom_cont").attr("value")&&render_comment_update(a.payload);else if(view_active=="main"&&default_view=="wall"){update_comment_count(a.payload);stream_view=="recent_noms"&&render_recent_comment_update(a.payload)}}}else if(a.method=="new_comment_update"){if(a.payload.comment_sender_id!=me.id)if(view_active==
"nom_detail")a.payload.id==$("#main_nom_cont").attr("value")&&render_comment_update(a.payload);else if(view_active=="main"&&default_view=="wall"){update_comment_count(a.payload);stream_view=="recent_noms"&&render_recent_comment_update(a.payload)}}else if(a.method=="nom_won"){notifcation_cache.unshift({data:a.payload,method:"nom_won"});render_notification("nom_won",a.payload);update_notifications(a.payload,"nom_won")}typeof b!=="undefined"&&wait_for_message()}
function render_recent_comment_update(a){var b='<div class="comment" id="comment_'+a.comment_id+'" style="display:none;"><p class="comment_time" value="'+a.create_datetime+'">Right now</p><a href="#/user='+a.comment_sender_id+'" class="clear_profile"><img class="user_photo" src="https://graph.facebook.com/'+a.comment_sender_id+'/picture?type=square"/></a><a href="#?user='+a.comment_sender_id+'" class="post_username from_username clear_profile">'+a.comment_sender_name+"</a><p>"+a.comment+"</p></div>";
$("#"+a.id+" .recent_nom_comment_heading").after(b);$("#comment_"+a.comment_id).fadeIn("slow");$("#"+a.id+" .comment_empty").length>0&&$("#"+a.id+" .comment_empty").remove();var c=new Date,d=null;$(".comment_time").each(function(){time=new Date($(this).attr("value")*1E3);d=c-time;d/=1E3;$(this).text(secondsToHms(parseInt(d)))})}
function render_comment_update(a){a='<div class="comment" style="display:none;"><p class="comment_time" value="'+a.create_datetime+'">Right now</p><a href="#/user='+a.comment_sender_id+'" class="clear_profile"><img class="user_photo" src="https://graph.facebook.com/'+a.comment_sender_id+'/picture?type=square"/></a><a href="#?user='+a.comment_sender_id+'" class="post_username from_username clear_profile">'+a.comment_sender_name+"</a><p>"+a.comment+"</p></div>";$(".comment_empty").length>0&&$(".comment_empty").remove();
$("#new_comment_cont").after(a);$(".comment:first").fadeIn("slow");var b=new Date,c=null;$(".comment_time").each(function(){time=new Date($(this).attr("value")*1E3);c=b-time;c/=1E3;$(this).text(secondsToHms(parseInt(c)))})}var notification_popup_fade_timeout=null,notification_popup_remove_timeout=null;
function render_notification(a,b){var c="";c="";if(a=="new_nom"){c="";c=b.nominator!=me.id?friends[b.nominator].name:"You";c='<div class="nom_cat_'+b.nomination_category.replace(" ","_").toLowerCase()+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+c+'</p><span> nominated your photo for the </span><p class="strong">'+b.nomination_category+"</p><span> trophy!</span></div>";user_notifications.new_noms[b.id]=b}else if(a=="new_comment")c=b.nom_owner_id==me.id?'<div class="nom_cat_'+
b.nomination_category.replace(" ","_").toLowerCase()+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+b.comment_sender_name+'</p><span> commented on your <p class="strong">'+b.nomination_category+"</p> nomination!</span></div>":b.nom_owner_id==b.comment_sender_id?'<div class="nom_cat_'+b.nomination_category.replace(" ","_").toLowerCase()+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+b.comment_sender_name+'</p><span> commented on their <p class="strong">'+
b.nomination_category+"</p> nomination!</span></div>":'<div class="nom_cat_'+b.nomination_category.replace(" ","_").toLowerCase()+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+b.comment_sender_name+'</p><span> commented on <span class="strong">'+b.nom_owner_name+'\'s</span> <p class="strong">'+b.nomination_category+"</p> nomination!</span></div>";else if(a=="nom_won")if(b.nominatee==me.id)c='<div class="nom_cat_'+b.nomination_category.replace(" ","_").toLowerCase()+
' notification_color"></div><div class="notification_text_cont"><p class="strong">Your</p><span> photo won the <p class="strong">'+b.nomination_category+"</p> nomination!</span></div>";else{c="";c=friends[b.nominatee].name;c='<div class="nom_cat_'+b.nomination_category.replace(" ","_").toLowerCase()+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+c+'\'s</p><span> photo won the <p class="strong">'+b.nomination_category+"</p> nomination!</span></div>"}var d="";if(b.notification_id)d=
b.notification_id;c='<div class="notification_popup" style="display:none;" value="'+b.id+'" name="'+d+'"><div class="close_notification close_img '+close_size+'"></div><div class="notification_cont">'+c+"</div></div>";$("#notification_popup_cont").append(c);var e=$(".notification_popup:hidden");setTimeout(function(){$(e).show().css({opacity:1})},75);notification_popup_fade_timeout=setTimeout(function(){$(e).css({opacity:0});notification_popup_remove_timeout=setTimeout(function(){$(e).remove()},350)},
7500)}
$(".notification_popup").live("click",function(){var a=this,b=$(this).attr("value"),c=parseInt($(this).attr("name")),d=false;$(".notification_popup_cont").each(function(){var e=$(this).attr("read"),f=parseInt($(this).attr("id").replace("notification_",""));if(e==0||e=="false"||e==false)if(c==f){$(this).attr("read","true");$.post("/notification_read/",{notification_id:c},function(){})}else d=true});d?$("#footer_notification_cont").css("opacity",1):$("#footer_notification_cont").css("opacity",0.3);
title_notification_count=0;update_title_notification_count();window.location.href="#/nom_id="+b;$(this).css({opacity:0});setTimeout(function(){$(a).remove()},350)});
mobile||$(".notification_popup").live("mouseover mouseout",function(a){var b=this;if(a.type=="mouseover"){clearTimeout(notification_popup_fade_timeout);clearTimeout(notification_popup_remove_timeout)}else notification_popup_fade_timeout=setTimeout(function(){$(b).css({opacity:0});notification_popup_remove_timeout=setTimeout(function(){$(b).remove()},350)},7500)});
$(".close_notification").live("click",function(a){var b=$(this).parent();$(b).css({opacity:0});setTimeout(function(){$(b).remove()},350);a.stopPropagation();return false});function update_title_notification_count(){title_notification_count>0?$("title").text("Portrit ("+title_notification_count+")"):$("title").text("Portrit")}var title_notification_count=0;
function update_notifications(a,b){var c="",d="",e="",f="";title_notification_count+=1;update_title_notification_count();e=a.nomination_category.replace(" ","_").toLowerCase();if(b=="new_nom"){d=friends[a.nominator]?friends[a.nominator].name:a.nominator==me.id?"You":"";c='<div class="notification_popup_cont color_transition nom_cat_'+e+'" name="'+e+'" value="'+a.id+'" read="false" id="notification_'+a.notification_id+'" onclick="void(0)"><div class="nom_cat_'+e+' notification_color"></div><div class="notification_text_cont"><p class="strong" style="">'+
d+'</p><span> nominated your photo.</span><span class="time"> - Right now</span></div><div class="kill_notification close_img '+close_size+'" value="'+a.notification_id+'" style="display:none;"></div></div>'}else if(b=="new_comment"){d=a.comment_sender_id==me.id?"You":a.comment_sender_name;f=a.nom_owner_id==me.id?"your":friends[a.nom_owner_id]?friends[a.nom_owner_id].name+"'s":"";c='<div class="notification_popup_cont color_transition nom_cat_'+e+'" name="'+e+'" value="'+a.id+'" read="false" id="notification_'+
a.notification_id+'" onclick="void(0)"><div class="nom_cat_'+e+' notification_color"></div><div class="notification_text_cont"><p class="strong" style="">'+d+"</p><span> commented on "+f+' photo.<span class="time"> - Right now</span></div><div class="kill_notification close_img '+close_size+'" value="'+a.notification_id+'" style="display:none;"></div></div>'}else if(b=="nom_won"){d=a.nominatee==me.id?"Your":a.nominatee_name?a.nominatee_name+"'s":friends[a.nominatee].name+"'s";c='<div class="notification_popup_cont color_transition nom_cat_'+
e+'" name="'+e+'" value="'+a.id+'" read="false" won="true" id="notification_'+a.notification_id+'" onclick="void(0)"><div class="nom_cat_'+e+' notification_color"></div><div class="notification_text_cont"><p class="strong" style="">'+d+'</p><span> photo won the </span><p class="strong" style="">'+a.nomination_category+'</p><span> trophy!</span><span class="time"> - Right now</span></div><div class="kill_notification close_img '+close_size+'" value="'+a.notification_id+'" style="display:none;"></div></div>'}$("#notification_footer_popup_cont").prepend(c);
$("#footer_notification_cont").css({opacity:"1.0"});$("#footer_notification_cont > p").addClass("nom_cat_"+e+"_text")}
function render_notifications(a){var b="",c="",d="",e="",f="",g=true,h=null,j=null,m=[];h="";if(a)for(var l=0;l<a.length;l++){e="";c=a[l].source_id==me.id?a[l].notification_type=="nom_won"?"Your":"You":!a[l].source_name&&a[l].source_id?friends[a[l].source_id].name+"'s":a[l].source_name;d=a[l].destination_id==me.id?"Your":a[l].destination_name?a[l].destination_name+"'s":friends[a[l].destination_id].name+"'s";f=a[l].nomination_category.replace(" ","_").toLowerCase();if(!a[l].read){e="color_transition nom_cat_"+
f;if(g){$("#footer_notification_cont").css({opacity:"1.0"});$("#footer_notification_cont > p").addClass("nom_cat_"+f+"_text");g=false}}h=new Date;j=new Date(a[l].create_time*1E3);h-=j;h/=1E3;h=secondsToHms(parseInt(h));if(a[l].notification_type=="new_nom")b+='<div class="notification_popup_cont '+e+'" name="'+f+'" value="'+a[l].nomination+'" read="'+a[l].read+'" id="notification_'+a[l].notification_id+'" time="'+a[l].create_time+'" onclick="void(0)"><div class="nom_cat_'+f+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+
c+'</p><span> nominated your photo.<span class="time"> - '+h+'</span></div><div class="kill_notification close_img '+close_size+'" value="'+a[l].notification_id+'" style="display:none;"></div></div>';else if(a[l].notification_type=="new_comment")b+='<div class="notification_popup_cont '+e+'" name="'+f+'" value="'+a[l].nomination+'" read="'+a[l].read+'" id="notification_'+a[l].notification_id+'" time="'+a[l].create_time+'" onclick="void(0)"><div class="nom_cat_'+f+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+
c+"</p><span> commented on "+d+' photo.<span class="time"> - '+h+'</span></div><div class="kill_notification close_img '+close_size+'" value="'+a[l].notification_id+'" style="display:none;"/></div></div>';else if(a[l].notification_type=="nom_won"){b+='<div class="notification_popup_cont '+e+'" name="'+f+'" value="'+a[l].nomination+'" read="'+a[l].read+'" id="notification_'+a[l].notification_id+'" won="true" time="'+a[l].create_time+'" onclick="void(0)"><div class="nom_cat_'+f+' notification_color"></div><div class="notification_text_cont"><p class="strong">'+
d+'</p><span> photo won the </span><p class="strong">'+a[l].nomination_category+'</p><span> trophy!</span><span class="time"> - '+h+'</span></div><div class="kill_notification close_img '+close_size+'" value="'+a[l].notification_id+'" style="display:none;"/></div></div>';a[l].destination_id==me.id&&a[l].read==false&&m.push({fb_user:a[l].source_id,cat:a[l].nomination_category,nom_id:a[l].nomination,notification_id:a[l].notification_id})}notifcation_cache.unshift({data:a[l],method:a[l].notification_type})}if(m&&
m.length>0){var i=null;if(render_perms_context)i=setInterval(function(){if($("#context_overlay_cont > div").children().length==0){clearInterval(i);render_publish_story(m);render_perms_context=false}},250);else render_publish_story(m)}$("#notification_footer_popup_cont").append(b)}
function render_publish_story(a){var b="",c="",d="",e="",f="";f=me.name.split(" ")[0];for(d=0;d<a.length;d++){b=a[d].cat.replace(" ","_").toLowerCase();c+=d+1<a.length?a[d].notification_id+",":a[d].notification_id}if(a.length==1){d=f+" won the "+a[0].cat+" trophy for their rockin' photo!";e="http://portrit.s3.amazonaws.com/img/invite/"+b+".png"}else{d=f+" won "+a.length+" trophies for their rockin' photos!";e="http://portrit.s3.amazonaws.com/img/invite/blank.png"}FB.ui({method:"feed",name:d,link:"http://portrit.com/#/nom_id="+
a[0].nom_id+"/ref=facebook",picture:e,caption:"Click the trophy to see "+f+"'s winning photos."},function(g){if(g&&g.post_id)typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Nom Won","Shared",""]);else typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Nom Won","Not Shared",""]);$.post("/notification_read/",{notification_ids:c},function(){})})}
$(".notification_popup_cont").live("click",function(){var a=$(this).attr("value"),b=$(this).attr("read"),c=$(this).attr("won"),d="",e=$(this).attr("id").replace("notification_","");if(b=="false"||b==false||b==0||b=="0"){$(this).attr("read","true");$.post("/notification_read/",{notification_id:e},function(){})}if(c)d="/won";if(getUrlVars().nom_id!=undefined&&getUrlVars().nom_id==a){$("#nom_detail_cont").remove();nom_detail_view()}else window.location.href="#/nom_id="+a+d});
$(".notification_popup_cont").live("mouseover mouseout",function(a){var b=$(this).attr("name");if(a.type=="mouseover"){$(this).addClass("nom_cat_"+b).removeClass("color_transition");$(this).css({color:"white"});$(this).find("p").css({color:"white"});$(this).find(".kill_notification").show()}else{$(this).removeClass("nom_cat_"+b);$(this).css({color:""});$(this).find("p").css({color:""});$(this).find(".kill_notification").hide()}});
$(".kill_notification").live("click",function(a){$(this).parent().attr("read");var b=$(this).attr("value");$.post("/notification_read/",{notification_id:b,kill:true},function(){});$(this).parent().remove();a.stopPropagation();return false});
$("#clear_all_notifications").live("click",function(a){var b="",c=null;$(".notification_popup_cont").each(function(){c=$(this).attr("read");if(c=="0"||c==false||c=="false")b+=$(this).attr("id").replace("notification_","")+","});b!=""&&$.post("/notification_read/",{notification_ids:b,kill:true},function(){});$(".notification_popup_cont").remove();a.stopPropagation();return false});var footer_notification_shown=false,footer_show_first=true,notification_scroller=null;
$("#footer_notification_cont").live("click",function(){if(footer_notification_shown){$("#wrapper").die("click");$("#clear_all_notifications").hide();$("#footer").css({"overflow-y":"hidden"});$(this).css({opacity:"0.3"});$("#notification_popup").show().css({opacity:"0.0"});if(mobile){notification_scroller&&notification_scroller.destroy(false);$("#notification_footer_popup").hide()}else $("#notification_footer_popup").fadeOut("fast");footer_notification_shown=false}else{title_notification_count=0;update_title_notification_count();
$(this).css({opacity:"1.0"});$(this).children().filter("p").attr("class","");$("#footer").css({"overflow-y":"visible"});mobile?$("#notification_footer_popup").show():$("#notification_footer_popup").fadeIn("fast");$("#notification_popup").show().css({opacity:"1.0"});var a=$('.notification_popup_cont[read="false"]');if(a.length>0){var b="";setTimeout(function(){$(a).each(function(){var f=$(this).attr("read",true).attr("name");b+=$(this).attr("id").replace("notification_","")+",";$(this).removeClass("nom_cat_"+
f)});$.post("/notification_read/",{notification_ids:b},function(){})},100)}var c=new Date,d=null,e=null;$(".notification_popup_cont").each(function(){e=$(this).attr("time");e=new Date(e*1E3);d=c-e;d/=1E3;time_str=secondsToHms(parseInt(d));$(this).find(".time").text(" - "+time_str)});$(".notification_popup_cont").length>0&&$("#clear_all_notifications").show();if(mobile)notification_scroller=new iScroll("notification_footer_popup_cont");$("#wrapper").live("click",function(){footer_notification_shown=
true;$("#footer_notification_cont").click()});footer_show_first=false;footer_notification_shown=true}});var tut_on=false;
function render_tut(a){function b(){var f="";if(c==0)f="red";else if(c==1)f="orange";else if(c==2)f="yellow";else if(c>=3)f="green";return f}if(a){$("#activate_tut").css("opacity",1);$(document).bind("click",toggle_tut);tut_on=true;var c=0,d="",e="";c=3-a.nom_count;d=b(c);if(c>=3){c=3;e='<div class="tut_completed_checkmark"></div>'}else e="";d='<h3><span class="strong">Nominate</span> 3 friend\'s photos</h3><p class="'+d+'_back">'+c+"/3 Completed</p>"+e;$("#nomination_tut").html(d).attr("count",c);
c=3-a.vote_count;d=b(c);if(c>=3){c=3;e='<div class="tut_completed_checkmark"></div>'}else e="";d='<h3><span class="strong">Vote</span> on 3 friend\'s nominations</h3><p class="'+d+'_back">'+c+"/3 Completed</p>"+e;$("#vote_count_tut").html(d).attr("count",c);c=3-a.comment_count;d=b(c);if(c>=3){c=3;e='<div class="tut_completed_checkmark"></div>'}else e="";a='<h3><span class="strong">Comment</span> on 3 friend\'s nominations</h3><p class="'+d+'_back">'+c+"/3 Completed</p>"+e;$("#comment_count_tut").html(a).attr("count",
c);setTimeout(function(){$("#tutorial_cont").fadeIn()},1E3);$("#tutorial_cont").bind("click",function(){return false});$("#activate_tut").bind("click",toggle_tut);$("#skip_tut").bind("click",function(){$.post("/skip_tut/",function(){});hide_tut();$("#activate_tut").remove();tut_on=false})}else $("#tutorial_cont").remove()}
function update_tut(a){function b(h){var j="";if(h==0)j="red";else if(h==1)j="orange";else if(h==2)j="yellow";else if(h>=3)j="green";return j}var c=0,d="",e=true,f=true,g=true;if(a=="nom"){c=parseInt($("#nomination_tut").attr("count"));d=b(c+1);c+=1;c==3&&$("#nomination_tut").append('<div class="tut_completed_checkmark"></div>');if(c>=3)c=3;$("#nomination_tut > p").text(c+"/3 Completed").removeClass().addClass(d+"_back").parent().attr("count",c)}else if(a=="vote"){c=parseInt($("#vote_count_tut").attr("count"));
d=b(c+1);c+=1;c==3&&$("#vote_count_tut").append('<div class="tut_completed_checkmark"></div>');if(c>=3)c=3;$("#vote_count_tut > p").text(c+"/3 Completed").removeClass().addClass(d+"_back").parent().attr("count",c)}else if(a=="comment"){c=parseInt($("#comment_count_tut").attr("count"));d=b(c+1);c+=1;c==3&&$("#comment_count_tut").append('<div class="tut_completed_checkmark"></div>');if(c>=3)c=3;$("#comment_count_tut > p").text(c+"/3 Completed").removeClass().addClass(d+"_back").parent().attr("count",
c)}$("#activate_tut").css("opacity",1);c=parseInt($("#nomination_tut").attr("count"));if(c<3)e=false;c=parseInt($("#vote_count_tut").attr("count"));if(c<3)f=false;c=parseInt($("#comment_count_tut").attr("count"));if(c<3)g=false;if(e&&f&&g){tut_on=false;$("#context_overlay_cont").addClass("tut_completed_overlay");$("#context_overlay_cont > div").append('<h1>Congratulations!</h1><h2>You have just completed the tutorial.</h2><div id="tut_completed_middle"><img src="http://portrit.s3.amazonaws.com/img/tutorial_graphic.png"/><div class="tut_check_completed"><div class="green_checkmark"></div><p>You nominated 3 of your friend\'s photos.</p><div class="clear"></div></div><div class="tut_check_completed"><div class="green_checkmark"></div><p>You voted on 3 of your friend\'s nominations.</p><div class="clear"></div></div><div class="tut_check_completed"><div class="green_checkmark"></div><p>You commented on 3 of your friend\'s nominations.</p><div class="clear"></div></div></div><h3>You now know how to use Portrit.</h3><h3>Go nominate, vote, comment, and have fun!</h3><span id="tut_completed_go" class="sick large">Continue</span>');
show_context_overlay(true);$("#activate_tut").fadeOut();$("#tut_completed_go").bind("click",function(){$("#tut_completed_go").unbind("click");close_context_overlay()})}}function toggle_tut(){if($("#tutorial_cont").is(":hidden")){show_tut();$("#activate_tut").css("opacity",1);$(document).bind("click",toggle_tut);return false}else{hide_tut();$("#activate_tut").css("opacity",0.3);$(document).unbind("click",toggle_tut)}}function show_tut(){$("#tutorial_cont").fadeIn()}
function hide_tut(){$("#tutorial_cont").fadeOut()}
function attach_initial_tut_handlers(a){$("#close_initial_tut, #tut_go_cont span").live("click",function(){if(mobile){$("#initial_tut_cont").remove();$("#wrapper").css({opacity:"1.0","min-height":"100%"});if(!mobile||tablet)render_tut(a);init_view(update_view)}else{$("#initial_tut_cont").fadeOut(function(){$(this).remove();if(!mobile||tablet)render_tut(a);init_view(update_view)});$("#wrapper").animate({opacity:"1.0"},350,function(){$(this).css("min-height","100%")})}$("#close_initial_tut, #tut_go_cont span").die("click")});
$("#allow_notifications, #allow_portrit_album").live("click",function(){var b=false,c=$(this).attr("value");if($(this).hasClass("switch_on")){if(c=="fb_auto_post")allow_notifications=true;else if(c=="portrit_album")allow_portrit_album=true;b=true}else{if(c=="fb_auto_post")allow_notifications=false;else if(c=="portrit_album")allow_portrit_album=false;b=false}$.post("/change_user_permissions/",{permission:c,check:b},function(){})});$(".tut_point li").live("mouseover mouseout",function(b){b.type=="mouseover"?
show_like_tooltip(this):hide_like_tooltip(this)})}
function render_perms_request(){function a(){allow_portrit_album=false;$.post("/perm_request/",{action:false},function(){});$("#close_overlay").unbind("click",a)}$("#context_overlay_cont").addClass("permission_request");$("#context_overlay_cont > div").append('<div id="perms_top_cont"><div class="nom_cat_artsy"><img src="http://portrit.s3.amazonaws.com/img/fbalbum_permission.png"/></div></div><div id="perms_middle_cont"><h2>Would you like us to create a trophy photo album on your Facebook acount?</h2><p>This will hold all your winning trophies so all your friends on Facebook can see your rockin\' pics.</p></div><div id="perms_bottom_cont"><a class="sick large perm_action" value="false">No</a><a class="sick large perm_action" value="true" style="color: #99CB6E;">Yes</a></div>');show_context_overlay(true);
$("div#context_overlay").css("top",240);$(".perm_action").live("click",function(){$(".perm_action").die("click");var b=$(this).attr("value");allow_portrit_album=b=="true"?true:false;$.post("/perm_request/",{action:b},function(){});$("#close_overlay").click()});$("#close_overlay").bind("click",a)}
function render_initial_tutorial(a){mobile?$("#wrapper").css({opacity:"0.3"}):$("#wrapper").animate({opacity:"0.3"},350);var b='<div id="initial_tut_cont"><div id="initial_tut_wrap"><div id="initial_tut_top_wrap"><h1>Welcome to Portrit. Let\'s Get Started.</h1><div class="tut_point"><h2 class="tut_point_num nom_cat_fail">1</h2><h3>Nominate Your Friends</h3><p>Portrit is all about finding the best photos between you and your friends. Look through your friend\'s photos, or your own and find those rockin\' pics. Go with your gut and choose one of the trophies bellow.</p><ul><p class="tooltip"></p><li name="Hot"><div class="trophy_img medium hot"></div></li><li name="LOL"><div class="trophy_img medium lol"></div></li><li name="Artsy"><div class="trophy_img medium artsy"></div></li><li name="FAIL"><div class="trophy_img medium fail"></div></li><li name="Party Animal"><div class="trophy_img medium party_animal"></div></li><li name="Cute"><div class="trophy_img medium cute"></div></li><li name="WTF"><div class="trophy_img medium wtf"></div></li><li name="Creepy"><div class="trophy_img medium creepy"></div></li><li name="Awesome"><div class="trophy_img medium awesome"></div></li><li name="Yummy"><div class="trophy_img medium yummy"></div></li></ul><div class="clear"></div></div><div class="tut_point"><h2 class="tut_point_num nom_cat_lol">2</h2><h3>Vote On Your Favorite</h3><p>It\'s up to you and your friends to decide who earns a trophy. Take a look through all the Hot, WTF, FAIL, etc photos and give your opinion. Love it, vote it up. Hate it, vote it down.</p><img src="http://portrit.s3.amazonaws.com/img/vote.png"/><div class="clear"></div></div><div class="tut_point"><h2 class="tut_point_num nom_cat_party_animal">3</h2><h3>Build Up Your Trophy Room</h3><p>Got amazing photos? Earn trophies for your hard work. Friends see your winning photos first, so your best photos are always first to be seen. Don\'t sweat not winning, everything starts fresh the next day, so your hilarious LOLcat photo can live again.</p><img src="http://portrit.s3.amazonaws.com/img/trophy_room.png"/><div class="clear"></div></div><div id="allow_notifications_cont"><label for="allow_notifications">Allow Portrit to notify your Facebook account: </label><div id="allow_notifications" value="fb_auto_post" class="switch switch_on"></div><div class="clear"></div></div><div id="allow_portrit_album_cont"><label for="allow_portrit_album">Allow Portrit to post winning trophies back to Facebook: </label><div id="allow_portrit_album" value="portrit_album" class="switch switch_on"></div><div class="clear"></div></div></div><div id="initial_tut_bottom_wrap"><div id="tut_go_cont"><h2>Enjoy your stay.</h2><span class="sick large green">Go</span></div></div><img id="box_img" src="http://portrit.s3.amazonaws.com/img/boxtrophy.png"/><img id="landfill_img" src="http://portrit.s3.amazonaws.com/img/landfilltrophy.png"/><p id="close_initial_tut" class="close_img '+close_size+
'"></p></div></div>';$("body").append(b);if(!mobile||tablet)$(window).height()<1475&&$("#wrapper").css("min-height",1475);attach_initial_tut_handlers(a)}var portrit_friends=null,notification_data=null,allow_notifications=true,allow_portrit_album=false,server_login_timeout=null,render_perms_context=false;
function login_fb_user(){$("#cont").prepend('<div class="loading"><h1>Portrit Loading...</h1><div id="loader"><img src="http://portrit.s3.amazonaws.com/img/album-loader-dark.gif"/></div></div>');setTimeout(render_server_dead,15E3);$.post("/login_fb_user/",function(a){clearTimeout(server_login_timeout);if(a){var b=null,c=false,d=false;portrit_friends=a.portrit_friends;notification_data=a.notifications;b=a.tut_counts;allow_notifications=a.allow_notifications;c=a.first;d=a.permission_request;allow_portrit_album=
a.allow_portrit_album;if(c){$("#right_nav").prepend('<div id="activate_tut"><div id="tutorial_cont" style="display:none;"><div id="tut_arrow"></div><h1>Tutorial</h1><div id="tut_section_wrap"><div class="tut_section" id="nomination_tut"></div><div class="tut_section" id="vote_count_tut"></div><div class="tut_section" id="comment_count_tut"></div></div><a id="skip_tut" class="sick large">Skip</a></div></div>');render_initial_tutorial(b)}else{if(d){render_perms_context=true;render_perms_request()}if(b&&
(!mobile||tablet)){$("#right_nav").prepend('<div id="activate_tut"><div id="tutorial_cont" style="display:none;"><div id="tut_arrow"></div><h1>Tutorial</h1><div id="tut_section_wrap"><div class="tut_section" id="nomination_tut"></div><div class="tut_section" id="vote_count_tut"></div><div class="tut_section" id="comment_count_tut"></div></div><a id="skip_tut" class="sick large">Skip</a></div></div>');render_tut(b)}init_view(update_view)}}$(".loading").remove()})}
function render_server_dead(){$(".loading > h1").after('<div id="server_down" style="display:none;"><h2>We\'re sorry, looks like our servers are taking a much needed coffee break.</h2><h3>Please give us another chance and refresh your browser.</h3></div>');$(".loading > h1").hide();$("#server_down").fadeIn()}function load_friend_dict(a){for(var b=0;b<a.length;b++){friends[a[b].id]=a[b];friends[a[b].id].hidden=false}}
function load_friend_array(a){for(var b in a)friend_array.push({name:a[b].name,hidden:false,id:b})}
function init_view(a){if(window.sessionStorage!==undefined){me=sessionStorage.getItem("me");photo_filter=sessionStorage.getItem("photo_filter");default_view=sessionStorage.getItem("default_view");stream_view=sessionStorage.getItem("stream_view")}if(default_view===null){default_view="wall";sessionStorage.default_view=JSON.stringify(default_view)}else default_view=JSON.parse(default_view);if(stream_view===null){stream_view="recent";sessionStorage.stream_view=JSON.stringify(stream_view)}else stream_view=
JSON.parse(stream_view);if(me===null)FB.api("/me",function(c){window.sessionStorage!==undefined&&sessionStorage.setItem("me",JSON.stringify(c));me=c;$.getJSON("https://api.facebook.com/method/stream.getFilters?access_token="+fb_session.access_token+"&format=json&callback=?",function(d){for(var e=0;e<d.length;e++)if(d[e].name=="Photos"){photo_filter=d[e].filter_key;sessionStorage.photo_filter=photo_filter;break}});wait_for_message();load_user_data()});else{me=JSON.parse(me);wait_for_message();load_user_data()}if(window.sessionStorage!==
undefined)friends=sessionStorage.getItem("friends");if(friends===null)FB.api("/me/friends",function(c){friends={};load_friend_dict(c.data);load_friend_array(friends);friend_array=friend_array.sort(sort_friends);window.sessionStorage!==undefined&&sessionStorage.setItem("friends",JSON.stringify(friends));$("#header").css({"border-bottom":"1px solid #1E1E1E"});load_friends()});else{friends=JSON.parse(friends);load_friend_array(friends);friend_array=friend_array.sort(sort_friends);$("#right_nav").fadeIn();
$("#left_nav").fadeIn();$("#header").css({"border-bottom":"1px solid #1E1E1E"});load_friends()}var b=setInterval(function(){if(friends&&me){clearInterval(b);a()}},50)}
function show_search_view(){search_active=true;if(mobile){$("#search").show();$("#wrapper").css({opacity:"0.3"});$("#query").focus()}else{$("#search").fadeIn();$("#wrapper").animate({opacity:"0.3"},350,function(){$("#query").focus()})}typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Search","Shown",""]);$(document).bind("click",hide_search_view)}
function hide_search_view(){$(document).unbind("click",hide_search_view);$(".autocomplete").hide();if(mobile){$("#search").hide();$("#wrapper").css({opacity:"1.0"})}else{$("#search").fadeOut();$("#wrapper").animate({opacity:"1.0"},350)}$(".autocomplete").children().remove();$("#query").val("");search_string="";search_active=false}var load_next_clicked=false,load_prev_clicked=false;
function load_next_picture(){if(selected_photo!==""){load_next_clicked=true;load_prev_clicked=false;$("#"+selected_photo).parent().next().click()}}function load_previous_picture(){if(selected_photo!==""){load_prev_clicked=true;load_next_clicked=false;$("#"+selected_photo).parent().prev().click()}}
function load_selected(a){for(var b=0;b<friend_array.length;b++)if(friend_array[b].name===a){selected_user=get_friend_id_by_name(a);$("#profile_cont").html("");user_feed=user_books=user_movies=user_likes=user_profile=null;selected_photo=selected_album_id="";hide_search_view();update_urls()}}function sort_friends(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return c<d?-1:c>d?1:0}
function get_friend_id_by_name(a){for(var b=0;b<friend_array.length;b++)if(friend_array[b].name==a)return friend_array[b].id;return null}function format_result(a,b,c){b=get_friend_id_by_name(a);c="("+c.replace(reEscape,"\\$1")+")";a=a.replace(RegExp(c,"gi"),"<strong>$1</strong>");return a='<img class="profile_photo" src="https://graph.facebook.com/'+b+'/picture?type=square"/><p>'+a+'</p><span class="clear"></span>'}
function load_user_data(){$("#profile_pic").html('<a href="#/user='+me.id+'"><img src="https://graph.facebook.com/'+me.id+'/picture?type=square"/></a>');$("#profile_pic").after('<img src="http://static.ak.fbcdn.net/images/connect_favicon.png"/>')}
function render_friends(){var a="";var b=a="",c="",d="",e=null;friends_alpha=[];for(a=0;a<friend_array.length;a++)if(friend_array[a].hidden===false)if(friends_alpha[friend_array[a].name[0]]===undefined){friends_alpha[friend_array[a].name[0]]=[friend_array[a]];a>0&&friend_array[a-1].name.split(" ");d="has_alpha"}else{friends_alpha[friend_array[a].name[0]].push(friend_array[a]);d="no_alpha"}b=null;for(var f in friends_alpha){e=friends_alpha[f][0];b=friends_alpha[f][friends_alpha[f].length-1];if(e){c=
'<h1 class="alpha_key_wall" id="alpha_wall_'+e.name[0]+'" onclick="void(0)">'+e.name[0]+"</h1>";a='<div class="crop"><img class="friend_pic" src="https://graph.facebook.com/'+e.id+'/picture?type=large"/></div>';b='<div class="text_wrapper"><div class="text" onclick="void(0)"><h3>'+e.name.split(" ")[0]+" to "+b.name.split(" ")[0]+"</h3></div></div>";a='<div class="friend '+d+'" name="'+e.name+'" value="'+e.id+'" onclick="void(0)">'+c+b+'<div class="img_cont">'+a+"</div></div>";$("#wall_cont").append(a)}}$("#friend_cont").append('<div class="clear"></div>')}
function load_friends(){$("#login_loader").remove();for(var a=[],b=0;b<friend_array.length;b++)friend_array[b].hidden===false&&a.push(friend_array[b].name);mobile?$("#query").autocomplete({lookup:a,width:376,maxHeight:270,mobile:true,fnFormatResult:format_result,onSelect:load_selected}):$("#query").autocomplete({lookup:a,width:401,maxHeight:270,fnFormatResult:format_result,onSelect:load_selected})}
function get_user_albums(a,b,c,d,e,f,g){if(window.sessionStorage!==undefined)var h=sessionStorage.getItem("albums_"+a);if(h===null||h==="")FB.api("/"+a+"/albums?fields=count,id,name",function(j){function m(v){l===false&&$.getJSON(v.paging.next+"&callback=?",function(o){if(o.data.length>0){m(o);i=true;if(o.data.length>0)q+=",";for(var w=0;w<o.data.length;w++){k.push({album:o.data[w],photos:null});n=o.data[w].id;q+=w<o.data.length-1?n+",":n}}else{if(i===false){if(o.data.length>0)q+=",";for(w=0;w<o.data.length;w++){k.push({album:o.data[w],
photos:null});n=o.data[w].id;q+=w<o.data.length-1?n+",":n}}l=true;if(window.sessionStorage!==undefined)sessionStorage["albums_"+a]=JSON.stringify(k);FB.api("/"+a+"/photos?fields=height,width,picture,source,id&limit="+b,function(z){k=JSON.parse(sessionStorage.getItem("albums_"+a));k[0].photos=k[0].photos.concat(z.data);sessionStorage.setItem("albums_"+a,JSON.stringify(k));render_tagged_album(z.data)});if(k.length>0)FB.api("/photos/?fields=height,width,picture,source,id&limit="+b+"&ids="+q,function(z){selected_user=
a;k=JSON.parse(sessionStorage.getItem("albums_"+a));for(var C in z)if(C!=="error")for(var D=z[C],E=C,A=0;A<k.length;A++)if(k[A].album.id===E)k[A].photos=D.data;window.sessionStorage!==undefined&&sessionStorage.setItem("albums_"+a,JSON.stringify(k));if(c!==undefined){if(f===true){albums=k;setTimeout(c,g)}else if(e){albums=k;c(d,offset)}else{albums=k;c(d)}get_user_noms()}});else{albums=k;c(d);get_user_noms()}}})}var l=false,i=false;if(j.data==undefined)return false;var k=[],n=null,q="";k.push({album:{id:"tagged",
name:"Tagged Pictures"},photos:[]});for(var u=0;u<j.data.length;u++){k.push({album:j.data[u],photos:null});n=j.data[u].id;q+=u<j.data.length-1?n+",":n}if(j.data.length>0)m(j);else{albums=k;c(d);get_user_noms()}});else{albums=JSON.parse(h);if(albums[0].photos==null||albums[0].photos==false||albums[0].photos.length==0)FB.api("/"+a+"/photos?fields=height,width,picture,source,id&limit="+b,function(j){h=JSON.parse(sessionStorage.getItem("albums_"+a));h[0].photos=h[0].photos.concat(j.data);sessionStorage.setItem("albums_"+
a,JSON.stringify(h));render_tagged_album(j.data)});if(c!==undefined){f===true?setTimeout(c,g):c(d);get_user_noms()}}}function get_user_videos(a,b){FB.api("/"+a+"/videos/",function(c){user_videos=c.data;b!==undefined&&b()})}
if(mobile){$(".main_control").live("touchend",main_control_click);$("#friend_view").live("touchend",friend_view_click);$("#wall_view").live("touchend",wall_view_click);$("#profile_view").live("touchend",profile_view_click);$("#top_noms").live("touchend",top_noms_click);$("#recent_noms").live("touchend",recent_noms_click)}else{$(".main_control").live("click",main_control_click);$("#friend_view").live("click",friend_view_click);$("#wall_view").live("click",wall_view_click);$("#profile_view").live("click",
profile_view_click);$("#top_noms").live("click",top_noms_click);$("#recent_noms").live("click",recent_noms_click)}function main_control_click(){$(".main_control_active").removeClass("main_control_active");$(this).addClass("main_control_active")}
function friend_view_click(){if(default_view!="friend"){default_view="friend";sessionStorage.removeItem("default_view");sessionStorage.setItem("default_view",JSON.stringify(default_view));if(window.location.hash=="#/"||window.location.hash=="#"||window.location.hash==""){var a=getUrlVars();clear_canvas(a);clear_event_handles();attach_main_handlers();attach_profile_handlers();main_view();$("html, body").scrollTop(0)}else window.location.hash="#/"}}
function wall_view_click(){if(default_view!="wall"){default_view="wall";sessionStorage.removeItem("default_view");sessionStorage.setItem("default_view",JSON.stringify(default_view));if(window.location.hash=="#/"||window.location.hash=="#"||window.location.hash==""){var a=getUrlVars();clear_canvas(a);clear_event_handles();attach_profile_handlers();main_view();$("html, body").scrollTop(0)}else window.location.hash="#/"}}
function profile_view_click(){if(default_view!="profile"){default_view="profile";sessionStorage.removeItem("default_view");sessionStorage.setItem("default_view",JSON.stringify(default_view));if(window.location.hash=="#/"||window.location.hash=="#"||window.location.hash==""){var a=getUrlVars();clear_canvas(a);clear_event_handles();attach_profile_handlers();main_view();$("html, body").scrollTop(0)}else window.location.hash="#/"}}
function top_noms_click(){if(stream_view!="top_noms"){stream_view="top_noms";sessionStorage.removeItem("stream_view");sessionStorage.setItem("stream_view",JSON.stringify(stream_view));$("#recent_noms").removeClass("selected");$(this).addClass("selected");$("#profile_cont_wrap").html('<div id="scroller"><div id="profile_cont"></div></div>');main_view();$("html, body").scrollTop(0);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Top Noms","Click",""])}}
function recent_noms_click(){if(stream_view!="recent_noms"){stream_view="recent_noms";sessionStorage.removeItem("stream_view");sessionStorage.setItem("stream_view",JSON.stringify(stream_view));$("#top_noms").removeClass("selected");$(this).addClass("selected");$("#profile_cont_wrap").html('<div id="scroller"><div id="profile_cont"></div></div>');main_view();$("html, body").scrollTop(0);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Recent Noms","Shown",""])}}var added_swipe_once=false;
function main_view(){view_active="main";user_books=user_movies=user_likes=user_profile=null;selected_album_id=selected_user="";albums=null;photo_comment_cache={};$("#main_view_control").remove();var a="",b="",c="";if(default_view=="friend")a="main_control_active";else if(default_view=="wall")b="main_control_active";else if(default_view=="profile")c="main_control_active";var d="";d=mobile?"":'<a class="sick red large" id="show_upload">Post Photo</a>';a='<div id="main_view_control"><a id="friend_view" class="main_control sick large '+
a+'">Friends</a><a id="wall_view" class="main_control sick large '+b+' ">Stream</a><a id="profile_view" class="main_control sick large '+c+'">Profile</a>'+d+"</div>";$("#cont").prepend(a);if(default_view==="friend"){$("#wall_cont").hide();render_friends();if(mobile)$("#wall_cont").show();else{$("#wall_cont").css({"max-width":"960px"});$("#wall_cont").fadeIn(300)}}else if(default_view==="wall"){$("#user_profile_cont").remove();$(".friend").remove();if($("#wall_cont #profile_wrap").length==0){$("#wall_cont").hide();
a='<div id="profile_wrap"><div id="tab_nav"><div id="activate_recent_winners">Recent Winners</div><div id="activate_latest_photos">Latest Photos</div></div><ul><h1 id="active_stream_view" name="active_nominations">Active Nominations</h1><div class="clear"></div></ul><div id="active_stream_text_cont"><a id="top_noms" class="sick large">Top</a><a id="recent_noms" class="sick large">Most Recent</a></div><div class="clear"></div><div id="profile_cont_wrap"><div id="scroller"><div id="profile_cont"></div></div></div></div>';
$("#wall_cont").append(a);if(mobile)$("#wall_cont").show();else{$("#wall_cont").css({"max-width":""});$("#wall_cont").fadeIn()}stream_view=="top_noms"?$("#top_noms").addClass("selected"):$("#recent_noms").addClass("selected")}$("#profile_cont").hide();stream_view=="top_noms"?init_profile_view():init_recent_view()}else if(default_view==="profile"){$("#wall_cont").hide();a='<div id="user_profile_cont"><div id="profile_nav_cont" value="albums"><h2>Albums</h2><p id="album_left_arrow" style="display:none;"></p><p id="album_right_arrow"></p></div><div id="user_profile"></div><div id="album_cont" style="display:none;"></div></div>';
$("#wall_cont").append(a);selected_user="me";get_user_albums("me",5,render_albums);get_user_videos("me");render_user_profile();attach_album_handlers();attach_user_profile_handlers();if(mobile)$("#wall_cont").show();else{$("#wall_cont").css({"max-width":""});$("#wall_cont").fadeIn(300)}}$("#wall_cont").show();$("#friend_cont").show()}var user_noms_won={};
function get_users_trophies(a,b){user_noms_won[a]==undefined?$.getJSON("/get_user_trophies/",{user:a},function(c){user_noms_won[a]=c;b(c)}):b(user_noms_won[a])}
function render_user_trophies(a){var b="";b="";for(var c=0;c<a.length;c++){b=a[c].cat_name.replace(" ","_").toLowerCase();b='<div class="trophy_cont nom_cat_'+b+'_hover"><a href="#/trophy/user=me/trophy='+b+'"><img src="http://portrit.s3.amazonaws.com/img/trophies/medium/'+b+'.png"/><div class="trophy_win_count"><p class="nom_cat_'+b+'">'+a[c].count+"</p></div></a></div>";$("#profile_right_cont").append(b)}}
function render_user_profile(){var a="";a="";if(portrit_friends.length>0)for(var b=0;b<portrit_friends.length;b++)a+='<a href="#/user='+portrit_friends[b].id+'" name="'+portrit_friends[b].name+'"><img src="https://graph.facebook.com/'+portrit_friends[b].id+'/picture?type=square"/></a>';else a="<h3>None of your facebook friends are on Portrit. Send them a invitation by nominating their photos.</h2>";a='<div id="profile_left_cont"><h1>Profile</h1><div id="profile_user_info"><img src="https://graph.facebook.com/'+
me.id+'/picture?type=square"/><div id="profile_tab"><h2>Welcome '+me.name.split(" ")[0]+'</h2></div></div><div id="user_friends"><h2>Friends on Portrit</h2><div class="clear"></div><p class="tooltip"></p>'+a+'<div class="clear"></div></div></div><div id="profile_right_cont"><h2>Your Active Nominations</h2></div><div class="clear"></div>';$("#user_profile").append(a);append_load($("#profile_right_cont"),"dark");get_users_active_noms(me.id,render_user_noms)}
function get_users_active_noms(a,b){$.getJSON("/get_users_active_noms/",{id:a},function(c){b(c)})}
function render_user_noms(a){remove_load();if(a.length>0){var b="";for(var c=b="",d="",e="",f=0,g=0,h=0;h<a.length;h++){d=a[h].nomination_category;e=d.replace(" ","_").toLowerCase();b=a[h].nominator==me.id?"You":friends[a[h].nominator]==undefined?"":friends[a[h].nominator].name;if(a[h].nominatee==me.id)c=a[h].nominator==me.id?"Yourself":"You";g=a[h].photo.small_height/2-25;f=a[h].photo.small_width/2-38;b='<div class="active_nom_cont nom_cat_'+e+'"><div class="active_nom_cont_left" style="margin-top: '+
g+'px;"><a href="/#/user='+a[h].nominator+'"><img class="active_nom_nominator" src="https://graph.facebook.com/'+a[h].nominator+'/picture?type=square"/></a><p><a href="/#/user='+a[h].nominator+'">'+b+"</a> nominated "+c+' for <span class="strong">'+d+'</span></p></div><a href="/#/nom_id='+a[h].id+'"><p class="active_vote_count nom_cat_'+e+'" style="right: '+f+'px;">Votes: <span class="strong">'+a[h].vote_count+'</span></p><div class="trophy trophy_img small '+e+'"></div><img class="active_nom_photo" src="'+
a[h].photo.src_small+'" style="height: '+a[h].photo.small_height+"px; width: "+a[h].photo.small_width+'px;"/></a><div class="clear"></div></div>';$("#profile_right_cont").append(b)}}else $("#profile_right_cont").append("<p>You have no active nominations.</p>")}function sort_noms_list_by_votes(a){a.sort(function(b,c){return c.vote_count-b.vote_count});return a}
function sort_noms_by_votes(a,b){for(var c=[],d=0;d<b.length;d++)c.push(a[b[d]]);c.sort(function(e,f){return f.vote_count-e.vote_count});b=[];for(d=0;d<c.length;d++)b.push(c[d].id);return b}
function nom_detail_view(a,b){view_active="nom_detail";var c=getUrlVars().nom_id,d=getUrlVars().won,e=getUrlVars().user,f=getUrlVars().trophy,g=null,h=null;nom_in_cat=noms_in_cat=null;nom_winning_text=voted_cont_html=comment_cont_html=nom_bottom_cont_html=nom_main_cont_html=nom_stream_html="";selected_nom_photo=null;vote_class=trophy_size="";vote_tooltip_text="Already voted";nom_cat_underscore=title="";if(typeof b!=="undefined"&&b==true&&a[0].won==false){g=a[0];h=noms_in_cat=a;vote_class="won";vote_tooltip_text=
"Inactive";var j=c="";c=friends[g.nominatee]?friends[g.nominatee].name:g.nominatee==me.id?"Your":"";if(c=="Your")j=c;else if(c!="")j=c.split(" ")[0]+"'s";title='<h1 class="title" name="'+g.nomination_category+'"><a href="/#/user='+g.nominatee+'">'+j+'</a> Inactive <span class="nom_cat_'+g.nomination_category.replace(" ","_").toLowerCase()+'_text">'+g.nomination_category+"</span> Photo</h1>"}else if(f!=undefined&&e!=undefined){d=true;g=a[0];h=noms_in_cat=a;vote_class="won";vote_tooltip_text="Already won";
j=c="";c=friends[g.nominatee]?friends[g.nominatee].name:g.nominatee==me.id?"Your":"";if(c=="Your")j=c;else if(c!="")j=c.split(" ")[0]+"'s";title='<h1 class="title" name="'+g.nomination_category+'"><a href="/#/user='+g.nominatee+'">'+j+'</a> Winning <span class="nom_cat_'+g.nomination_category.replace(" ","_").toLowerCase()+'_text">'+g.nomination_category+"</span> Photos</h1>"}else if(d!=undefined&&e!=undefined){d=true;g=a[0];h=noms_in_cat=a;vote_class="won";vote_tooltip_text="Already won";j="Your";
title='<h1 class="title" name="'+g.nomination_category+'"><a href="/#/user='+g.nominatee+'">'+j+"</a> Winning Photos</h1>"}else if(d!=undefined){d=true;g=winning_noms_cache[c];h=winning_noms_cache;vote_class="won";vote_tooltip_text="Already won";c="";c=friends[g.nominatee]?friends[g.nominatee].name:g.nominatee==me.id?"Your":"";j="";if(c=="Your")j=c;else if(c!="")j=c.split(" ")[0]+"'s";title='<h1 class="title" name="'+g.nomination_category+'"><a href="/#/user='+g.nominatee+'">'+j+'</a> Winning <span class="nom_cat_'+
g.nomination_category.replace(" ","_").toLowerCase()+'_text">'+g.nomination_category+"</span> Photo</h1>"}else{g=active_noms_cache[c];if(g==undefined)if(isEmpty(winners_feed)){get_user_feed(nom_detail_view,"won");return}else{d=true;g=winning_noms_cache[c];noms_in_cat=winning_nom_cats_map[g.nomination_category.replace(" ","_").toLowerCase()];h=winning_noms_cache;title='<h1 class="title" name="'+g.nomination_category+'">Winning <span class="nom_cat_'+g.nomination_category.replace(" ","_").toLowerCase()+
'_text">'+g.nomination_category+"</span> Photo</h1>"}else{noms_in_cat=active_nom_cats_map[g.nomination_category.replace(" ","_").toLowerCase()];h=active_noms_cache;title='<h1 class="title" name="'+g.nomination_category+'">Active <span class="nom_cat_'+g.nomination_category.replace(" ","_").toLowerCase()+'_text">'+g.nomination_category+"</span> Nominations</h1>"}}c="";c=friends[g.nominatee]?friends[g.nominatee].name:g.nominatee==me.id?d?"You":"You're":"";if(f||d&&e){nom_stream_html='<div id="nom_cat_stream"><div class="prev_photo"><div class="prev_photo_img"></div></div><div class="next_photo"><div class="next_photo_img"></div></div>';
for(j=0;j<h.length;j++){nom_in_cat=h[j];if(nom_in_cat.id==g.id){selected_nom_photo="nom_photo_"+nom_in_cat.id;nom_stream_html+='<div id="nom_photo_'+nom_in_cat.id+'" class="nom_photo_thumbnail" style="height:'+nom_in_cat.photo.small_height+'px; opacity: 1.0;" name="selected"><img src="'+nom_in_cat.photo.src_small+'"/></div>'}else nom_stream_html+='<div id="nom_photo_'+nom_in_cat.id+'" class="nom_photo_thumbnail" style="height:'+nom_in_cat.photo.small_height+'px; opacity: 0.6;"><img src="'+nom_in_cat.photo.src_small+
'"/></div>'}nom_stream_html+="</div>"}else if(!d&&typeof b==="undefined"){nom_stream_html='<div id="nom_cat_stream"><div class="prev_photo"><div class="prev_photo_img"></div></div><div class="next_photo"><div class="next_photo_img"></div></div>';noms_in_cat=sort_noms_by_votes(h,noms_in_cat);for(j=0;j<noms_in_cat.length;j++){nom_in_cat=h[noms_in_cat[j]];if(nom_in_cat.id==g.id){selected_nom_photo="nom_photo_"+nom_in_cat.id;nom_stream_html+='<div id="nom_photo_'+nom_in_cat.id+'" class="nom_photo_thumbnail" style="height:'+
nom_in_cat.photo.small_height+'px; opacity: 1.0;" name="selected"><img src="'+nom_in_cat.photo.src_small+'"/><p class="nom_cat_'+nom_in_cat.nomination_category.replace(" ","_").toLowerCase()+'">'+getGetOrdinal(j+1)+"</p></div>"}else nom_stream_html+='<div id="nom_photo_'+nom_in_cat.id+'" class="nom_photo_thumbnail" style="height:'+nom_in_cat.photo.small_height+'px; opacity: 0.6;"><img src="'+nom_in_cat.photo.src_small+'"/><p class="nom_cat_'+nom_in_cat.nomination_category.replace(" ","_").toLowerCase()+
'">'+getGetOrdinal(j+1)+"</p></div>"}nom_stream_html+="</div>"}else nom_stream_html="";nom_winning_text=g.won?"Won":g.active?"Nominated for":"Lost";var m=j="";m=g.nominator==me.id?"You":g.nominator_name?g.nominator_name:friends[g.nominator]?friends[g.nominator].name:"";if(g.caption)j="Caption: "+g.caption;trophy_size="large";nom_cat_underscore=g.nomination_category.replace(" ","_").toLowerCase();nom_main_cont_html='<div id="main_nom_cont" value="'+g.id+'"><div id="main_nom_cont_left"><div id="main_nom_cont_left_wrap"><img id="main_nom_photo" src="'+
g.photo.src+'"/><div id="nominator_overlay_cont"><a href="/#/user='+g.nominator+'"><img class="user_img" src="https://graph.facebook.com/'+g.nominator+'/picture?type=square"/></a><h2>Nominated by <span class="strong"><a href="/#/user='+g.nominator+'">'+m+"</a></span></h2><p>"+j+'</p></div></div></div><div id="main_nom_cont_right"><div id="main_nom_cont_right_wrap"><h2>Votes</h2><div id="vote_cont"><div id="vote_cont_left"><p class="tooltip"></p><span class="vote vote_up '+vote_class+'" value="'+g.id+
'" name="'+vote_tooltip_text+'"></span><span class="vote vote_down '+vote_class+'" value="'+g.id+'" name="'+vote_tooltip_text+'"></span><p id="nom_vote_count">'+g.vote_count+'</p></div><div class="clear"></div></div><div id="trophy_cont" class="nom_cat_'+nom_cat_underscore+'"><div id="nomination_text_cont"><a href="/#/user='+g.nominatee+'"><img class="user_img" src="https://graph.facebook.com/'+g.nominatee+'/picture?type=square"/><span class="strong">'+c+"</span></a><p>"+nom_winning_text+"</p><h3>"+
g.nomination_category+'</h3><div id="nom_trophy_icon" class="trophy_img '+trophy_size+" "+nom_cat_underscore+'"></div></div></div></div></div><div class="clear"></div></div>';nom_bottom_cont_html='<div id="main_nom_bottom_cont"><div id="nom_comments_cont"><div id="comment_heading_cont"><h2>Comments</h2><span class="sick large" id="add_new_comment">New Comment</span><div class="clear"></div></div><div id="new_comment_cont"><div class="comment_top_head"><a class="sick large post_new_comment">Post</a><a class="sick large cancel_new_comment">Close</a></div><textarea class="comment_body"></textarea></div></div><div id="nom_votes_cont"><h2 id="voted_heading">Voted</h2><div id="nom_votes_wrap" class="voted_cont"><p class="tooltip"></p></div>';
c='<div id="nom_detail_cont">'+title+nom_main_cont_html+nom_stream_html+nom_bottom_cont_html+"</div>";$("#canvas_cont").append(c);slide_images=$(".nom_photo_thumbnail");var l=[],i=0,k=0,n=false;c=$("#nom_cat_stream").width()/2;$(slide_images).each(function(v){k=f||d&&e?parseInt(h[v].photo.small_width):parseInt(h[noms_in_cat[v]].photo.small_width);if($(this).attr("name")==="selected"){i+=k/2;n=true}else if(n===false)i+=k+20;l.push(k+20)});var q=0,u=c-i;$(slide_images).each(function(v){$(this).css({left:q+
u,top:0});q+=l[v]});get_nom_comments(g.id,d,f);render_nom_votes(g.votes)}var get_votes_timeout=null;function get_nom_votes(a){clearTimeout(get_votes_timeout);get_comment_timeout=setTimeout(function(){$("#nom_votes_wrap a").remove();$("#nom_votes_wrap").append('<img id="votes_loading" src="http://portrit.s3.amazonaws.com/img/ajax-loader-light.gif"/>');$.getJSON("/get_nom_votes/",{nom_id:a},function(b){clearTimeout(get_votes_timeout);$("#votes_loading").remove();render_nom_votes(b)})},300)}
var get_comment_timeout=null;function get_nom_comments(a){$(".comment, .comment_empty").remove();$("#loader").length==0&&append_load($("#nom_comments_cont"),"light");$.getJSON("/get_nom_comments/",{nom_id:a},function(b){clearTimeout(get_comment_timeout);remove_load("fade");setTimeout(function(){render_nom_comments(b)},300)})}
function render_nom_votes(a){for(var b="",c="",d=false,e=getUrlVars().won,f=getUrlVars().trophy,g=0;g<a.length;g++){c=a[g].vote_name;b+='<a href="#/user='+a[g].vote_user+'" class="clear_profile" id="voted_'+a[g].vote_user+'" name="'+c+'"><img src="https://graph.facebook.com/'+a[g].vote_user+'/picture?type=square"/></a>';if(a[g].vote_user==me.id)d=true}if(e!=undefined||f!=undefined)$(".vote").addClass("won").attr("name","Already won");else d?$(".vote").addClass("won").attr("name","Already voted"):
$(".vote").removeClass("won");$("#nom_votes_wrap").append(b)}
function render_nom_comments(a){var b="",c="",d=null,e=null;$(".comment_empty").remove();if(a.length>0)for(var f=0;f<a.length;f++){b=a[f].comments.owner_name;e=new Date;d=new Date(a[f].comments.create_datetime*1E3);e-=d;e/=1E3;d=secondsToHms(parseInt(e));c+='<div class="comment"><p class="comment_time" value="'+a[f].comments.create_datetime+'">'+d+'</p><a href="#/user='+a[f].comments.owner_id+'" class="clear_profile"><img class="user_photo" src="https://graph.facebook.com/'+a[f].comments.owner_id+
'/picture?type=square"/></a><a href="#/user='+a[f].comments.owner_id+'" class="post_username from_username clear_profile">'+b+"</a><p>"+a[f].comments.comment+"</p></div>"}else c='<div class="comment_empty"><h2>No comments yet. Be the first!</h2></div>';$("#nom_comments_cont").append(c)}
function trophy_view(a){a=getUrlVars();var b=a.user;a=a.trophy;if(b=="me")b=me.id;append_load($("#wall_cont"),"dark");$.get("/get_trophy_wins/",{user:b,cat:a},function(c){remove_load();winning_noms_cache={};for(var d=0;d<c.length;d++)winning_noms_cache[c[d].id]=c[d];nom_detail_view(c)})}
function render_alpha_wall(a){var b="";var c=b="",d="",e=true,f="";mobile||(f='<a class="sick red large" id="show_upload">Post Photo</a>');$("#main_view_control").length==0&&$("#cont").prepend('<div id="main_view_control"><a id="friend_view" class="main_control sick large main_control_active">Friends</a><a id="wall_view" class="main_control sick large  ">Stream</a><a id="profile_view" class="main_control sick large ">Profile</a>'+f+"</div>");$("#wall_cont").show();$("#friend_cont").show();$("#wall_cont").css({"max-width":"960px"});
for(f=0;f<friend_array.length;f++)if(friend_array[f].hidden===false){d="";if(e==true&&friend_array[f].name[0]==a){d='<h1 class="alpha_key_wall" id="alpha_wall_'+friend_array[f].name[0]+'" onclick="void(0)">'+friend_array[f].name[0]+"</h1>";e=false}if(friend_array[f].name[0]==a){b='<div class="crop"><img class="friend_pic" src="https://graph.facebook.com/'+friend_array[f].id+'/picture?type=large"/></div>';c='<div class="text_wrapper"><div class="text" onclick="void(0)"><h3>'+friend_array[f].name+"</h3></div></div>";
b='<div class="friend " name="'+friend_array[f].name+'" value="'+friend_array[f].id+'">'+d+'<div class="img_cont">'+b+c+"</div></div>";$("#wall_cont").append(b)}}}
function render_fav_friend_albums(){for(var a="",b="",c=0;c<albums.length;c++){b=albums[c].album.count;var d="";if(b!=undefined)d=albums[c].album.count<=1?" Photo":" Photos";else b=0;b='<div class="album_text_wrapper"><div class="text" onclick="void(0)"><h3>'+albums[c].album.name+'</h3></div><div class="album_controls"><h3>'+b+d+"</h3></div></div>";a+=albums[c].album.id!="tagged"?'<div class="photo_album" id="'+albums[c].album.id+'" value="'+selected_user+'"><div class="album_clip"><img class="album_pic" src="https://graph.facebook.com/'+
albums[c].album.id+"/picture?access_token="+fb_session.access_token+'"/>'+b+"</div></div>":'<div class="photo_album" id="'+albums[c].album.id+'" value="'+selected_user+'"><div class="album_clip"><img class="album_pic" src="'+albums[c].photos[0].picture+'"/>'+b+"</div></div>"}$('.fav_friend_albums[value="'+selected_user+'"]').append(a)}
function render_tagged_album(a){if(a.length>0)for(var b=0;b<3;b++){$("#tagged > .img_thumbs").append('<img class="img_thumb img_thumb_'+b+'" id="'+a[b].id+'" src="'+a[b].picture+'"/>');$("#tagged > .album_ajax_loader").remove()}}
function render_albums(a){var b=null,c=0,d="";if(a==undefined)a=0;selected_user!="me"?$("#album_cont").html('<div id="active_cont"><h1>Active Nominations</h1></div><div id="trophy_cont"><h1>Trophy Room</h1></div>'):$("#album_cont").html('<div id="trophy_cont"><h1>Trophy Room</h1></div>');if(albums.length>1){$("#album_cont").append("<h1>Facebook Albums</h1>");for(a=a;a<albums.length;a++){if(albums[a].album.name!="Portrit Trophies"&&albums[a].album.name!="Portrit Photos"){d+='<div class="photo_album" id="'+
albums[a].album.id+'" onclick="void(0)"><div class="img_thumbs">';b=albums[a];c=3;if(albums[a].photos){if(albums[a].photos.length<c)c=albums[a].photos.length;for(var e=0;e<c;e++)d+='<img class="img_thumb img_thumb_'+e+'" id="'+b.photos[e].id+'" src="'+b.photos[e].picture+'"/>'}d+='</div><div class="album_title">'+albums[a].album.name+"</div></div>"}if(a>=6)break}$("#album_cont").append(d);a>=6&&$("#album_cont").append('<a id="load_more_fb_albums" class="sick_abs large red">Load More</a>')}else $("#album_cont").html('<h2 class="alert_title">I\'m sorry. It seems this friend has their photos set to private.</h2>');
mobile||get_user_videos(getUrlVars().user,render_video_album)}
function load_more_fb_albums(a){var b=null,c=0,d="";for(a=a;a<albums.length;a++)if(albums[a].album.name!="Portrit Trophies"){d+='<div class="photo_album" id="'+albums[a].album.id+'" onclick="void(0)"><div class="img_thumbs">';b=albums[a];c=3;if(albums[a].photos){if(albums[a].photos.length<c)c=albums[a].photos.length;for(var e=0;e<c;e++)d+='<img class="img_thumb img_thumb_'+e+'" id="'+b.photos[e].id+'" src="'+b.photos[e].picture+'"/>'}d+='</div><div class="album_title">'+albums[a].album.name+"</div></div>"}$(".photo_album:last").after(d)}
function hide_more_fb_albums(a){$(".photo_album:gt("+a+")").remove()}
function render_video_album(){var a=0;a="";if(user_videos){if(user_videos.length>0){a='<div class="photo_album" id="video_album"><div class="img_thumbs"></div><div class="album_title">Videos</div></div>';$(".photo_album:last").after(a);a=4;if(user_videos.length<a)a=user_videos.length;for(var b=0;b<a;b++)$("#video_album > .img_thumbs").append('<img class="img_thumb_'+b+'" id="'+user_videos[b].id+'" src="'+user_videos[b].picture+'"/>')}typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Video_Album",
"Shown",""])}}function album_cont_reset(){$("#album_cont").css({position:"",width:"",left:"",right:""});$("#album_cont").show()}
function render_active_photo_noms(a){var b=getUrlVars().user;if(b!=me.id&&b!="me"&&b!=undefined){b=friends[b].name.split(" ")[0];var c="";c="";if(a.active_nom_objs.length>0)for(b=0;b<a.active_nom_objs.length;b++){c=a.active_nom_objs[b].nomination_category.replace(" ","_").toLowerCase();c='<div class="active_nom_cont"><div class="active_left_cont nom_cat_'+c+'"></div><div class="active_img_cont"><a href="/#/nom_id='+a.active_nom_objs[b].id+'"><img class="active_nom_image" src="'+a.active_nom_objs[b].photo.src+
'"/></a></div><div class="active_comment_cont"><a href="/#/nom_id='+a.active_nom_objs[b].id+'"><p>Comments: <span class="strong">'+a.active_nom_objs[b].comment_count+'</span></p></a></div><div class="active_vote_cont"><a href="/#/nom_id='+a.active_nom_objs[b].id+'"><p>Votes: <span class="strong">'+a.active_nom_objs[b].vote_count+'</span></p></a></div><div class="active_trophy_img trophy_img medium '+c+'"></div><div class="clear"></div></div>';$("#active_cont").append(c)}else $("#active_cont").append("<h2>"+
b+" has no active nominations.")}}
function render_winning_photo_noms(a){if(a.winning_nom_objs.length>0){for(var b=3,c="",d={},e=0;e<a.winning_nom_objs.length;e++)if(d[a.winning_nom_objs[e].nomination_category]==undefined)d[a.winning_nom_objs[e].nomination_category]={noms:[a.winning_nom_objs[e]]};else d[a.winning_nom_objs[e].nomination_category].noms.push(a.winning_nom_objs[e]);for(var f in d){a=d[f].noms;c=f.replace(" ","_").toLowerCase();if(a.length<b)b=a.length;album_html='<div class="trophy_album" name="'+f+'" onclick="void(0)"><div class="img_thumbs">';
for(e=0;e<b;e++)album_html+='<img class="img_thumb img_thumb_'+e+'"  src="'+a[e].photo.src_small+'"/>';album_html+='</div><div class="trophy_img large '+c+'"></div><div class="trophy_count nom_cat_'+c+'">'+a.length+"</div></div>";$("#trophy_cont").append(album_html)}}else{b=getUrlVars().user;if(b!=undefined&&b!=me.id&&b!="me"){b=friends[b].name.split(" ")[0];$("#trophy_cont").append("<h2>"+b+" has not won any trophies. Help "+b+" out by nominating a photo.</h2>")}else $("#trophy_cont").append("<h2>You have not won any trophies. Nominate some of your photos for a chance to earn a trophy.</h2>")}}
function render_portrit_photos(a){if(typeof a.portrit_album_data.photos!=="undefined"&&a.portrit_album_data.photos.length>0){var b=6,c='<div id="portrit_photo_cont"><h1>Portrit Photos</h1><div id="portrit_photos">';if(a.portrit_album_data.photos.length<b)b=a.portrit_album_data.photos.length;for(var d=0;d<b;d++)c+='<div class="portrit_photo"><img src="'+a.portrit_album_data.photos[d].picture+'"/></div>';c+='<a id="to_portrit_photos">View All</a></div></div>';$("#trophy_cont").after(c)}}
function update_user_albums(a){if(typeof a!=="undefined"&&typeof a.photos!=="undefined"&&a.photos.length>0){for(var b=0;b<albums.length;b++)if(albums[b].album.id=="portrit-photos")albums[b].photos=a.photos;albums.push({album:{id:"portrit-photos",name:a.album_name,count:a.photos.length},photos:a.photos})}}var winning_user_album_cache={},winning_user_photo_dict={};
function update_user_album_nom_cache(a){winning_user_album_cache={};for(var b=0;b<a.length;b++){if(winning_user_album_cache[a[b].photo.album_fid]==undefined)winning_user_album_cache[a[b].photo.album_fid]=[{fid:a[b].photo.fid,cat:a[b].nomination_category}];else winning_user_album_cache[a[b].photo.album_fid].push({fid:a[b].photo.fid,cat:a[b].nomination_category});winning_user_photo_dict[a[b].photo.fid]={cat:a[b].nomination_category,nom_id:a[b].id}}}var active_user_nom_cache={};
function update_user_active_nom_cache(a){active_user_nom_cache={};for(var b=0;b<a.length;b++)if(a[b].photo.fid)active_user_nom_cache[a[b].photo.fid]={nom_id:a[b].id,cat:a[b].nomination_category};else active_user_nom_cache[a[b].photo.id]={nom_id:a[b].id,cat:a[b].nomination_category}}
function get_user_noms(){var a=getUrlVars().user;if(a=="me"||a==undefined)a=me.id;if(user_winning_noms_cache[selected_user]==undefined){$("#active_cont").append('<img class="data_loading" src="http://portrit.s3.amazonaws.com/img/album-loader-dark.gif"/>');$("#trophy_cont").append('<img class="data_loading" src="http://portrit.s3.amazonaws.com/img/album-loader-dark.gif"/>');$.getJSON("/get_user_album_nom_data/",{user:a},function(b){$(".data_loading").remove();if(b){user_winning_noms_cache[selected_user]=
b;update_user_album_nom_cache(b.winning_nom_objs);update_user_active_nom_cache(b.active_nom_objs);update_user_albums(b.portrit_album_data);if(view_active=="album"||view_active=="main"&&default_view==="profile"){render_active_photo_noms(b);render_winning_photo_noms(b);render_portrit_photos(b)}else if(view_active=="list"){winning_user_album_cache[selected_album_id]!=undefined&&render_list_view_trophies(winning_user_album_cache[selected_album_id]);getUrlVars().album=="portrit-photos"&&init_list_view()}else if(view_active==
"gallery"){winning_user_album_cache[selected_album_id]!=undefined&&render_list_view_trophies(winning_user_album_cache[selected_album_id]);if(getUrlVars().album=="portrit-photos"){init_list_view(true);photo_gallery_view()}}}})}else if(view_active=="album"||view_active=="main"&&default_view==="profile"){update_user_album_nom_cache(user_winning_noms_cache[selected_user].winning_nom_objs);render_active_photo_noms(user_winning_noms_cache[selected_user]);render_winning_photo_noms(user_winning_noms_cache[selected_user]);
update_user_albums(user_winning_noms_cache[selected_user].portrit_album_data);render_portrit_photos(user_winning_noms_cache[selected_user])}else view_active=="list"&&winning_user_album_cache[selected_album_id]!=undefined&&render_list_view_trophies(winning_user_album_cache[selected_album_id])}
function render_list_view_trophies(a){for(var b="",c=0;c<a.length;c++){b=a[c].cat.replace(" ","_").toLowerCase();view_active=="gallery"?$("#"+a[c].fid).parent().append('<div class="trophy_cat trophy_img medium '+b+'"></div>'):$("#"+a[c].fid).parent().css({position:"relative",left:"0px"}).append('<div class="trophy_cat trophy_img medium '+b+'"></div>')}}
function main_photo_view(){var a=getUrlVars().user,b="";if(a==="me")b=me.name;else if(friends[a]==undefined){$("#user_photo_view").remove();FB.api("/"+a+"/",function(d){b=d.name;$("#title > h3").text(b);$("#profile_cont_wrap > h1").text(b.split(" ",1)+"'s Stream")})}else b=friends[a].name;var c="";view_active="album";$("#profile_wrap").html("");$("#info_wrap").html("");$("#album_cont").html("");$("#screen_index").remove();album_cont_reset();photo_comment_cache={};$("#friend_album_cont").css({height:"",
"min-height":""});$("#friend_album_cont").css({left:"0px"});selected_user=getUrlVars().user;$("#friend_cont").hide();$("#photo_cont").hide();$("#photo_cont").html("");if(friends[a]!=undefined){c='<div id="album_wrap"><div id="album_cont"></div></div>';if(!mobile||tablet)$("#title").html("<h3>"+b+"</h3>");else mobile&&!tablet&&$("#title").html("<h3>"+b+"</h3>");$("#title").show();$("#friend_album_cont").prepend(c);$("#friend_album_cont").show();append_load($("#album_cont"),"dark");get_user_albums(a,
5,render_albums);get_user_videos(a)}else{user_profile=null;c='<div id="non_friend_wrap"><div id="non_friend_trophy_room_wrap"><div id="info_wrap"><h1>Profile Info <span>Not Your Friend</span></h1><div id="info_cont"><div id="info_loading"><img src="http://portrit.s3.amazonaws.com/img/ajax-loader-light.gif"/></div></div></div><div id="non_friend_trophy_room_cont"><h1>Trophy Room</h1><div id="non_friend_trophies"></div></div></div></div>';$("#title").html("<h3>"+b+"</h3>");$("#title").show();$("#friend_album_cont").prepend(c);
append_load($("#album_cont"),"dark");init_info_view();get_users_trophies(selected_user,function(d){if(d.length>0){for(var e=0;e<d.length;e++){var f=d[e].cat_name.replace(" ","_").toLowerCase();$("#non_friend_trophies").append('<div class="trophy_cont"><div class="trophy_img medium '+f+'"></div><p class="nom_cat_'+f+'">'+d[e].count+"</p></div>")}$("#non_friend_trophies").append('<div class="clear"></div>')}else $("#non_friend_trophies").append("<h2>No winning trophies.</h2>")});$("#friend_album_cont").show();
view_active="profile"}click_hold_timer=null;mouse_up=false;selected_album_id="";attach_album_handlers();attach_profile_handlers();attach_info_handlers();getUrlVars().to_profile!==undefined&&$("#user_wall_view").click();typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Album_View","Shown",""])}
function render_mutual_friends(a,b){var c="";if(b=="all"){$("#show_all_mutual").text("Hide All");b=a.length;c='style="display: none;"'}for(var d=mutual_friend_top;d<b;d++)$("#mutual_friend_cont").append('<a href="#/user='+a[d]+'" '+c+' name="'+friends[a[d]].name+'"><img style="height: 50px; width: 50px;"class="clear_profile" src="http://graph.facebook.com/'+a[d]+'/picture?type=square"/></a>');a.length>0&&$("#mutual_friend_cont").append('<p id="mutual_friend_tooltip" style="display:none;"></p>');if(b==
a.length)if(mobile){$("#mutual_friend_cont a:hidden").delay(300).show();$("#friend_album_cont").css({"min-height":$("#info_wrap").height()+100})}else $("#mutual_friend_cont a:hidden").delay(300).fadeIn("fast",function(){$("#friend_album_cont").css({"min-height":$("#info_wrap").height()+100})});else b<a.length&&$("#mutual_friend_cont > h3").append('<span class="sick large" id="show_all_mutual">Show All</span>');mutual_friend_top=b}
function get_mutual_friends(a){$.getJSON("https://api.facebook.com/method/friends.getMutualFriends?format=JSON&target_uid="+a+"&access_token="+fb_session.access_token+"&callback=?",function(b){$("#info_cont").append('<div id="mutual_friend_cont"><h3>Mutual Friends</h3></div>');var c=b.length;if(c>10)c=10;mutual_friend_data=b;if($("#mutual_friend_cont").length==1){render_mutual_friends(b,c);mutual_friend_top=c}})}
function render_user_likes(a,b){var c=0,d="";c=b.length>=3?2:b.length-1;for(var e=0;e<b.length;e++){if(e>=3)d="display:none;";else{d="left:"+40*c+"px;";c--}liked_html=friends[b[e].id]!==undefined?'<div class="like" style="'+d+'" name="'+b[e].name+'">'+portrit_favicon+'<a href="#/user='+b[e].id+'"><img class="user_liked clear_profile" src="http://graph.facebook.com/'+b[e].id+'/picture?type=square"/></a></div>':'<div class="like" style="'+d+'" name="'+b[e].name+'"><a href="#/user='+b[e].id+'"><img class="user_liked clear_profile" src="http://graph.facebook.com/'+
b[e].id+'/picture?type=square"/></a></div>';$("#pid_"+a+" > .like_cont").prepend(liked_html)}$("#pid_"+a+" > .like_cont").attr("value",b.length).prepend('<p class="like_tooltip"></p>');if(b.length>3)$("#pid_"+a+" > .like_cont .like:last").css({left:80});else b.length>0&&$("#pid_"+a+" > .like_cont .like:last").css({left:40*(e-1)})}
function render_photo_likes(a,b){var c="",d=0;c="";if(b){for(var e=0;e<b.length;e++){if(e>=3)c="display:none;";else{c="right:"+40*d+"px;";d--}c=friends[b[e].id]!==undefined?'<div class="like" style="'+c+'" name="'+b[e].name+'">'+portrit_favicon+'<a href="#/user='+b[e].id+'"><img class="user_liked clear_profile" src="http://graph.facebook.com/'+b[e].id+'/picture?type=square"/></a></div>':'<div class="like" style="'+c+'" name="'+b[e].name+'"><a href="#/user='+b[e].id+'"><img class="user_liked clear_profile" src="http://graph.facebook.com/'+
b[e].id+'/picture?type=square"/></a></div>';$("#like_cont").append(c)}$("#like_cont .like_tooltip").length==0?$("#like_cont").attr("value",b.length).prepend('<p class="like_tooltip"></p>'):$("#like_cont").attr("value",b.length);$(".like_photo").length<=0&&view_active!="gallery"&&$("#like_cont").append('<img class="like_photo" id="lid_'+a+'" src="http://portrit.s3.amazonaws.com/img/like.png"/>')}}var like_cache={};
function get_likes(a,b){var c=null;like_cache[a]==undefined?FB.api("/"+a+"/likes",function(d){c=d.data;like_cache[a]=c;b(a,c)}):b(a,like_cache[a])}var active_noms_cache={},winning_noms_cache={},active_nom_cats_map={},winning_nom_cats_map={};
function render_feed(a,b){if(typeof b=="undefined")b=null;var c=null,d="",e="",f="",g="",h="",j=g=d="",m=0,l=0,i=0,k=0;d=null;f=0;var n=new Date;var q=h="",u=0;stream_view="top_noms";m=!mobile||tablet?690:430;for(var v=0;v<a.length;v++){c=a[v].noms;u=k=0;active_nom_cats_map[a[v].cat_name.replace(" ","_").toLowerCase()]=[];sort_noms_list_by_votes(c);if(c.length>0)for(var o=0;o<c.length;o++){j=c[o].nomination_category.replace(" ","_").toLowerCase();active_noms_cache[c[o].id]=c[o];l=c[o].photo.small_width;
active_nom_cats_map[j].push(c[o].id);l=l>c[o].photo.small_height?l*(80/c[o].photo.small_height)+10:80*(l/c[o].photo.small_height)+10;if(o==0){u=i=m/2-l/2+k;h=f=e=d="";d=new Date(c[o].created_time*1E3);f=n-d;f/=1E3;d=friends[c[o].nominatee]?friends[c[o].nominatee].name:c[o].nominatee==me.id?"You":"";h="";if(c[o].caption)h="Caption: "+c[o].caption;q=c[o].nominator_name;if(q==me.name)q="You";for(var w=0;w<c[o].votes.length;w++){g=c[o].votes[w].vote_name;e+='<a href="#/user='+c[o].votes[w].vote_user+
'" class="clear_profile" id="voted_'+c[o].votes[w].vote_user+'" name="'+g+'"><img src="https://graph.facebook.com/'+c[o].votes[w].vote_user+'/picture?type=square"/></a>'}g='<div class="nom_cat_top_cont nom_cat_'+j+'"><div class="nom_cat_user_cont"><a href="#/user='+c[o].nominatee+'" class="clear_profile"><img src="https://graph.facebook.com/'+c[o].nominatee+'/picture?type=square"/><h3>'+d+'</h3></a></div><div class="nom_cat_text_cont"><h1>'+c[o].nomination_category+'</h1></div><div class="clear"></div></div>';
d='<div class="voted_cont"><h3>Voted</h3><p class="tooltip"></p>'+e+"</div>";f='<div class="stream_photo_cont"><div class="nom_cat_stream_cont"><div id="nom_photo_'+c[o].id+'" class="nom_photo_thumbnail" name="selected" style="opacity: 1.0; left:'+i+'px;"><img id="nom_photo_'+c[o].id+'" src="'+c[o].photo.src_small+'"/><p class="nom_cat_'+c[o].nomination_category.replace(" ","_").toLowerCase()+'">'+getGetOrdinal(o+1)+'</p></div></div><div class="nom_cat_main_photo_cont"><div class="prev_photo"><div class="prev_photo_img"></div></div><div class="next_photo"><div class="next_photo_img"></div></div><div class="nom_cat_main_photo_wrap"><a href="#/nom_id='+
c[o].id+'"><img class="nom_main_photo" src="'+c[o].photo.src+'"/></a></div></div><div class="nom_photo_bottom_wrap"><a href="#/user='+c[o].nominator+'" class="clear_profile"><img class="user_img" src="https://graph.facebook.com/'+c[o].nominator+'/picture?type=square"/></a><div class="nominator_cont"><h3>Nominated by <span class="strong"><a href="#/user='+c[o].nominator+'" class="clear_profile">'+q+'</a></span></h3><p class="caption">'+h+'</p></div><span value="'+c[o].created_time*1E3+'">'+secondsToHms(f)+
'</span><a href="#/nom_id='+c[o].id+'"><p class="comments nom_cat_'+j+'">Comments: '+c[o].comment_count+'</p></a></div><div class="clear"></div></div>';h='<div class="nom_stream_left_cont">'+d+'<div class="clear"></div></div>';message='<div class="feed_post_cont nom_cat_cont_'+a[v].cat_name.replace(" ","_").toLowerCase()+'" id="nom_'+c[o].id+'">'+g+h+f+'<div class="clear"></div></div>';$("#profile_cont").append(message)}else{i=u+k;e='<div id="nom_photo_'+c[o].id+'" class="nom_photo_thumbnail" style="opacity: 0.6; left:'+
i+'px;"><img id="nom_photo_'+c[o].id+'" src="'+c[o].photo.src_small+'"/><p class="nom_cat_'+c[o].nomination_category.replace(" ","_").toLowerCase()+'">'+getGetOrdinal(o+1)+"</p></div>";$(".nom_cat_stream_cont:last").append(e)}k+=l}else{h=f=e=d=c="";g='<h1 class="nom_cat_'+a[v].cat_name.replace(" ","_").toLowerCase()+'_text">'+a[v].cat_name+'</h1><div class="clear"></div>';c='<div class="empty_nom_overlay"><div class="empty_message_box"><p>None of your friends are currently nominated for </p><p class="strong">'+
a[v].cat_name+'</p><div class="target_message_box"></div></div><div class="empty_trophy trophy_img large '+a[v].cat_name.replace(" ","_").toLowerCase()+'"></div></div>';f='<div class="stream_photo_cont"><div class="nom_cat_stream_cont"></div><div class="nom_cat_main_photo_cont"><div class="nom_cat_main_photo_wrap"></div></div><div class="clear"></div></div>';h='<div class="nom_stream_left_cont">'+d+'<div class="clear"></div></div>';message='<div class="feed_post_cont empty nom_cat_cont_'+a[v].cat_name.replace(" ",
"_").toLowerCase()+'">'+c+g+h+f+'<div class="clear"></div></div>';$("#profile_cont").append(message)}}if(selected_user==null||selected_user=="")my_feed||(my_feed=a);else user_feed=user_feed?user_feed.concat(a):a;if(view_active!="main"){v=$("#profile_wrap").outerHeight()+$("#header").height()+$("#main_view_control").outerHeight();$("#friend_album_cont").css({"min-height":v});setTimeout(function(){var z=$("#profile_wrap").outerHeight()+$("#header").height()+$("#main_view_control").outerHeight();$("#friend_album_cont").css({"min-height":z})},
200)}if(mobile){m=$(".nom_cat_main_photo_cont").get();for(v=0;v<m.length;v++);}initial_feed_load=false}
function update_nom_cat(a,b){var c="",d=null;d=getUrlVars()["recent-winners"]!=undefined?winning_noms_cache[b]:active_noms_cache[b];$("#nom_photo_"+a).attr("name","").css({opacity:0.6});$("#nom_photo_"+b).attr("name","selected").css({opacity:1});var e=[],f=0,g=0,h=false,j=$(".nom_cat_stream_cont").width()/2,m=$("#nom_"+a+" .nom_photo_thumbnail");$(m).each(function(){g=$(this).width();if($(this).attr("name")==="selected"){f+=g/2;h=true}else if(h===false)f+=g+5;e.push(g+5)});previous_x=0;margin_offset=
j-f;$(m).each(function(l){$(this).css({left:previous_x+margin_offset,top:0});previous_x+=e[l]});$("#nom_"+a+" .voted_cont a").remove();for(j=0;j<d.votes.length;j++)c+='<a href="#/user='+d.votes[j].vote_user+'" class="clear_profile" id="voted_'+d.votes[j].vote_user+'" name="'+d.votes[j].vote_name+'"><img src="https://graph.facebook.com/'+d.votes[j].vote_user+'/picture?type=square"/></a>';$("#nom_"+a+" .voted_cont").append(c);$("#nom_"+a+" .nom_main_photo").attr("src",d.photo.src);$("#nom_"+a+" .nom_cat_user_cont img").attr("src",
"https://graph.facebook.com/"+d.nominatee+"/picture?type=square");$("#nom_"+a+" .nom_cat_user_cont a").attr("href","#/user="+d.nominatee);c="";if(friends[d.nominatee])c=friends[d.nominatee].name;else if(d.nominatee==me.id)c="You";m=j="";if(d.caption)j="Caption: "+d.caption;m=d.nominator_name;if(m==me.name)m="You";$("#nom_"+a+" .nom_cat_user_cont h3").text(c);$("#nom_"+a+" .nom_photo_bottom_wrap > a.clear_profile").attr("href","/#/user="+d.nominator);$("#nom_"+a+" .nom_photo_bottom_wrap img.user_img").attr("src",
"https://graph.facebook.com/"+d.nominator+"/picture?type=square");$("#nom_"+a+" .nom_photo_bottom_wrap p.comments").text("Comments: "+d.comment_count).parent().attr("href","/#/nom_id="+d.id);$("#nom_"+a+" .nom_photo_bottom_wrap p.caption").text(j);$("#nom_"+a+" .nom_photo_bottom_wrap .nominator_cont a").attr("href","/#/user="+d.nominator).text(m);$("#nom_"+a+" .vote_cont p").text(d.vote_count);$("#nom_"+a+" .nom_cat_main_photo_wrap a").attr("href","/#/nom_id="+d.id);d=new Date-new Date(d.created_time*
1E3);d/=1E3;$("#nom_"+a+" .nom_photo_bottom_wrap > span").text(secondsToHms(d));$("#nom_"+a).attr("id","nom_"+b)}
function render_profile(a){$("#info_loading").hide();var b='<div id="profile_info_img"><img id="large_profile_img" src="http://graph.facebook.com/'+a.id+'/picture?type=large"/></div>',c={};c.link=typeof a.link!=="undefined"?a.link:"";c.about=typeof a.about!=="undefined"?a.about:"";c.birthday=typeof a.birthday!=="undefined"?a.birthday:"";c.work=typeof a.work!=="undefined"?a.work:"";c.education=typeof a.education!=="undefined"?a.education:"";c.website=typeof a.website!=="undefined"?a.website:"";c.hometown=
typeof a.hometown!=="undefined"?a.hometown:"";c.location=typeof a.website!=="undefined"?a.location:"";c.gender=typeof a.gender!=="undefined"?a.gender:"";c.interested_in=typeof a.interested_in!=="undefined"?a.interested_in:"";c.meeting_for=typeof a.meeting_for!=="undefined"?a.meeting_for:"";c.relationship_status=typeof a.relationship_status!=="undefined"?a.relationship_status:"";c.religion=typeof a.religion!=="undefined"?a.religion:"";c.political=typeof a.political!=="undefined"?a.political:"";b=b;
var d="",e="";b+="<ul>";for(key in c)if(c[key]!=="")if(key==="link"){d="Link";e='<a target="_blank" href="'+c[key]+'">Facebook profile</a>';b+="<li><h2>"+capitaliseFirstLetter(d)+" </h2><p>"+e+"</p></li>"}else if(key=="gender"){d=key;e=c[key];b+="<li><h2>"+capitaliseFirstLetter(d)+" </h2><p>"+e+"</p></li>"}b+="</ul>";user_profile=a;$("#info_cont").append(b)}var feed_load_once=true;
function get_user_feed(a,b){if(b=="user_stream")$.getJSON("/get_user_nom/",{nom_id:getUrlVars().nom_id},function(c){remove_load();var d=null;if(c&&c.length>0)if(c[0].inactive)a&&a(c[0].noms,c[0].inactive);else{for(var e=0;e<c.length;e++){d=c[e].noms;active_nom_cats_map[c[e].cat_name.replace(" ","_").toLowerCase()]=[];if(d.length>0)for(var f=0;f<d.length;f++){active_noms_cache[d[f].id]=d[f];active_nom_cats_map[d[f].nomination_category.replace(" ","_").toLowerCase()].push(d[f].id)}}a&&a(my_feed)}});
else if(b=="won")$.getJSON("/get_recent_winners/",{nom_id:getUrlVars().nom_id},function(c){remove_load();winners_feed=c;for(var d=0;d<c.length;d++)winning_noms_cache[c[d].id]=c[d];a&&a(c)});else b=="temp"&&$.getJSON("/get_user_win_stream/",function(c){remove_load();for(var d=0;d<c.length;d++)winning_noms_cache[c[d].id]=c[d];a&&a(c)})}
function update_comment_count(a){a=a.id;var b=0,c=null;if(view_active=="main"&&default_view=="wall"&&stream_view=="recent_noms"){c=$(".nom_comment_"+a+" span");b=$(c).text();b=parseInt(b)+1;$(c).text(b)}else{c=$("#nom_"+a+" .nom_photo_bottom_wrap .comments");b=$(c).text().replace("Comments: ","");b=parseInt(b)+1;$(c).text("Comments: "+b)}}
function update_vote_count(a){if(a){var b=a.nom_id,c="";active_noms_cache[b].vote_count=a.vote_count;if(view_active=="main"&&stream_view=="recent_noms"){$(".nom_vote_"+b).find("span").text(a.vote_count);$(".nom_vote_"+b).find("h2").text("Votes: "+a.vote_count)}else if(view_active=="main"){$("#nom_photo_"+b+" p").text(a.vote_count);if($("#nom_"+b).length>0){$("#nom_"+b+" .vote_cont p").text(a.vote_count);if($("#nom_"+b+" #voted_"+a.vote_user).length==0){c='<a href="#/user='+a.vote_user+'" class="clear_profile" id="voted_'+
a.vote_user+'" name="'+a.vote_name+'"><img src="https://graph.facebook.com/'+a.vote_user+'/picture?type=square"/></a>';$("#nom_"+b+" .voted_cont").append(c)}}}else if(view_active=="nom_detail"){$("#nom_photo_"+b+" p").text(a.vote_count);if($("#main_nom_cont").attr("value")==b){$("#vote_cont_left p").text(a.vote_count);c='<a href="#/user='+a.vote_user+'" class="clear_profile" id="voted_'+a.vote_user+'" name="'+a.vote_name+'"><img src="https://graph.facebook.com/'+a.vote_user+'/picture?type=square"/></a>';
$("#nom_votes_wrap").append(c)}}}}
function update_feed(a){if(a){var b=null,c="";c="";c=null;var d="",e="",f=e="",g="",h="";name="";stream_width=$(".stream_photo_cont").width();for(var j=small_photo_width=small_photo_offset=0;j<a.nom_data.length;j++){b=a.nom_data[j];active_noms_cache[b.id]=b;c=b.nomination_category;c=c.replace(" ","_").toLowerCase();c=$(".nom_cat_cont_"+c);if($(c).hasClass("empty")){small_photo_width=b.photo.small_width;small_photo_width=small_photo_width>b.photo.small_height?small_photo_width*(80/b.photo.small_height)+
12:80*(small_photo_width/b.photo.small_height)+13;small_photo_offset=stream_width/2-small_photo_width/2;g=h=f=e=e=d="";if(friends[b.nominatee])name=friends[b.nominatee].name;for(d=0;d<b.votes.length;d++)e+='<a href="#/user='+b.votes[d].user_id+'" class="clear_profile" id="voted_'+b.votes[d].user_id+'" name="'+b.votes[d].user_name+'"><img src="https://graph.facebook.com/'+b.votes[d].user_id+'/picture?type=square"/></a>';d='<a href="#/user='+b.nominatee+'" class="clear_profile"><img src="https://graph.facebook.com/'+
b.nominatee+'/picture?type=square"/><h3>'+name+"</h3></a>";e='<div class="voted_cont"><h3>Voted</h3><p class="tooltip"></p>'+e+"</div>";g='<div class="nom_photo_thumbnail" id="nom_photo_'+b.id+'" style="opacity: 1.0; left:'+small_photo_offset+'px"><img id="nom_photo_'+b.id+'" name="selected"  src="'+b.photo.src_small+'"/></div>';f='<a href=""><img class="nom_main_photo" src="'+b.photo.src+'"/></a><div class="vote_cont"><p>'+b.vote_count+"</p></div>";h='<div class="nom_photo_bottom_wrap"><a href="#"><p class="left">Comments: <span>'+
b.comment_count+"</span></p></a></div>";$(c).find(".target_wrap").prepend(d);$(c).find(".target_cont").after(e);$(c).find(".nom_cat_stream_cont").prepend(g);$(c).find(".nom_cat_main_photo_wrap").prepend(f);$(c).find(".nom_cat_main_photo_cont").after(h)}else{g='<div class="nom_photo_thumbnail" id="nom_photo_'+b.id+'" style="left:'+small_photo_offset+'px"><img id="nom_photo_'+b.id+'"  src="'+b.photo.src_small+'"/></div>';$(c).find(".nom_cat_stream_cont").append(g);stream_width=!mobile||tablet?560:500;
c=$(c).attr("id");var m=[],l=0,i=0,k=false;b=$(".nom_cat_stream_cont").width()/2;c=$("#"+c+" .nom_photo_thumbnail");$(c).each(function(){i=$(this).width();if($(this).attr("name")==="selected"){l+=i/2;k=true}else if(k===false)l+=i+10;m.push(i+10)});previous_x=0;margin_offset=b-l;$(c).each(function(n){$(this).css({left:previous_x+margin_offset,top:0});previous_x+=m[n]})}}}}
function render_winners(a){var b="",c="",d="";b="";var e=0,f=0,g=0,h=0;e="";for(var j=0;j<a.length;j++){b=a[j].cat_name;c=b.replace(" ","_").toLowerCase();d="";h=g=0;if(a[j].noms.length>0){for(var m=0;m<a[j].noms.length;m++){winning_noms_cache[a[j].noms[m].id]=a[j].noms[m];if(winning_nom_cats_map[c])winning_nom_cats_map[c].push(a[j].noms[m].id);else winning_nom_cats_map[c]=[a[j].noms[m].id];e=a[j].noms[m].photo.small_width;e=e>a[j].noms[m].photo.small_height?e*(80/a[j].noms[m].photo.small_height)+
10:80*(e/a[j].noms[m].photo.small_height)+10;if(m==0){h=f=465-e/2+g;d+='<div id="nom_photo_'+a[j].noms[m].id+'" class="nom_photo_thumbnail" name="selected" style="opacity: 1.0; left:'+f+'px;"><img id="nom_photo_'+a[j].noms[m].id+'" src="'+a[j].noms[m].photo.src_small+'"/><p class="nom_cat_'+a[j].noms[m].nomination_category.replace(" ","_").toLowerCase()+'">'+a[j].noms[m].vote_count+"</p></div>"}else{f=h+g;d+='<div id="nom_photo_'+a[j].noms[m].id+'" class="nom_photo_thumbnail" style="opacity: 0.6; left:'+
f+'px;"><img id="nom_photo_'+a[j].noms[m].id+'" src="'+a[j].noms[m].photo.src_small+'"/><p class="nom_cat_'+a[j].noms[m].nomination_category.replace(" ","_").toLowerCase()+'">'+a[j].noms[m].vote_count+"</p></div>"}g+=e}e=friends[a[j].noms[0].nominatee]?friends[a[j].noms[0].nominatee].name:a[j].noms[0].nominatee==me.id?"You":"";b='<div class="winning_feed_post_cont nom_cat_cont_'+c+'" id="nom_'+a[j].noms[0].id+'"><h1 class="nom_cat_'+c+'">'+b+'</h1><div class="winning_photo_cont"><div class="nom_cat_stream_cont">'+
d+'</div><div class="winning_nom_cat_main_photo_cont"><div class="prev_photo"><div class="prev_photo_img"></div></div><div class="next_photo"><div class="next_photo_img"></div></div><div class="winning_nom_cat_main_photo_wrap"><a href="#/nom_id='+a[j].noms[0].id+'/won"><img class="nom_main_photo" src="'+a[j].noms[0].photo.src+'"></a></div><img class="winning_trophy" src="http://portrit.s3.amazonaws.com/img/trophies/large/'+c+'.png"/><div class="nom_photo_bottom_wrap"><a href="#/nom_id='+a[j].noms[0].id+
'"><p class="left">Comments: <span>'+a[j].noms[0].comment_count+'</span></p><p class="right strong">'+e+"</p></a></div>"}else b='<div class="winning_feed_post_cont nom_cat_cont_'+c+'"><h1 class="nom_cat_'+c+'_text">'+b+'</h1><div class="nom_color_new_side nom_cat_'+c+'"></div><div class="winning_photo_cont"><div class="winning_nom_cat_main_photo_cont"><div class="empty_winning_cont"><h1>No winners for <span class="nom_cat_'+c+'_text">'+b+'</span> yet. Be the first of your friends!</h1><img class="winning_trophy" style="bottom: 0px;" src="http://portrit.s3.amazonaws.com/img/trophies/large/'+
c+'.png"/></div></div></div><div class="clear"></div></div>';$("#profile_cont").append(b)}}function append_load(a,b){if($("#loader").length==0)b=="light"?$(a).append('<div id="loader"><img src="http://portrit.s3.amazonaws.com/img/ajax-loader-light.gif"/></div>'):$(a).append('<div id="loader"><img src="http://portrit.s3.amazonaws.com/img/album-loader-dark.gif"/></div>')}
function remove_load(a){typeof a!=="undefined"?$("#loader").animate({opacity:0},{duration:200,queue:false,complete:function(){$(this).remove()}}):$("#loader").remove()}var winners_feed=null;function init_winners_view(){append_load($("#canvas_cont"),"dark");if(winners_feed){remove_load();render_recent_winners(winners_feed)}else get_user_feed(render_recent_winners,"won")}
function render_latest_photos(a){var b=null,c=null,d=null;b=d="";for(var e=0;e<a.length;e++)if(friends[a[e].source_id])for(var f=0;f<a[e].attachment.media.length;f++){b=a[e].attachment.media[f];c=b.photo.pid;d=a[e].actor_id;if(friends[d])d=friends[d].name;else{d="";for(var g=0;g<a[e].tagged_ids.length;g++)if(friends[a[e].tagged_ids[g]])d=friends[a[e].tagged_ids[g]].name}b='<div class="new_photo_cont" name="'+d+'" value="'+c+'"><img src="'+b.src+'"/></div>';$("#new_photo_cont").append(b)}$(window).height()<
900&&$("#wrapper").css("min-height",900)}var photo_feed=null,photo_feed_timeout=null;
function init_latest_photos(){view_active="latest_photos";$("#context_overlay_cont > div").append('<div id="new_photo_cont"><h1>Latest Photos</h1><p class="tooltip"></p></div>');append_load($("#context_overlay_cont > div"),"light");if(!photo_feed||photo_feed.length==0)$.getJSON("https://api.facebook.com/method/stream.get?access_token="+fb_session.access_token+"&limit=50&filter_key="+photo_filter+"&format=json&callback=?",function(a){remove_load();photo_feed=a.posts;render_latest_photos(photo_feed);
clearTimeout(photo_feed_timeout);photo_feed_timeout=setTimeout(function(){photo_feed=null},3E5)});else{remove_load();render_latest_photos(photo_feed)}}
function render_recent_winners(a){var b="",c="",d="",e="";time_diff=time=now=create_date=null;winners_end=false;winners_page=2;if(a.length>0){create_date=new Date(a[0].create_datetime*1E3);now=new Date;time=create_date.getTime();time_diff=now-time;time_diff/=1E3;d=a[0].nomination_category.replace(" ","_").toLowerCase();b=a[0].nominatee==me.id?"You":a[0].nominatee_name;c=a[0].nominator==me.id?"You":a[0].nominator_name;e=a[0].caption==null?"":a[0].caption;d='<div id="main_view_control"><a class="sick red large" id="show_upload">Post Photo</a></div><div id="recent_winners"><h1>Recent Winners</h1><div id="top_stripe"></div><div id="main_nom_cont" value="'+
a[0].id+'"><div id="recent_win_photo_cont"><div id="recent_win_photo_wrap"><img id="recent_win_photo" src="'+a[0].photo.src+'"/></div><div id="nominator_overlay_cont"><a href="/#/user='+a[0].nominator+'"><img class="user_img" src="https://graph.facebook.com/'+a[0].nominator+'/picture?type=square"/></a><h2>Nominated by <span class="strong"><a href="/#/user='+a[0].nominator+'">'+c+"</a></span></h2><p>"+e+'</p></div></div><div id="recent_win_right_cont" class="nom_cat_'+d+'"><img class="user_img" src="https://graph.facebook.com/'+
a[0].nominatee+'/picture?type=square"/><p class="strong"><a href="/#/user='+a[0].nominator+'">'+b+"</a></p><p>Won</p><h2>"+a[0].nomination_category+'</h2><div id="nom_create_date"><h3>'+secondsToHms(parseInt(time_diff))+'</h3></div><div class="trophy_img large '+d+'"></div></div><div class="clear"></div></div><div id="recent_win_stream_cont"></div><div id="recent_bottom_cont"><div id="nom_comments_cont"><div id="comment_heading_cont"><h2>Comments</h2><span class="sick large" id="add_new_comment">New Comment</span><div class="clear"></div></div><div id="new_comment_cont"><div class="comment_top_head"><a class="sick large post_new_comment">Post</a><a class="sick large cancel_new_comment">Close</a></div><textarea class="comment_body"></textarea></div></div><div id="nom_votes_cont"><h2 id="voted_heading">Voted</h2><div id="nom_votes_wrap" class="voted_cont"><p class="tooltip"></p></div></div></div><div class="clear"></div></div>';
$("#canvas_cont").append(d);b='<div id="nom_cat_stream"><div class="prev_photo"><div class="prev_photo_img"></div></div><div class="next_photo"><div class="next_photo_img"></div></div>';for(c=0;c<a.length;c++){d=a[c].nomination_category.replace(" ","_").toLowerCase();b+=c==0?'<div id="nom_photo_'+a[c].id+'" class="nom_photo_thumbnail" style="height:'+a[c].photo.small_height+'px; opacity: 1.0;" name="selected"><img src="'+a[c].photo.src_small+'"/><div class="trophy_img small '+d+'"></div></div>':'<div id="nom_photo_'+
a[c].id+'" class="nom_photo_thumbnail" style="height:'+a[c].photo.small_height+'px; opacity: 0.6;"><img src="'+a[c].photo.src_small+'"/><div class="trophy_img small '+d+'"></div></div>'}b+="</div>";$("#recent_win_stream_cont").append(b);d=$(".nom_photo_thumbnail");var f=[],g=0,h=0,j=false;b=$("#nom_cat_stream").width()/2;$(d).each(function(i){h=parseInt(a[i].photo.small_width);if($(this).attr("name")==="selected"){g+=h/2;j=true}else if(j===false)g+=h+20;f.push(h+20)});var m=0,l=b-g;$(d).each(function(i){$(this).css({left:m+
l,top:0});m+=f[i]});get_nom_comments(a[0].id,true);render_nom_votes(a[0].votes)}else $("#new_photo_cont").append("<h2>No Recent Winners.</h2>")}
function attach_recent_winner_handlers(){$("#add_new_comment").live("click",function(){var a=$(this).parent().parent().find("#new_comment_cont");comment_form_shown=true;$(this).hide();$(a).show();$(".comment_body").focus()});$(".cancel_new_comment").live("click",function(){var a=$(this).parent().parent();comment_form_shown=false;$(a).hide();$("#add_new_comment").show()});$(".post_new_comment").live("click",function(){var a=$(".comment_body").val().replace(/\n\r?/g,"<br />"),b=$("#main_nom_cont").attr("value");
tut_on&&update_tut("comment");var c=(new Date).getTime(),d='<div class="comment"><p class="comment_time" value="'+c/1E3+'">Right now</p><a href="#/user='+me.id+'" class="clear_profile"><img class="user_photo" src="https://graph.facebook.com/'+me.id+'/picture?type=square"/></a><a href="#?user='+me.id+'" class="post_username from_username clear_profile">You</a><p>'+a+"</p></div>";$("#new_comment_cont").after(d);mobile?$(".comment_empty").hide():$(".comment_empty").fadeOut();$(".cancel_new_comment").click();
$(".comment_body").val("");$.post("/new_comment/",{body:a,nom_id:b},function(){});c=new Date;var e=null;$(".comment_time").each(function(){time=new Date($(this).attr("value")*1E3);e=c-time;e/=1E3;$(this).text(secondsToHms(parseInt(e)))})});$(".nom_photo_thumbnail").live("click",function(){var a=$(".nom_photo_thumbnail").length,b=$(this).index(),c=$(this).attr("id").replace("nom_photo_",""),d=winning_noms_cache[c];b>=a-3&&winners_end==false&&get_more_winners(c,add_recent_winners_to_steam);a=$(".nom_photo_thumbnail");
var e=[],f=0,g=0,h=false;b=$("#nom_cat_stream").width()/2;$('.nom_photo_thumbnail[name="selected"]').css({opacity:"0.6"}).attr("name","");$(this).css({opacity:"1.0"}).attr("name","selected");$(a).each(function(){g=$(this).width();if($(this).attr("name")==="selected"){f+=g/2;h=true}else if(h===false)f+=g+20;e.push(g+20)});var j=0,m=b-f;$(a).each(function(l){$(this).css({left:j+m,top:0});j+=e[l]});update_recent_winners_feed(d);return false});$(".next_photo").live("click",function(){var a=$(this).parent().children().filter('[name="selected"]');
$(a).next().click()});$(".prev_photo").live("click",function(){var a=$(this).parent().children().filter('[name="selected"]');$(a).prev().click()});$("#nom_votes_cont a").live("mouseover mouseout",function(a){a.type=="mouseover"?show_like_tooltip(this):hide_like_tooltip(this)})}var winners_end=false,winners_page=2;
function get_more_winners(a,b){$.getJSON("/get_recent_winners/",{page:winners_page},function(c){winners_page+=1;if(c){if(c.length<12)winners_end=true;for(var d=0;d<c.length;d++)winning_noms_cache[c[d].id]=c[d];b&&b(c)}else winners_end=true})}
function add_recent_winners_to_steam(a){for(var b="",c=0;c<a.length;c++){nom_cat_underscore=a[c].nomination_category.replace(" ","_").toLowerCase();b+=c==0?'<div id="nom_photo_'+a[c].id+'" class="nom_photo_thumbnail" style="height:'+a[c].photo.small_height+'px; opacity: 1.0;" name="selected"><img src="'+a[c].photo.src_small+'"/><div class="trophy_img small '+nom_cat_underscore+'"></div></div>':'<div id="nom_photo_'+a[c].id+'" class="nom_photo_thumbnail" style="height:'+a[c].photo.small_height+'px; opacity: 0.6;"><img src="'+
a[c].photo.src_small+'"/><div class="trophy_img small '+nom_cat_underscore+'"></div></div>'}$("#recent_win_stream_cont #nom_cat_stream").append(b);a=$(".nom_photo_thumbnail");var d=[],e=0,f=0,g=false;b=$("#nom_cat_stream").width()/2;$(a).each(function(){f=$(this).width();if($(this).attr("name")==="selected"){e+=f/2;g=true}else if(g===false)e+=f+20;d.push(f+20)});var h=0,j=b-e;$(a).each(function(m){$(this).css({left:h+j,top:0});h+=d[m]})}
function update_recent_winners_feed(a){var b="",c=a.nomination_category.replace(" ","_").toLowerCase();b=a.caption==null?"":a.caption;$("#recent_win_photo").attr("src",a.photo.src);$("#nominator_overlay_cont img").attr("src","https://graph.facebook.com/"+a.nominator+"/picture?type=square");$("#nominator_overlay_cont a").attr("href","/#/user="+a.nominator);$("#nominator_overlay_cont span > a").text(a.nominator_name);$("#nominator_overlay_cont > p").text(b);$("#recent_win_right_cont").removeClass().addClass("nom_cat_"+
c);$("#recent_win_right_cont h2").text(a.nomination_category);$("#recent_win_right_cont .user_img").attr("src","https://graph.facebook.com/"+a.nominatee+"/picture?type=square");$("#recent_win_right_cont p.strong a").attr("href","/#/user="+a.nominatee);$("#recent_win_right_cont p.strong a").text(a.nominatee_name);$("#recent_win_right_cont .trophy_img").removeClass().addClass("trophy_img large "+c);$("#nom_votes_wrap a").remove();$("#main_nom_cont").attr("value",a.id);b=new Date;c=(new Date(a.create_datetime*
1E3)).getTime();time_diff=b-c;time_diff/=1E3;$("#nom_create_date h3").text(secondsToHms(parseInt(time_diff)));get_nom_comments(a.id,true);render_nom_votes(a.votes)}var winner_feed=null;function init_recent_winners(){view_active="recent_winners";append_load($("#context_overlay_cont > div"),"light");if(winner_feed){remove_load();render_recent_winners(winner_feed)}else{remove_load();get_user_feed(render_recent_winners,"won")}}
function inject_nom_stream(a){var b=null,c="",d="",e="",f="",g="",h=null,j=new Date,m="",l=b="",i="",k="large";if(mobile&&!tablet)k="medium";for(var n=0;n<a.length;n++){b=a[n];c=b.nomination_category;d=b.nomination_category.replace(" ","_").toLowerCase();if(active_noms_cache[b.id]==undefined){active_noms_cache[b.id]=b;if(active_nom_cats_map[d])active_nom_cats_map[d].push(b.id);else active_nom_cats_map[d]=[b.id]}g=friends[b.nominatee]?friends[b.nominatee].name:b.nominatee==me.id?"You":"";i="";l=b.nominator==
me.id?"You":b.nominator_name?b.nominator_name:friends[b.nominator]?friends[b.nominator].name:"";if(b.caption)i="Caption: "+b.caption;f='<img src="https://graph.facebook.com/'+b.nominatee+'/picture?type=square"/>';e='<img src="'+b.photo.src+'"/>';m='<div class="comment_empty"><h2>No comments yet. Be the first!</h2></div>';time=new Date(b.created_time*1E3);h=j-time;h/=1E3;b='<div class="recent_nom_cont" style="display:none;" id="'+b.id+'"><div class="recent_nom_top_cont nom_cat_'+d+'"><a href="#/user='+
b.nominatee+'">'+f+'</a><a href="#/user='+b.nominatee+'"><h2>'+g+'</h2></a><h3>Nominated for <span class="strong">'+c+"</span><span>"+secondsToHms(h)+'</span></h3><div class="clear"></div></div><div class="recent_nom_photo_cont"><div class="recent_nom_photo_left_cont"><div class="recent_nom_photo_left_wrap"><a href="#/nom_id='+b.id+'">'+e+'<div id="nominator_overlay_cont"><a href="/#/user='+b.nominator+'"><img class="user_img" src="https://graph.facebook.com/'+b.nominator+'/picture?type=square"/></a><h2>Nominated by <span class="strong"><a href="/#/user='+
b.nominator+'">'+l+"</a></span></h2><p>"+i+'</p></div></a></div></div><div class="recent_nom_photo_right_cont"><div class="recent_nom_vote_count nom_vote_'+b.id+'"><div class="trophy_img '+k+" "+d+'"></div><a href="#/nom_id='+b.id+'/votes"><h2 class="nom_cat_'+d+'">Votes: <span class="strong">'+b.vote_count+'</span></h2></a></div><div class="clear"></div></div><div class="clear"></div></div><div class="recent_nom_comment_cont" id="nom_comments_'+b.id+'"><div class="recent_nom_comment_heading" value="'+
b.id+'"><a href="#/nom_id='+b.id+'/comments"><h1>Comments</h1></a><span class="add_new_comment sick large">New Comment</span><div class="clear"></div></div>'+m+"</div></div>";$("#recent_left_cont").prepend(b);mobile?$(".recent_nom_cont:first").show():$(".recent_nom_cont:first").fadeIn()}}
function render_recent_stream(a){var b=null,c="",d="",e="",f="",g="",h=null,j=new Date,m="",l="",i="",k=i=b="",n="large";if(mobile&&!tablet)n="medium";for(var q=0;q<a.length;q++){b=a[q];c=b.nomination_category;d=b.nomination_category.replace(" ","_").toLowerCase();if(active_noms_cache[b.id]==undefined){active_noms_cache[b.id]=b;if(active_nom_cats_map[d])active_nom_cats_map[d].push(b.id);else active_nom_cats_map[d]=[b.id]}g=friends[b.nominatee]?friends[b.nominatee].name:b.nominatee==me.id?"You":"";
f='<img src="https://graph.facebook.com/'+b.nominatee+'/picture?type=square"/>';e='<img src="'+b.photo.src+'"/>';l=m="";if(b.quick_comments.length>0){for(k=0;k<b.quick_comments.length;k++){i=b.quick_comments[k].owner_name;time=new Date(b.quick_comments[k].create_datetime*1E3);h=j-time;h/=1E3;m+='<div class="comment"><p class="comment_time" value="'+b.quick_comments[k].create_datetime+'">'+secondsToHms(h)+'</p><a href="#/user='+b.quick_comments[k].owner_id+'"><img class="user_photo" src="https://graph.facebook.com/'+
b.quick_comments[k].owner_id+'/picture?type=square"/></a><a href="#/user='+b.quick_comments[k].owner_id+'" class="post_username from_username clear_profile">'+i+"</a><p>"+b.quick_comments[k].comment+"</p></div>"}if(b.more_comments)l='<p class="load_more_comments" value="'+b.id+'">Load more comments</p>'}else m='<div class="comment_empty"><h2>No comments yet. Be the first!</h2></div>';k="";i=b.nominator==me.id?"You":b.nominator_name?b.nominator_name:friends[b.nominator]?friends[b.nominator].name:"";
if(b.caption)k=b.caption;time=new Date(b.created_time*1E3);h=j-time;h/=1E3;b='<div class="recent_nom_cont" id="'+b.id+'" time="'+b.created_time+'"><div class="recent_nom_top_cont nom_cat_'+d+'"><a href="#/user='+b.nominatee+'">'+f+'</a><a href="#/user='+b.nominatee+'"><h2>'+g+'</h2></a><h3>Nominated for <span class="strong">'+c+"</span><span>"+secondsToHms(h)+'</span></h3><div class="clear"></div></div><div class="recent_nom_photo_cont"><div class="recent_nom_photo_left_cont"><div class="recent_nom_photo_left_wrap"><a href="#/nom_id='+
b.id+'">'+e+'<div id="nominator_overlay_cont"><a href="/#/user='+b.nominator+'"><img class="user_img" src="https://graph.facebook.com/'+b.nominator+'/picture?type=square"/></a><h2>Nominated by <span class="strong"><a href="/#/user='+b.nominator+'">'+i+"</a></span></h2><p>"+k+'</p></div></a></div></div><div class="recent_nom_photo_right_cont"><div class="recent_nom_vote_count nom_vote_'+b.id+'"><a href="#/nom_id='+b.id+'"><div class="trophy_img '+n+" "+d+'"></div></a><a href="#/nom_id='+b.id+'/votes"><h2 class="nom_cat_'+
d+'">Votes: <span class="strong">'+b.vote_count+'</span></h2></a></div><div class="clear"></div></div><div class="clear"></div></div><div class="recent_nom_comment_cont" id="nom_comments_'+b.id+'"><div class="recent_nom_comment_heading" value="'+b.id+'"><a href="#/nom_id='+b.id+'/comments"><h1>Comments</h1></a><span class="add_new_comment sick large">New Comment</span><div class="clear"></div></div>'+m+l+'<div class="clear"></div></div></div>';$("#recent_left_cont").append(b)}a.length>=10&&$("#recent_left_cont").append('<div id="load_more_noms_cont"><span id="load_more" class="sick large">Load More</span></div>')}
function render_top_noms(a){var b=null,c="",d="",e="",f="";b="";var g=5;$("#top_right_cont").append('<h1>The Daily <span class="strong">Leaderboard</h1>');if(a.length<g)g=a.length;for(var h=0;h<a.length;h++){b=a[h];c=b.nomination_category.replace(" ","_").toLowerCase();if(active_noms_cache[b.id]==undefined){active_noms_cache[b.id]=b;if(active_nom_cats_map[c])active_nom_cats_map[c].push(b.id);else active_nom_cats_map[c]=[b.id]}if(h<g){f=friends[b.nominatee]?friends[b.nominatee].name:b.nominatee==me.id?
"You":"";d='<img src="https://graph.facebook.com/'+b.nominatee+'/picture?type=square"/>';e='<img src="'+b.photo.src_small+'"/>';b='<div class="top_nom_cont"><a href="#/user='+b.nominatee+'"><h2>'+f+'</h2></a><div class="top_nom_wrap"><div class="top_nom_left_cont nom_cat_'+c+'"><a href="#/user='+b.nominatee+'" name="'+f+'">'+d+'</a><p class="vote_count">'+getGetOrdinal(h+1)+'</p></div><div class="top_nom_right_cont"><a href="#/nom_id='+b.id+'">'+e+'</a></div><div class="clear"></div><div class="top_nom_bottom_cont"><div class="top_nom_comment_cont nom_comment_'+
b.id+'"><a href="#/nom_id='+b.id+'"><p>Comments: <span class="strong">'+b.comment_count+'</span></p></a></div><div class="top_nom_vote_count nom_vote_'+b.id+'"><a href="#/nom_id='+b.id+'"><p>Votes: <span class="strong">'+b.vote_count+'</span></p></a></div><div class="clear"></div></div></div></div>';$("#top_right_cont").append(b)}}}
function render_top_users(a){var b="",c="";b="";if(a.length>0){c='<h1>All Time <span class="strong">Leaderboard</span></h1><div id="top_friends">';for(var d=0;d<a.length;d++){b=friends[a[d].fid]?friends[a[d].fid].name:"You";b='<div class="top_friend"><p class="nom_cat_'+a[d].top_nom_cat.replace(" ","_").toLowerCase()+'">'+getGetOrdinal(d+1)+'</p><a href="/#/user='+a[d].fid+'"><h2>'+b+'</h2></a><a href="/#/user='+a[d].fid+'"><img src="https://graph.facebook.com/'+a[d].fid+'/picture?type=square"/></a></div>';
c+=b}c+="</div>";$("#top_right_cont").append(c)}}
function render_empty_nom_page(){var a="";append_load($("#recent_empty_wrap > .empty_cont"),"light");get_user_feed(function(c){remove_load();var d=null,e="",f=e="";d="";var g=8;if(c.length>0){$("#recent_empty_wrap > h3").after("<p>These photos just won.</p>");if(c.length<g)g=c.length;for(var h=0;h<g;h++){d=c[h].photo;e=c[h].nomination_category;e=e.replace(" ","_").toLowerCase();f=friends[c[h].nominatee]!==undefined?friends[c[h].nominatee].name:c[h].nominatee==me.id?"You":"";d='<div class="winning_nom_cont"><a href="/#/nom_id='+
c[h].id+'/won/"><img src="'+d.src+'"/></a><div class="winning_nom_overlay"><a href="/#/user='+c[h].nominatee+'"><p class="nom_cat_'+e+'_text">'+f+'</p></a><div class="trophy_img medium '+e+'"></div></div></div>';$("#recent_empty_wrap > .empty_cont").append(d)}$("#recent_empty_wrap > .empty_cont").append('<div class="clear"></div>')}else{$("#recent_empty_wrap > h3").after("<h1>No Recent Winners.</h1>");$("#recent_empty_wrap > h3").after("<p>These photos just won.</p>")}},"won");a='<div id="empty_noms_cont"><h1>There are no <span class="strong">Active Nominations</span></h1><h2>Help us make this a happenin\' place and nominate your friends photos.</h2><div id="search_empty_wrap"><div id="empty_search_cont"><ul><li><p>1. Find your friends.</p></li><li><p>2. Nominate their best photos.</p></li><li><p>3. Vote on your favorite.</p></li></ul><input id="empty_search" type="text" value="Find your Friends"/><div id="clear_empty_search" class="close_img mobile" style="display:none;" onclick="void(0)"></div></div><div class="empty_cont"></div></div><div id="latest_empty_wrap"><h3>Latest Photos</h3><p>The newest photos on Facebook.</p><div class="empty_cont"></div></div><div id="recent_empty_wrap"><h3>Recent Winners</h3><div class="empty_cont"></div></div></div>';
$("#scroller").append(a);$("#latest_empty_wrap .empty_cont").append('<div id="loader_short"><img src="http://portrit.s3.amazonaws.com/img/ajax-loader-light.gif"/></div>');$.getJSON("https://api.facebook.com/method/stream.get?access_token="+fb_session.access_token+"&limit=50&filter_key="+photo_filter+"&format=json&callback=?",function(c){$("#loader_short").remove();a:{c=c.posts;var d=24,e=0;if(mobile&&!tablet)d=9;for(var f=0;f<c.length;f++)if(c[f].attachment.media)for(var g=0;g<c[f].attachment.media.length;g++)if(friends[c[f].source_id]){photo=
c[f].attachment.media[g];if(photo.photo){photo_id=photo.photo.pid;owner_id=c[f].actor_id;if(friends[owner_id])owner_name=friends[owner_id].name;else{owner_name="";for(var h=0;h<c[f].tagged_ids.length;h++)if(friends[c[f].tagged_ids[h]])owner_name=friends[c[f].tagged_ids[h]].name}photo_html='<div class="new_photo_cont" name="'+owner_name+'" value="'+photo_id+'"><img src="'+photo.src+'"/></div>';$("#latest_empty_wrap > .empty_cont").append(photo_html);e+=1;if(e==d){mobile||$("#latest_empty_wrap > .empty_cont").append('<p class="tooltip"></p>');
break a}}}e>0?$("#latest_empty_wrap > .empty_cont").append('<p class="tooltip"></p>'):$("#latest_empty_wrap > .empty_cont").append("<h1>No Latest Photos.</h1>")}});$("#empty_search").unbind("focus, blur, keyup");mobile?$("#clear_empty_search").unbind("touchend"):$("#clear_empty_search").unbind("click");$("#empty_search").bind("focus",function(){comment_form_shown=true;$(this).css("color","#333");if(this.value==this.defaultValue)this.value="";this.value!=this.defaultValue&&this.select()});$("#empty_search").bind("blur",
function(){comment_form_shown=false;$(this).css("color","#888");if($.trim(this.value)=="")this.value=this.defaultValue?this.defaultValue:""});mobile?$("#clear_empty_search").bind("touchend",function(){$("#empty_search").val("").trigger("keyup").trigger("blur");return false}):$("#clear_empty_search").bind("click",function(){$("#empty_search").val("").trigger("keyup").trigger("blur")});var b=[];for(a=0;a<friend_array.length;a++)friend_array[a].hidden===false&&b.push(friend_array[a].name);$("#empty_search").bind("keyup",
function(){var c=$(this).val(),d,e,f,g;if(c==""){$("#empty_search_cont").css({"border-radius":"10px","-moz-border-radius":"10px","-webkit-box-shadow":"none","box-shadow":"none","-moz-box-shadow":"none",padding:"15px"});$("#search_empty_wrap .empty_cont").css({padding:"0px"}).html("");$("#clear_empty_search").hide()}else{$("#clear_empty_search").show();e=b.length;d=[];c=c.toLowerCase();for(g=0;g<e;g++){f=b[g];f.toLowerCase().indexOf(c)===0&&d.push(f)}$("#search_empty_wrap .empty_cont").html("");if(d.length>
0){$("#search_empty_wrap .empty_cont").css({padding:"10px 10px"});$("#empty_search_cont").css({"border-bottom-left-radius":"0px","border-bottom-right-radius":"0px","-moz-border-radius-bottomleft":"0px","-moz-border-radius-bottomright":"0px","-webkit-box-shadow":"rgba(0, 0, 0, 0.496094) 0px 9px 3px -4px","-moz-box-shadow":"0 9px 3px -4px rgba(0, 0, 0, 0.5)","box-shadow":"rgba(0, 0, 0, 0.496094) 0px 9px 3px -4px","padding-bottom":"0px"});c=null;c=f=e="";for(g=0;g<d.length;g++){c=friends[get_friend_id_by_name(d[g])];
e='<div class="crop"><img class="friend_pic" src="https://graph.facebook.com/'+c.id+'/picture?type=large"/></div>';f='<div class="text_wrapper"><div class="text" onclick="void(0)"><h3>'+c.name+"</h3></div></div>";c='<div class="friend" name="'+c.name+'" value="'+c.id+'" onclick="void(0)"><div class="img_cont">'+e+f+"</div></div>";$("#search_empty_wrap .empty_cont").append(c)}}else{$("#empty_search_cont").css({"border-bottom-left-radius":"0px","border-bottom-right-radius":"0px","-moz-border-radius-bottomleft":"0px",
"-moz-border-radius-bottomright":"0px","-webkit-box-shadow":"rgba(0, 0, 0, 0.496094) 0px 9px 3px -4px","-moz-box-shadow":"0 9px 3px -4px rgba(0, 0, 0, 0.5)","box-shadow":"rgba(0, 0, 0, 0.496094) 0px 9px 3px -4px","padding-bottom":"0px"});$("#search_empty_wrap .empty_cont").html("<h1>No friend's with first name starting in: "+c+"</h1>")}}});$(".new_photo_cont").live("mouseover mouseout",function(c){c.type=="mouseover"?show_like_tooltip(this):hide_like_tooltip(this)});attach_main_handlers()}
function hide_stream_fixtures(){tablet&&$("#profile_wrap").css({width:"960px",right:"0px"});$("#active_stream_view").hide();$("#active_stream_text_cont").hide();$("#tab_nav").hide()}function show_stream_fixtures(){tablet&&$("#profile_wrap").css({width:"940px",right:"20px"});$("#active_stream_view").show();$("#active_stream_text_cont").show();$("#tab_nav").show()}
function init_recent_view(){append_load($("#scroller"),"light");$("#profile_cont").append('<div id="recent_cont_1"><div id="recent_left_cont"></div><div id="top_right_cont"></div></div><div class="clear"></div>');$.getJSON("/init_recent_stream/",function(a){remove_load();stream_view="recent_noms";if(a.recent.length>0){show_stream_fixtures();render_recent_stream(a.recent);if(!mobile||tablet){render_countdown_clock();render_top_noms(a.top);render_top_users(a.top_users)}$("#profile_cont").show()}else{render_empty_nom_page();
hide_stream_fixtures()}})}var date=new Date,month=date.getMonth(),todays_date=date.getDate(),todays_year=date.getFullYear();dateFuture=new Date(todays_year,todays_date,todays_date,24,0,0);tzOffset=-8;dx=dateFuture.toGMTString();dx=dx.substr(0,dx.length-3);tzCurrent=dateFuture.getTimezoneOffset()/60*-2;dateFuture.setTime(Date.parse(dx));dateFuture.setHours(dateFuture.getHours()+tzCurrent-tzOffset);
function GetCount(){dateNow=new Date;amount=dateFuture.getTime()-dateNow.getTime();delete dateNow;if(amount<=0){var a=new Date;a.getMonth();var b=a.getDate();a=a.getFullYear();dateFuture=new Date(a,b,b,24,0,0);tzOffset=-8;dx=dateFuture.toGMTString();dx=dx.substr(0,dx.length-3);tzCurrent=dateFuture.getTimezoneOffset()/60*-2;dateFuture.setTime(Date.parse(dx));dateFuture.setHours(dateFuture.getHours()+tzCurrent-tzOffset);$("#cont").prepend('<div id="winners_announced_cont"><h2>Winners are being calculated. Check back in a few minutes.</h2></div>')}secs=
mins=hours=days=0;out="";amount=Math.floor(amount/1E3);days=Math.floor(amount/86400);amount%=86400;hours=Math.floor(amount/3600);amount%=3600;mins=Math.floor(amount/60);amount%=60;secs=Math.floor(amount);if(days!=0||hours!=0)out+=hours+"h:";if(days!=0||hours!=0||mins!=0)out+=mins+"m:";out+=secs+"s";$("#time_countdown").text(out);setTimeout("GetCount()",1E3)}
function render_countdown_clock(){$("#top_right_cont").children().length==0&&$("#top_right_cont").prepend('<h1>Time <span class="strong">Remaining</strong></h1><h2 id="time_countdown"></h2></h1>');GetCount()}
function render_user_profile_trophies(){var a=getUrlVars().user,b=user_winning_noms_cache[a],c={},d="";d=d="";for(d=0;d<b.length;d++)if(c[b[d].nom_cat]==undefined)c[[b[d].nom_cat]]=1;else c[b[d].nom_cat]+=1;for(var e in c)if(e!="undefined"){d=e;d=d.replace(" ","_").toLowerCase();d='<div class="winning_trophy_cont"><a href="/#/trophy/user='+a+"/trophy="+d+'"><img src="http://portrit.s3.amazonaws.com/img/trophies/medium/'+d+'.png"/><div class="winning_trophy_count nom_cat_'+d+'">'+c[e]+"</div></a></div>";
$("#trophy_cont").append(d)}}var my_feed_next_page="",my_photo_feed_next_page="",feed_next_page="",photo_feed_next_page="",my_newest_post_time=null,my_newest_photo_post_time=null,their_newest_post_time=null,their_newest_photo_post_time=null,my_feed_first_page=null;
function init_profile_view(){if($("#profile_cont").children().length===0){append_load($("#scroller"),"light");$.getJSON("/get_top_feed/",function(a){remove_load();my_feed=a;if(my_feed.length==0){hide_stream_fixtures();render_empty_nom_page()}else{show_stream_fixtures();render_feed(my_feed);$("#profile_cont").show()}})}}
function init_info_view(){var a=getUrlVars().user;if(user_profile===null)FB.api("/"+a+"/",function(b){render_profile(b)});else $("#profile_info_img").length==0&&render_profile(user_profile)}
function transition_to_info(){view_active="info";var a=$("#friend_album_cont").width();$("#friend_album_cont").queue([]).stop();$("#info_wrap").show();a=$("#info_wrap").height()+50;if(a<400)a=600;$("#friend_album_cont").css({"min-height":a,height:""});a=$("#info_wrap").outerWidth()+30;if(mobile){$("#album_cont").css({opacity:"0.5"});$("#friend_album_cont").css({left:a})}else{$("#album_cont").fadeTo(0.45,0.5);$("#friend_album_cont").animate({left:a},450,"easeOutCubic");$("#album_cont").live("click",
function(){$("#user_photo_view").click()})}click_hold_timer=null;mouse_up=false;typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Info","Shown",""])}
function transition_to_profile(){view_active="profile";var a=$("#friend_album_cont").width();$("#friend_album_cont").queue([]).stop();$("#profile_wrap").show();a=-($("#profile_wrap").outerWidth()+35);if(mobile){tablet&&$("#album_cont").css({opacity:"0.5"});$("#friend_album_cont").css({left:a})}else{$("#album_cont").fadeTo(0.45,0.5);$("#friend_album_cont").animate({left:a},450,"easeOutCubic");$("#album_cont").live("click",function(){$("#user_photo_view").click()})}a=$("#profile_wrap").outerHeight()+
$("#header").height()+$("#main_view_control").outerHeight();$("#friend_album_cont").css({"min-height":a});click_hold_timer=null;mouse_up=false;typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Profile","Shown",""])}
function transition_to_album(){view_active="album";clearInterval(update_feed_interval);$("#friend_album_cont").height();$("#friend_album_cont").width();$("#album_cont").show();var a=$("#album_cont").height()+50;if(a<400)a=600;$("#friend_album_cont").css({height:a,"min-height":""});if(mobile){if(tablet){$("#album_cont").css({opacity:"1.0"});$("#friend_album_cont").css({left:"0px"});$("#profile_wrap").hide();$("#info_wrap").hide()}else{$("#profile_wrap").hide();$("#info_wrap").hide();$("#friend_album_cont").show();
$("#friend_album_cont").css({left:"0px"});$("#album_cont").css({opacity:"1.0"})}user_feed=null;$("#profile_cont").html("")}else{$("#album_cont").fadeTo("fast",1);$("#friend_album_cont").animate({left:"0px"},450,"easeOutCubic",function(){$("#profile_wrap").hide();$("#info_wrap").hide();user_feed=null;$("#profile_cont").html("")});$("#album_cont").die("click")}}
function photo_list_view(a){view_active="list";photo_comment_cache={};$(".photo_album").queue([]).stop();$("#friend_cont").hide();$("#friend_album_cont").css({"min-height":"",height:""});$("#title").css({position:""});$("#photo_large").css({"min-height":""});if(mobile){$("#title").show();$("#photo_cont").show();$("#photo_cont").css({"max-width":""})}else{$("#title").fadeIn();$("#photo_cont").fadeIn(350,function(){$(this).show()})}if($("#photo_cont").children().length==0||$("#photo_list").length==
0){mobile||(high_photo_offset=100);$("#photo_cont").html("");$("#photo_cont").append('<div id="left_quick_nav"><a></a></div><div id="right_quick_nav"><a id="top_quick_nav"><a id="bottom_quick_nav"></a></a></div><div id="photo_scroller"><div id="photo_list"></div></div><div id="photo_cache" style="display:none;"></div><div id="photo_large"></div>')}else $("#photo_large").html("");if($(".photo_album:hidden").length>0)mobile?$(".photo_album").show():$(".photo_album").fadeOut(function(){init_list_view(a)});
else if(albums==null)get_user_albums(getUrlVars().user,5,init_list_view,a);else if((high_photo_offset==0||high_photo_offset==100)&&$("#photo_list").children().length==0)init_list_view(a);else{$(".photo_thumbs").show().css({opacity:"1.0",display:"inline-block",position:"relative",top:"0px",left:"0px"});$("#title").html("<h3>"+selected_album.album.name+"</h3>").show();$("#photo_list").children().length==0&&init_list_view(a);get_user_noms()}$("#friend_album_cont").html("");typeof _gaq!=="undefined"&&
_gaq.push(["_trackEvent","Photo_List","Shown",""])}var high_photo_offset=100,album_completed=false;
function init_list_view(a){var b=null;b=false;var c=0,d=0,e=0,f=high_photo_offset,g="";photo_load_once=false;if(a)g='style="display:none;"';for(var h=0;h<albums.length;h++)if(albums[h].album.id===selected_album_id&&b===false){b=albums[h].photos;selected_album=albums[h];var j=0,m=selected_album.album.count;$("#title").html("<h3>"+selected_album.album.name+"</h3>").show();if($("#photo_list .photo_thumbs").length==0){if(f>b.length)f=b.length;for(var l=0;l<f;l++)if(b[l]){if(b[l].width>b[l].height){c=
130;d=130*(b[l].height/b[l].width)}else{c=130*(b[l].width/b[l].height);d=130}$("#photo_list").append('<div class="photo_thumbs" '+g+' onclick="void(0)"><img style="width: '+c+"px; height: "+d+'px;" id="'+b[l].id+'" src="'+b[l].picture+'"/></div>');j++}}else f=$("#photo_list").children().length;if(j<m||selected_album.album.id=="tagged"){var i=b.length,k=false,n=false,q="";q=selected_album.album.id=="tagged"?selected_user:selected_album.album.id;var u=function(v){k===false&&FB.api("/"+q+"/photos?fields=id,picture,source,height,width&limit=40&offset="+
i,function(o){remove_load();albums[v].photos=albums[v].photos.concat(o.data);i+=40;if(i>=high_photo_offset&&!a){e=0;n=false}else e=o.data.length;if(e>0){u(v);n=true;for(var w=0;w<o.data.length;w++){if(view_active==="gallery")$("#photo_list").append('<div class="photo_thumbs" style="display:none;" onclick="void(0)"><img id="'+o.data[w].id+'" src="'+o.data[w].picture+'"/></div>');else{if(o.data[w].width>o.data[w].height){c=130;d=130*(o.data[w].height/o.data[w].width)}else{c=130*(o.data[w].width/o.data[w].height);
d=130}$("#photo_list").append('<div class="photo_thumbs" '+g+' onclick="void(0)"><img style="width: '+c+"px; height: "+d+'px;" id="'+o.data[w].id+'" src="'+o.data[w].picture+'"/></div>')}j++}}else{if(n===false)for(w=0;w<o.data.length;w++){if(view_active==="gallery")$("#photo_list").append('<div class="photo_thumbs" style="display:none;" onclick="void(0)"><img id="'+o.data[w].id+'" src="'+o.data[w].picture+'"/></div>');else{if(o.data[w].width>o.data[w].height){c=130;d=130*(o.data[w].height/o.data[w].width)}else{c=
130*(o.data[w].width/o.data[w].height);d=130}$("#photo_list").append('<div class="photo_thumbs" '+g+' onclick="void(0)"><img style="width: '+c+"px; height: "+d+'px;" id="'+o.data[w].id+'" src="'+o.data[w].picture+'"/></div>')}j++}window.sessionStorage!==undefined&&sessionStorage.setItem("albums_"+selected_user,JSON.stringify(albums));k=true;if(i>=high_photo_offset){e=0;high_photo_offset=i;high_photo_offset+=80;photo_load_once=true;$(".photos_loading").remove()}}if(o.data.length==0){$(".photos_loading").remove();
album_completed=true}})};if(f>=100)high_photo_offset=f;f+=80;if(high_photo_offset<b.length){if(f>b.length)f=b.length;for(l=high_photo_offset;l<f;l++){if(b[l].width>b[l].height){c=130;d=130*(b[l].height/b[l].width)}else{c=130*(b[l].width/b[l].height);d=130}$("#photo_list").append('<div class="photo_thumbs" '+g+' onclick="void(0)"><img style="width: '+c+"px; height: "+d+'px;" id="'+b[l].id+'" src="'+b[l].picture+'"/></div>');j++}photo_load_once=true;if(f==albums[h].album.count){album_completed=true;
remove_load()}}else{append_load($("#photo_list"),"dark");u(h)}}else{album_completed=true;remove_load()}b=true}if(selected_album_id==="video_album"){$("#title").html("<h3>Videos</h3>");for(l=0;l<user_videos.length;l++)$("#photo_list").append('<div class="photo_thumbs" onclick="void(0)"><img id="'+user_videos[l].id+'" src="'+user_videos[l].picture+'"/></div>')}winning_user_album_cache[selected_album_id]&&render_list_view_trophies(winning_user_album_cache[selected_album_id])}
function get_photo_comments(a){photo_comment_cache[a]!==undefined?render_photo_comments(photo_comment_cache[a],a):FB.api("/"+a+"/comments",function(b){photo_comment_cache[a]=b.data;render_photo_comments(b.data,a)})}
function render_photo_comments(a,b){var c="",d="",e="";if(b==selected_photo)if(a&&a.length>0){$("#photo_comments").append("<h2>Facebook Comments</h2>");for(var f=0;f<a.length;f++){if(a[f].from!=undefined){e=a[f].from.name;if(e==me.name)e="you";d='<a href="#/user='+a[f].from.id+'" class="post_username from_username clear_profile">'+e+"</a>"}c+='<div class="photo_comment comment"><a href="#/user='+a[f].from.id+'"><img class="user_photo" src="http://graph.facebook.com/'+a[f].from.id+'/picture?type=square"/></a>'+
d+"<p>"+a[f].message+"</p></div>"}$("#photo_comments").append(c);$("#photo_comments").show()}}function photo_click_handler(){selected_user=getUrlVars().user;selected_photo=$("img",this).attr("id");if(view_active==="gallery")getUrlVars().album!=="video_album"?photo_gallery_view():video_gallery_view();else update_urls()}var first_gallery=true;
function photo_gallery_view(){view_active="gallery";var a=selected_photo,b=null,c=0,d=0;photo_large_view=true;$("#photo_comments").hide();$(".like").remove();$("#photo_comments").html("");d=null;var e=0,f=$("#photo_cont").width();$("#photo_list").position();for(var g=f/2,h=[],j=null,m=0,l=0,i=0,k=0,n=false,q=0,u=d=0;u<selected_album.photos.length;u++)if(selected_album.photos[u]!=undefined&&selected_album.photos[u].id==a){if(prev_photo_id===null)prev_photo_id=$("#"+a).parent().index();else{d=$("#"+
a).parent().index();if(prev_photo_id<d)e=f+200;else if(prev_photo_id>d)e=-200;prev_photo_id=d}c=prev_photo_id-3>=0?prev_photo_id-3:0;d=prev_photo_id+3<=selected_album.photos.length?prev_photo_id+3:selected_album.photos.length;mobile||$(".photo_thumbs").queue([]).stop();$('.photo_thumbs[name="selected"]').css({opacity:"0.6"}).attr("name","");$(".photo_thumbs").filter(":hidden").css({position:"absolute",left:e,top:"0px"});j=$(".photo_thumbs").slice(c,d+1);$(j).show();$(".photo_thumbs:lt("+c+")").hide();
$(".photo_thumbs:gt("+d+")").hide();$("#"+selected_photo).parent().css({opacity:"1.0"}).attr("name","selected");h=[];l=m=0;n=false;$(j).each(function(){l=$(this).width();if($(this).attr("name")==="selected"){m+=l/2;n=true}else if(n===false)m+=l+10;h.push(l+10)});i=0;k=g-m-20;$(j).each(function(v){$(this).css({left:i+k,top:0});i+=h[v]});b=selected_album.photos[u];$("#photo_cache").html("");if(load_next_clicked){c=u+1;if(d+1<selected_album.photos.length)d+=1}else if(load_prev_clicked)d=u;for(c=c;c<
d;c++)selected_album.photos[c]&&$("#photo_cache").append('<img src="'+selected_album.photos[c].source+'"/>');if($("#photo_large_inline").length>0){$("#submit_photo_comment").attr("name",b.id);if(mobile)if(tablet){$("#photo_large_inline_cont").css({height:b.height,width:b.width});$("#photo_large_inline").remove();$("#photo_large_inline_cont").prepend('<img id="photo_large_inline" src="'+b.source+'"/>')}else{d=q=0;if(b.width>b.height){q=500;d=500*(b.height/b.width)}else{q=500*(b.width/b.height);d=500}$("#photo_large_inline_cont").css({height:d,
width:q});$("#photo_large_inline").remove();$("#photo_large_inline_cont").prepend('<img id="photo_large_inline" src="'+b.source+'" style="height:'+d+"px; width:"+q+'px;"/>')}else{$("#photo_large_inline_cont").css({height:b.height,width:b.width});$("#photo_large_inline").remove();$("#photo_large_inline_cont").prepend('<img id="photo_large_inline" src="'+b.source+'"/>')}}else{$("#back_gallery").length<=0?$("#photo_large").html('<div id="back_gallery" onclick="void(0)"><div id="back_gallery_img"></div></div><div id="photo_large_inline_cont"><img style="display: none;" id="photo_large_inline" src="'+
b.source+'"/><span id="nominate_photo" class="sick_abs magenta large">Nominate</span> <div id="like_cont"></div></div><div id="forward_gallery" onclick="void(0)"><div id="forward_gallery_img"></div></div><div id="photo_comments" style="display:none;"></div>'):$("#photo_large_inline").attr("src",b.source);if(!mobile||tablet)$("#photo_large_inline_cont").css({height:b.height,width:b.width});else{if(b.width>b.height){q=500;d=500*(b.height/b.width)}else{q=500*(b.width/b.height);d=500}$("#photo_large_inline_cont").css({height:d,
width:q});$("#photo_large_inline").css({height:d,width:q})}$("#photo_large_inline").fadeIn("fast")}if(b.name!==undefined)$("#photo_title").length<=0?$("#photo_large_inline_cont").after('<p id="photo_title">'+b.name+"</p>"):$("#photo_title").text(b.name);else $("#photo_title").text("")}if(!mobile||tablet)q=b.width;$(".trophy_cont_gallery").remove();if(winning_user_photo_dict[selected_photo]){a=winning_user_photo_dict[selected_photo].cat.replace(" ","_").toLowerCase();$("#nominate_photo, #go_nom_detail").attr("id",
"go_nom_detail").attr("value",winning_user_photo_dict[selected_photo].nom_id).text("Details");$("#photo_large_inline_cont").append('<div class="trophy_cont_gallery trophy_img large '+a+'"></div>')}else if(active_user_nom_cache[selected_photo])$("#nominate_photo, #go_nom_detail").attr("id","go_nom_detail").attr("value",active_user_nom_cache[selected_photo].nom_id).text("Active");else $("#go_nom_detail").length>0&&$("#go_nom_detail").attr("id","nominate_photo").text("Nominate");$("#nominate_photo, #go_nom_detail").show().css({left:q/
2-$("#nominate_photo, #go_nom_detail").width()/2});click_hold_timer=null;mouse_up=false;get_photo_comments(selected_photo,fb_session.access_token)}
function video_gallery_view(){view_active="gallery";var a=selected_photo,b=null,c=0,d=0;photo_large_view=true;$("#title").hide();if($("#photo_list").children().length===0){$("#friend_cont").hide();photo_list_view();view_active="gallery"}if(selected_photo==="")a=selected_photo=$(".photo_thumbs:first > img").attr("id");var e=null,f=0,g=$(document).width();$("#photo_list").position();var h=g/2,j=[];e=null;for(var m=0,l=0,i=0,k=0,n=false,q=0;q<user_videos.length;q++)if(user_videos[q].id===a){c=q-3>=0?
q-3:0;d=q+3<=user_videos.length?q+3:user_videos.length;$(".photo_thumbs").queue([]).stop();if(prev_photo_id===null)prev_photo_id=$("#"+a).parent().index();else{e=$("#"+a).parent().index();if(prev_photo_id<e)f=g+200;else if(prev_photo_id>e)f=-200;prev_photo_id=e}$('.photo_thumbs[name="selected"]').css({opacity:"0.6"}).attr("name","");$(".photo_thumbs").filter(":hidden").css({left:f,top:"0px"});e=$(".photo_thumbs").slice(c,d+1);$(e).show();$(".photo_thumbs:lt("+c+")").hide();$(".photo_thumbs:gt("+d+
")").hide();$("#"+selected_photo).parent().css({opacity:"1.0"}).attr("name","selected");j=[];l=m=0;n=false;$(e).each(function(){l=$(this).width();if($(this).attr("name")==="selected"){m+=l/2;n=true}else if(n===false)m+=l+10;j.push(l+10)});i=0;k=h-m-40;$(e).each(function(u){mobile?$(this).css({left:i,top:0}):$(this).animate({left:i+k,top:0},300);i+=j[u]});b=user_videos[q];$("#photo_large").css({"min-height":350,"z-index":1E4});if($("#video_large_inline").length>0)$("#video_large_inline").fadeOut("fast",
function(){$("#photo_large").html('<div id="back_gallery" onclick="void(0)"><div id="back_gallery_img"></div></div><div id="video_large_inline" style="display:none;">'+b.embed_html+'</div><div id="forward_gallery" onclick="void(0)"><div id="forward_gallery_img"></div></div>');mobile===false?$("#video_large_inline").fadeIn("fast"):$("#video_large_inline").show()});else{$("#photo_large").html('<div id="back_gallery" onclick="void(0)"><div id="back_gallery_img"></div></div><div id="video_large_inline" style="display:none;">'+
b.embed_html+'</div><div id="forward_gallery" onclick="void(0)"><div id="forward_gallery_img"></div></div>');mobile===false?$("#video_large_inline").fadeIn("fast"):$("#video_large_inline").show()}}click_hold_timer=null;mouse_up=false}var like_tooltip_timeout=null,expand_timeout=null;
function show_like_tooltip(a){clearTimeout(like_tooltip_timeout);$(".tooltip:visible").css({top:"0px",opacity:"0"});var b=$(a).attr("name");if(b!=""){$(a).outerHeight();var c=$(a).position().left+($(a).outerWidth()-$(".tooltip").width())/2-4,d=$(a).position().top-30;$(a).parent().find(".tooltip").text(b).css({top:d,left:c,width:"150px",opacity:"1.0","z-index":"100"})}}function hide_like_tooltip(a){$(a).parent().find(".tooltip").css({opacity:"0","z-index":"-1"})}
function like_photo_handler(){var a=$(this).attr("id").replace("lid_",""),b=$(this).parent();$(this).remove();$(b).append('<div class="like" name="Like"><img id="me_like_'+a+'" style="display:none;" class="user_liked" src="http://graph.facebook.com/'+me.id+'/picture?type=square"/></div>');$("#me_like_"+a).fadeIn();$.post("https://graph.facebook.com/"+a+"/likes",{access_token:fb_session.access_token},function(){});typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Like","Photo","Clicked"])}
function render_more_comments(a,b){$(b).find(".comment").remove();for(var c="",d="",e=null,f=null,g=0;g<a.length;g++){c=friends[a[g].comments.owner_id]!=undefined?friends[a[g].comments.owner_id].name:a[g].comments.owner_id==me.id?"You":"";f=new Date;e=new Date(a[g].comments.create_datetime*1E3);f-=e;f/=1E3;e=secondsToHms(parseInt(f));d+='<div class="comment"><p class="comment_time" value="'+a[g].comments.create_datetime+'">'+e+'</p><a href="#/user='+a[g].comments.owner_id+'" class="clear_profile"><img class="user_photo" src="https://graph.facebook.com/'+
a[g].comments.owner_id+'/picture?type=square"/></a><a href="#/user='+a[g].comments.owner_id+'" class="post_username from_username clear_profile">'+c+"</a><p>"+a[g].comments.comment+"</p></div>"}$(b).find(".recent_nom_comment_heading").after(d)}function load_more_comments_handler(){var a=$(this).attr("value"),b=this;$.getJSON("/get_nom_comments/",{nom_id:a},function(c){if(active_noms_cache[a])active_noms_cache[a].comments=c;render_more_comments(c,$("#nom_comments_"+a));$(b).remove()})}
function hide_more_comments_handler(){var a=$(this).prev().prev();$(a).css({"min-height":""});var b=$(a).children().length-2;$(a).children().filter(":lt("+b+")").remove();$(this).text("Load More Comments").removeClass("hide_more_comments").addClass("load_more_comments")}
function add_comment_peek_handler(){var a='<div class="comment_form_cont" style="display: none;"><div class="comment_top_head"><a class="submit_comment sick large" name="'+$(this).attr("value")+'">Post</a><a class="cancel_comment sick large">Close</a></div><textarea id="new_comment_body" class="comment_body"></textarea></div></div>';if($(this).parent().find(".comment_form_cont").length==0){$(this).parent().append(a);a=$(this).parent();mobile===false?$(a).find(".comment_form_cont").slideDown(function(){$(this).find(".comment_body").focus()}):
$(a).find(".comment_form_cont").show().find(".comment_body").focus();$(this).hide();$(this).next().hasClass("load_more_comments")&&$(this).next().hide()}}function cancel_comment_handler(){var a=$(this).parent().parent();if(mobile){$(a).prev().show();$(a).prev().prev().show();$(a).remove()}else $(a).slideUp(function(){$(a).prev().show();$(a).prev().prev().show();$(this).remove()});return false}
function submit_comment_handler(){var a=$(this).attr("name"),b=$(this).parent().parent(),c=$(this).parent().next().val();if(view_active==="gallery"){if(c!=""){$("#cancel_photo_comment").click();$("#photo_comment_body").val("");$("#photo_comments").show();photo_comment_cache[a]=is_array(photo_comment_cache[a])?photo_comment_cache[a].concat({fromid:me.id,text:c}):[{fromid:me.id,text:c}];var d='<div class="photo_comment comment" style="display:none;"><img class="user_photo" src="http://graph.facebook.com/'+
me.id+'/picture?type=square"/><p>'+c+"</p></div>";$("#photo_comments").append(d);$("#photo_comments").children().filter(".photo_comment:last").fadeIn();$.post("https://api.facebook.com/method/comments.add?text="+c+"&object_id="+a+"&publish_to_stream=true&access_token="+fb_session.access_token,{text:c,object_id:a,publish_to_stream:"true",access_token:fb_session.access_token},function(){});comment_form_shown=false}}else if(view_active==="profile"||view_active=="main")c!=""&&$(this).parent().parent().fadeOut("fast",
function(){$("#photo_comments").show();var e='<div class="comment_self" style="display:none;"><div class="like" name="Like"><img style="display: none; " class="like_photo" src="http://portrit.s3.amazonaws.com/img/like.png"></div><a href="#/user=me"><img class="user_photo" src="http://graph.facebook.com/'+me.id+'/picture?type=square"></a><p>'+c+"</p></div>",f=$(b).parent().children().filter(".post_comments");if(f.length===0){e='<div class="post_comments">'+e+"</div>";$(b).parent().append(e);$(b).parent().find(".comment_self").fadeIn()}else{$(f).append(e);
$(f).children().last().fadeIn()}e=$(b).prev().clone();$(b).prev().remove();$.post("https://graph.facebook.com/"+a+"/comments",{access_token:fb_session.access_token,message:c},function(){});$(b).parent().append(e);$(b).parent().children().filter(".add_comment_peek").fadeIn();$(b).remove();$(this).remove();comment_form_shown=false});return false}
function album_peek(){peek_on=true;peek_ended=false;peeked_photos=[];var a=album==undefined?$(touch_album).children():$(album).children(),b=[-55,90,0,90],c=[-70,-70,75,75];$(a).each(function(d){var e=b[d];d=c[d];var f=null,g="";g=$(this).css("-webkit-transform");var h=$(this).css("-moz-transform");if(g!==null)f=g;else if(h!==null)f=h;g="translate("+e+"px, "+d+"px)";$(this).css({"-moz-transform":g,"-webkit-transform":g,"z-index":start_z_index});start_z_index+=1;peeked_photos.push({photo:this,rot:f})});
$(a).parent().next().css("z-index",100);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Peek","Shown",""])}function reset_peek(){for(var a=0;a<peeked_photos.length;a++){var b=peeked_photos[a].photo,c=peeked_photos[a].rot;peek_on=false;peek_ended=true;$(b).css({"-moz-transform":c,"-webkit-transform":c})}$(b).parent().next().css("z-index",1001);peeked_photos=[]}
function photo_swipe(){var a=last_x-first_x,b=last_y-first_y;a>125&&Math.abs(b)<150&&$("#back_gallery, #back_gallery_mobile").click();a<-125&&Math.abs(b)<150&&$("#forward_gallery, #forward_gallery_mobile").click()}function album_profile_swipe(){var a=last_x-first_x,b=last_y-first_y;a>125&&Math.abs(b)<150&&$("#profile_left").click();a<-125&&Math.abs(b)<150&&$("#profile_right").click()}
function attach_upgrade_handlers(){$(".friend_ref_cont").live("click",function(){var a=$(this).attr("id"),b=$(this).attr("value"),c=$(this).attr("name");$(this).remove();a='<div class="reffed_friend" id="'+a+'" value="'+b+'" name="'+c+'"><img src="https://graph.facebook.com/'+b+'/picture?type=square"><img class="kill_referral" src="http://portrit.s3.amazonaws.com/img/x_medium.png"></div>';if($("#refer_button").length===0){$("#refferal_cont").append('<h3>Tell your friends how much you love Portrit!</h3><textarea id="refer_post" class="comment_body"></textarea><a id="refer_button" class="sick">Refer 1 friend</a>');
$("#reffered_friends").append('<div class="clear"></div>')}else{b=$(".reffed_friend").length+1;$("#refer_button").text("Refer "+b+" friends")}$("#reffered_friends > .clear").before(a);typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Referral","Added",""])});$(".comment_body").live("focus",function(a){comment_form_shownn=true;a.stopPropagation()});$(".kill_referral").live("click",function(){$(this).parent().remove();if($(".reffed_friend").length===0){$("#reffered_friends").html("");$("#refer_button").remove();
$("#refer_post").remove()}else{var a=$(".reffed_friend").length;a===1?$("#refer_button").text("Refer "+a+" friend"):$("#refer_button").text("Refer "+a+" friends")}typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Referral","Removed",""])})}function attach_mobile_alpha_handlers(){$(".friend").live("click",function(){selected_user=$(this).attr("value");update_urls()})}
function attach_alpha_handlers(){view_active="alpha";$("#friend_cont").show();$("#wall_cont").show();$(".no_alpha").hide();$(".alpha_key").show();$(".friend").die("click");$("html, body").scrollTop(0);$(".friend").live("click",function(a){$(".friend").show();scroll_to_user=$(this).attr("value");window.location.hash="/";a.stopPropagation();return false})}
function attach_main_handlers(){$(".friend").live("click",function(){if(default_view=="wall"){var a=$(this).attr("value");window.location.href="/#/user="+a}else{a=$(".alpha_key_wall",this).text();window.location.href="/#/alpha_key="+a}})}
function attach_info_handlers(){$("#show_all_mutual").live("click",function(){if(mutual_friend_top<mutual_friend_data.length){render_mutual_friends(mutual_friend_data,"all");$("#show_all_mutual").text("Hide")}else{mutual_friend_top=10;mobile?$("#mutual_friend_cont > a:gt(9)").remove():$("#mutual_friend_cont > a:gt(9)").fadeOut("fast",function(){$(this).remove()});$("#show_all_mutual").text("Show All")}});$(".control_click").live("click",function(b){$(this).attr("name");getUrlVars();b.stopPropagation();
return false});if(!mobile){var a=null;$("#mutual_friend_cont a").live("mouseover mouseout",function(b){if(b.type=="mouseover"){clearTimeout(a);b=$(this).attr("name");var c=$(this).position();$("#mutual_friend_tooltip").text(b).show().css({opacity:"1.0",left:c.left-50,top:c.top-25})}else{$("#mutual_friend_tooltip").css({opacity:"0"});a=setTimeout(function(){$("#mutual_friend_tooltip").hide()},300)}})}}
function watch_scroll(a){var b=$(window);a=$("#profile_wrap");if(b.height()+b.scrollTop()>=a.outerHeight()-350)if(feed_load_once&&view_active=="main"&&(default_view=="wall"||default_view=="photo_stream")&&!initial_feed_load||feed_load_once&&view_active=="profile"&&!initial_feed_load)get_user_feed()}
function update_nom_stream_vote_count(a,b){$("#nom_vote_count").text(b.vote_count);if(user_winning_noms_cache[b.nominatee])for(var c=user_winning_noms_cache[b.nominatee].active_nom_objs,d=0;d<c.length;d++)if(a==c[d].id)c[d].vote_count=b.vote_count}
function vote_up_handler(){var a=this,b=$(this).attr("value");if($(this).hasClass("won")==false){tut_on&&update_tut("vote");var c='<a href="#/user='+me.id+'" class="clear_profile" id="voted_'+me.id+'" name="'+me.name+'"><img src="https://graph.facebook.com/'+me.id+'/picture?type=square"/></a>';$("#nom_votes_wrap").append(c);$.post("/vote/",{method:"up",nomination_id:b},function(d){if(d){var e=$(a).parent().children().filter("p");$(e).text(d.vote_count);if(active_noms_cache[b]){active_noms_cache[b].vote_count=
d.vote_count;active_noms_cache[b].votes.push({vote_user:me.id,vote_name:me.name})}update_nom_stream_vote_count(b,d)}});typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Vote","Up",""]);$(".vote").addClass("won")}}
function vote_down_handler(){var a=this,b=$(this).attr("value");if($(this).hasClass("won")==false){tut_on&&update_tut("vote");var c='<a href="#/user='+me.id+'" class="clear_profile" id="voted_'+me.id+'" name="'+me.name+'"><img src="https://graph.facebook.com/'+me.id+'/picture?type=square"/></a>';$("#nom_votes_wrap").append(c);$.post("/vote/",{method:"down",nomination_id:b},function(d){if(d){var e=$(a).parent().children().filter("p");$(e).text(d.vote_count);if(active_noms_cache[b]){active_noms_cache[b].vote_count=
d.vote_count;active_noms_cache[b].votes.push({vote_user:me.id,vote_name:me.name})}update_nom_stream_vote_count(b,d)}});typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Vote","Down",""]);$(".vote").addClass("won")}}$("#close_overlay").live("click",close_context_overlay);
function close_context_overlay(a,b){$("#tab_nav > .selected").removeClass("selected");if(mobile){$("#wrapper").css("opacity",1);$("#context_overlay").hide();$("#context_overlay_cont").removeClass();$("#context_overlay_cont > div").html("")}else if(typeof b!=="undefined"&&b==true){$("#wrapper").css({opacity:1});$("#context_overlay").hide();$("#context_overlay_cont").removeClass();$("#context_overlay_cont > div").html("")}else if(typeof a!=="undefined"&&a==true){$("#context_overlay").hide();$("#context_overlay_cont").removeClass();
$("#context_overlay_cont > div").html("")}else{$("#wrapper").animate({opacity:1},250);$("#context_overlay").fadeOut("fast",function(){$("#context_overlay_cont").removeClass();$("#context_overlay_cont > div").html("")})}if(view_active=="gallery"){$("#forward_gallery, #back_gallery").show();$(".photo_thumbs").live("click",photo_click_handler)}$("#wrapper").css("min-height","")}
function show_context_overlay(a,b){$("#close_overlay").removeClass().addClass("close_img "+close_size);if(mobile){typeof a!=="undefined"&&$("#wrapper").css("opacity",0.3);$("#context_overlay").show()}else if(typeof a!=="undefined")if(typeof b!=="undefined"){$("#wrapper").css({opacity:0.3});$("#context_overlay").show()}else{$("#wrapper").animate({opacity:0.3},300);$("#context_overlay").fadeIn()}$("#context_overlay").css("top",150)}var clear_profile=false;
function attach_profile_handlers(){$(".clear_profile").live("click",function(){clear_profile=true});$(".submit_comment").live("click",submit_comment_handler);$(".add_comment_peek").live("click",add_comment_peek_handler);$(".load_more_comments").live("click",load_more_comments_handler);$(".hide_more_comments").live("click",hide_more_comments_handler);$(".cancel_comment").live("click",cancel_comment_handler);$(".photo_post img").live("click",function(){var c=$(this).attr("aid"),d=$(this).attr("pid"),
e=$(this).attr("owner");$("#photo_list").html("");albums=null;selected_photo=d;selected_album_id=c;selected_user=e;update_urls()});$(".photo_post a").live("click",function(){$("#photo_list").html("");albums=null});$(".nom_photo_thumbnail").live("click",function(){if($(this).attr("name")==undefined||$(this).attr("name")!="selected"){var c=$(this).attr("id").replace("nom_photo_",""),d=$(this).parent().children().filter('.nom_photo_thumbnail[name="selected"]').attr("id").replace("nom_photo_","");$(this).parent().parent().find(".vote_up, .vote_down").attr("name",
c);update_nom_cat(d,c)}});$(".vote_up").live("click",vote_up_handler);$(".vote_down").live("click",vote_down_handler);$("#activate_latest_photos").live("click",function(){$("#tab_nav > .selected").removeClass("selected");$(this).addClass("selected");$("#context_overlay_cont").removeClass().addClass("latest_photos_overlay");show_context_overlay(true,true);init_latest_photos();typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Latest Photos","Shown",""])});$("#activate_recent_winners").live("click",
function(){window.location.href="/#/recent-winners";typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Recent Winners","Shown",""])});$(".voted_cont a, .new_photo_cont").live("mouseover mouseout",function(c){c.type=="mouseover"?show_like_tooltip(this):hide_like_tooltip(this)});$(".new_photo_cont").live("click",function(){var c=$(this).attr("value");$("#photo_list").html("");$.getJSON("https://api.facebook.com/method/photos.get?access_token="+fb_session.access_token+"&pids="+c+"&format=json&callback=?",
function(d){d=d[0];var e=d.owner,f=d.album_object_id;selected_photo=String(d.object_id);window.location.href="#/user="+e+"/album="+f+"/gallery";$("#close_overlay").click()})});$(".next_photo").live("click",function(){var c=$(this).parent().prev().children().filter('[name="selected"]');$(c).next().click()});$(".prev_photo").live("click",function(){var c=$(this).parent().prev().children().filter('[name="selected"]');$(c).prev().click()});if(!mobile){$("#show_upload").live("click",function(){$("#context_overlay_cont").addClass("photo_upload");
$("#context_overlay_cont > div").append('<div id="photo_upload_cont"><h1>Post Photo</h1><div id="upload_left_cont"><form id="file_uploader" action="/upload_photo/" method="POST" enctype="multipart/form-data"><input type="file" name="file" multiple><div class="sick large">Select Photos</div></form></div><div id="upload_right_cont"><h2>Drag Photos Here</h2></div><div id="upload_controls"><a id="cancel_upload" class="sick large">Cancel</a><a id="post_upload" class="sick large">Submit</a></div><div class="clear"></div></div><div id="photo_upload_permission_cont"><div id="connecting_triangle"></div><h2>Upload Settings</h2><ul id="upload_permission_controls"><li><h3>Photos are public:</h3><div id="public_photo" class="switch switch_on"></div><div class="clear"></div></li><li><h3>Add to Portrit Facebook album: </h3><div id="facebook_photo" class="switch switch_on"></div><div class="clear"></div></li></ul></div>');
show_context_overlay(true,true);var c=0,d=null;$("#file_uploader").fileUpload({namespace:"file_upload_1",url:"/upload_photo/",dropZone:$("#upload_right_cont"),initUpload:function(e,f,g,h,j,m){if(/\.(png)|(jpg)|(jpeg)|(gif)$/i.test(f[g].name))if(f[g].size>2E6){$("#upload_right_cont").css("background-color","white");$("#upload_right_cont > h2").text("Drag Photos Here");$("#upload_error").remove();$("#photo_upload_cont > h1").after('<p id="upload_error">File size must be below 2MB.</p>');clearTimeout(d);
d=setTimeout(function(){$("#upload_error").fadeOut()},4500)}else{c+=1;append_load($("#upload_left_cont"),"light");a=true;m()}else{$("#upload_right_cont").css("background-color","white");$("#upload_right_cont > h2").text("Drag Photos Here");$("#upload_error").remove();$("#photo_upload_cont > h1").after('<p id="upload_error">Only .jpg, .png, and .gif are allowed.</p>');clearTimeout(d);d=setTimeout(function(){$("#upload_error").fadeOut()},4500)}},onLoad:function(e,f,g,h){c-=1;if(c<=0){remove_load();
a=false}e=JSON.parse(h.responseText);$("#upload_right_cont > div").length==0&&$("#upload_right_cont > h2").hide();e='<div class="photo_to_upload_cont" value="'+e.id+'"><div class="photo_to_upload_thumb"><img src="'+e.thumb+'"/></div><div class="photo_to_upload_name_cont"><p>'+e.name+'</p></div><p class="close_img '+close_size+'"></p></div>';$("#upload_right_cont").append(e);$("#upload_right_cont").css("background-color","white");$("#upload_right_cont > h2").text("Drag Photos Here")},onDragEnter:function(){$("#upload_right_cont").css("background-color",
"#E95C41");$("#upload_right_cont > h2").text("Drop")},onDragLeave:function(){$("#upload_right_cont").css("background-color","white");$("#upload_right_cont > h2").text("Drag Photos Here")}})});$("#cancel_upload").live("click",function(){$("#close_overlay").click()});$(".photo_to_upload_cont .close_img").live("click",function(){$(this).parent().remove();$("#upload_right_cont .photo_to_upload_cont").length==0&&$("#upload_right_cont > h2").fadeIn()});var a=false,b=[];$("#post_upload").live("click",function(){if(!a){user_winning_noms_cache[me.id]=
undefined;user_winning_noms_cache.me=undefined;var c=$("#public_photo"),d=$("#facebook_photo");b=[];if($("#upload_right_cont .photo_to_upload_cont").length>0){c=$(c).hasClass("switch_on")?true:false;d=$(d).hasClass("switch_on")?true:false;var e="";$(".photo_to_upload_cont").each(function(){var f=$(this);e+=$(f).attr("value")+",";b.push({id:$(f).attr("value"),thumbnail:$(f).find(".photo_to_upload_thumb img").attr("src")})});$.post("/mark_photos_live/",{photo_ids:e,public_perm:c,post_to_facebook:d},
function(){});close_context_overlay(true);render_photo_upload_nom(b);$("#cancel_nom").text("Skip")}typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Post Photo Upload","Click",""])}})}$(".add_new_comment").live("click",function(){var c='<div class="new_comment_cont" style="display:none;"><div class="comment_top_head"><a class="sick large post_new_comment" value="'+$(this).parent().attr("value")+'">Post</a><a class="sick large cancel_new_comment">Close</a></div><textarea class="comment_body"></textarea></div>';
$(this).parent().after(c);$(this).hide();$(this).parent().parent().find(".new_comment_cont").show();$(this).parent().parent().find(".comment_body").focus();typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Comment","Shown",""])});$(".cancel_new_comment").live("click",function(){var c=$(this).parent().parent();$(c).parent().find(".add_new_comment").show();$(c).remove()});$(".post_new_comment").live("click",function(){var c=$(this).parent().parent(),d=$(c).find(".comment_body").val().replace(/\n\r?/g,
"<br />"),e=$(this).attr("value"),f='<div class="comment" style="display:none;"><p class="comment_time" value="'+(new Date).getTime()/1E3+'">Right now</p><a href="#/user='+me.id+'" class="clear_profile"><img class="user_photo" src="https://graph.facebook.com/'+me.id+'/picture?type=square"/></a><a href="#/user='+me.id+'" class="post_username from_username clear_profile">You</a><p>'+d+"</p></div>";$(c).after(f);$(c).next().fadeIn();$(c).find(".cancel_new_comment").click();$(c).find(".comment_body").val("");
$("#nom_comments_"+e).find(".comment_empty").remove();tut_on&&update_tut("comment");$.post("/new_comment/",{body:d,nom_id:e},function(g){if(g){var h=new Date,j=null;$(".comment_time").each(function(){time=new Date($(this).attr("value")*1E3);j=h-time;j/=1E3;$(this).text(secondsToHms(parseInt(j)))})}});typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Comment","Posted",""])});$(".comment_body").live("focus",function(){comment_form_shown=true});$(".comment_body").live("blur",function(){comment_form_shown=
false});$("#load_more").live("click",function(){var c=$(".recent_nom_cont:last").attr("time");$(this).remove();$("#recent_left_cont").append('<div id="profile_loading"><img src="http://portrit.s3.amazonaws.com/img/ajax-loader-light.gif"/></div>');$.getJSON("/get_more_recent_stream/",{create_time:c},function(d){$("#profile_loading").remove();render_recent_stream(d)});typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Stream","Load More",""])});if(!mobile){selected_photo_noms={};$("#cancel_nom").live("click",
function(){$("#close_overlay").click();return false});$("#inactive_trophy_cont li").live("click",function(){if($(this).hasClass("active"))if($("#selected_noms > div").length<3){$("#selected_noms h4").hide();$("#selected_noms > div").length+1==3?$("#inactive_trophy_cont li").removeClass("active").addClass("inactive"):$(".inactive").removeClass("inactive");$(this).removeClass("active").addClass("selected");var c=$(this).find("h3").text().replace(" ","_").toLowerCase(),d=$(this).html();d='<div id="'+
c+'">'+d+'<span class="kill_nomination close_img '+close_size+'"></span></div>';$("#selected_noms").append(d);setTimeout(function(){$("#"+c).css({opacity:"1.0"})},50)}});$("#selected_noms > div").live("mouseover mouseout",function(c){c.type=="mouseover"?$(this).find(".kill_nomination").show():$(this).find(".kill_nomination").hide()});$("#selected_noms > div").live("click",function(){var c=$(this).attr("id");c="#"+c+"_cont";$(c).addClass("active").removeClass("selected");$(this).remove();$("#active_nominations_cont").children().length<
3&&$(".inactive").removeClass("inactive").addClass("active");$("#selected_noms > div").length==0&&$("#selected_noms > h4").show()});$("#nom_caption").live("focus",function(){if(this.value==this.defaultValue)this.value="";this.value!=this.defaultValue&&this.select()});$("#nom_caption").live("blur",function(){if($.trim(this.value)=="")this.value=this.defaultValue?this.defaultValue:""});$("#nom_caption").live("keydown",function(c){var d=$(this).val().length;$("#text_remail_cont").text(d+"/90");if(d>=
90&&c.keyCode!=8)return false});$("#post_nomination").live("click",function(){var c=true;if($("#selected_noms > div").length>0&&!$(this).hasClass("sick_hover_lock")){push_nom(current_photo_id);$(this).text("Saving...");$(this).addClass("sick_hover_lock");for(var d in selected_photo_noms)if(d!=""&&d!=undefined){tut_on&&update_tut("nom");var e=selected_photo_noms[d].caption;if(e=="Add a caption to this nomination.")e="";$.post("/nominate_photo/",{nominations:selected_photo_noms[d].selected_nominations,
comment_text:e,portrit_photo_id:d,owner:me.id},function(f){if(c){c=false;render_share_nom(f,e)}})}typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Post Upload Nom","Click",""]);$("#close_overlay").click()}});$(".nom_photo_thumb_cont").live("click",function(){var c=$(this).attr("value"),d=$(this).position().left,e=$(this).width();d=d+e/2-37;$("#selected_photo_triangle").css("left",d);d=$(this).find("img").attr("src").replace("_130","_720");$("#selected_img").attr("src",d);push_nom(current_photo_id);
restore_nom(c);current_photo_id=c})}}var selected_photo_noms={};function push_nom(a){var b="";$("#selected_noms > div > h3").each(function(){b+=$(this).text()+","});selected_photo_noms[a]={selected_nominations:b,photo_id:a,caption:$("#nom_caption").val()};$("#selected_noms").html("");$("#nom_caption").val("");$("#inactive_trophy_cont li").removeClass().addClass("active")}
function restore_nom(a){if(selected_photo_noms[a]){var b=selected_photo_noms[a].selected_nominations.split(","),c="",d="";d="";for(var e=0;e<b.length;e++){if(b[e]!=""){c=b[e].replace(" ","_").toLowerCase();d=$("#"+c+"_cont").html();d='<div id="'+c+'">'+d+'<span class="kill_nomination close_img '+close_size+'"></span></div>';$("#selected_noms").append(d);$("#"+c+"_cont").removeClass().addClass("selected")}e==3&&$("#inactive_trophy_cont li").removeClass("active").addClass("inactive")}e<=1&&$("#selected_noms").append("<h4>No nominations selected.</h4>");
if(selected_photo_noms[a].caption!=""&&selected_photo_noms[a].caption!=undefined)if(selected_photo_noms[a].caption=="Add a caption to this nomination."){$("#nom_caption").val("Add a caption to this nomination.");$("#text_remail_cont").text("0/90")}else{$("#nom_caption").val(selected_photo_noms[a].caption);$("#text_remail_cont").text(selected_photo_noms[a].caption.length+"/90")}else{$("#nom_caption").val("Add a caption to this nomination.");$("#text_remail_cont").text("0/90")}$("#selected_noms > div").css("opacity",
1)}else{$("#nom_caption").val("Add a caption to this nomination.");$("#text_remail_cont").text("0/90")}}$(".switch").live("click",function(){$(this).hasClass("switch_on")?$(this).removeClass("switch_on").addClass("switch_off"):$(this).removeClass("switch_off").addClass("switch_on")});var current_photo_id=null;
function render_photo_upload_nom(a){var b=a[0],c=b.thumbnail.replace("_130","_720");current_photo_id=b.id;comment_form_shown=true;$("#context_overlay_cont").addClass("nominate_photo");$("#context_overlay_cont > div").append(nominate_photo_html);if(a.length>1){for(var d="",e=0;e<a.length;e++)d+='<div class="nom_photo_thumb_cont" value="'+a[e].id+'"><img src="'+a[e].thumbnail+'"/><p class="close_img normal"></p></div>';a='<div id="new_nom_photo_stream_cont">'+d+"</div>";$("#new_nom_middle_cont").after(a)}$("#selected_img").attr("src",
c).attr("value",b.id);$("#selected_photo_triangle").css("left",40);show_context_overlay(true,true)}
function inject_nom_detail(a){for(var b=$("#nom_detail_cont .title").attr("name"),c="",d=0;d<a.length;d++)if(a[d].nomination_category==b){c='<div id="nom_photo_'+a[d].id+'" class="nom_photo_thumbnail" style="height:'+a[d].photo.small_height+'px; opacity: 0.6;"><img src="'+a[d].photo.src_small+'"/><p class="nom_cat_'+a[d].nomination_category.replace(" ","_").toLowerCase()+'">'+a[d].vote_count+"</p></div>";$("#nom_cat_stream").append(c)}slide_images=$(".nom_photo_thumbnail");var e=[],f=0,g=0,h=false;
a=$("#nom_cat_stream").width()/2;$(slide_images).each(function(){g=$(this).width();if($(this).attr("name")==="selected"){f+=g/2;h=true}else if(h===false)f+=g+20;e.push(g+20)});var j=0,m=a-f;$(slide_images).each(function(l){$(this).css({left:j+m,top:0});j+=e[l]})}
function update_nom_detail(a,b){$("#main_nom_photo").attr("src",a.photo.src);$("#nom_vote_count").text(a.vote_count);$(".comment").remove();$("#nom_votes_wrap a").remove();$(".vote").attr("value",a.id);$("#main_nom_cont").attr("value",a.id);var c="",d="",e="",f="";c=friends[a.nominatee]?friends[a.nominatee].name:a.nominatee==me.id?a.won?"You":"You're":"";if(a.caption)d="Caption: "+a.caption;e=a.nominator==me.id?"You":a.nominator_name?a.nominator_name:friends[a.nominator]?friends[a.nominator].name:
"";f=a.nomination_category.replace(" ","_").toLowerCase();$("#trophy_cont").removeClass().addClass("nom_cat_"+f);$("#nomination_text_cont h3").text(a.nomination_category);$("#nom_trophy_icon").removeClass().addClass("trophy_img large "+f);$("#nominator_overlay_cont a").attr("href","/#/user="+a.nominator);$("#nominator_overlay_cont > h2 a").text(e);$("#nominator_overlay_cont p").text(d);$("#nominator_overlay_cont .user_img").attr("src","https://graph.facebook.com/"+a.nominator+"/picture?type=square");
$("div#nomination_text_cont .user_img").attr("src","https://graph.facebook.com/"+a.nominatee+"/picture?type=square");$("#nomination_text_cont a").attr("href","/#/user="+a.nominatee);$("#nomination_text_cont span").text(c);c="";c=a.won?"Won":"Nominated for";$("#nomination_text_cont p").text(c);get_nom_comments(a.id,b);render_nom_votes(a.votes)}
function attach_nom_detail_handlers(){$(".nom_photo_thumbnail").live("click",function(){var a=$(this).attr("id").replace("nom_photo_",""),b=null,c=getUrlVars().won;b=getUrlVars().trophy;b=c!=undefined||b!=undefined?winning_noms_cache[a]:active_noms_cache[a];a=$(".nom_photo_thumbnail");var d=[],e=0,f=0,g=false,h=$("#nom_cat_stream").width()/2;$('.nom_photo_thumbnail[name="selected"]').css({opacity:"0.6"}).attr("name","");$(this).css({opacity:"1.0"}).attr("name","selected");$(a).each(function(){f=$(this).width();
if($(this).attr("name")==="selected"){e+=f/2;g=true}else if(g===false)e+=f+20;d.push(f+20)});var j=0,m=h-e;$(a).each(function(l){$(this).css({left:j+m,top:0});j+=d[l]});update_nom_detail(b,c)});$(".won").live("mouseover mouseout",function(a){a.type=="mouseover"?show_like_tooltip(this):hide_like_tooltip(this)});$("#nom_votes_cont a").live("mouseover mouseout",function(a){a.type=="mouseover"?show_like_tooltip(this):hide_like_tooltip(this)});$("#add_new_comment").live("click",function(){var a=$(this).parent().parent().find("#new_comment_cont");
comment_form_shown=true;$(this).hide();$(a).show();$(".comment_body").focus()});$(".cancel_new_comment").live("click",function(){var a=$(this).parent().parent();comment_form_shown=false;$(a).hide();$("#add_new_comment").show()});$(".post_new_comment").live("click",function(){var a=$(".comment_body").val().replace(/\n\r?/g,"<br />"),b=$("#main_nom_cont").attr("value");tut_on&&update_tut("comment");var c=(new Date).getTime(),d='<div class="comment"><p class="comment_time" value="'+c/1E3+'">Right now</p><a href="#/user='+
me.id+'" class="clear_profile"><img class="user_photo" src="https://graph.facebook.com/'+me.id+'/picture?type=square"/></a><a href="#?user='+me.id+'" class="post_username from_username clear_profile">You</a><p>'+a+"</p></div>";$("#new_comment_cont").after(d);mobile?$(".comment_empty").hide():$(".comment_empty").fadeOut();$(".cancel_new_comment").click();$(".comment_body").val("");$.post("/new_comment/",{body:a,nom_id:b},function(){});c=new Date;var e=null;$(".comment_time").each(function(){time=new Date($(this).attr("value")*
1E3);e=c-time;e/=1E3;$(this).text(secondsToHms(parseInt(e)))})});$(".vote_up").live("click",vote_up_handler);$(".vote_down").live("click",vote_down_handler);$(".next_photo").live("click",function(){var a=$("#nom_cat_stream").children().filter('[name="selected"]');$(a).next().click()});$(".prev_photo").live("click",function(){var a=$("#nom_cat_stream").children().filter('[name="selected"]');$(a).index()!=2&&$(a).prev().click()});mobile&&!tablet&&addSwipeListener(document.body,function(a){a.direction==
"left"?$(".next_photo").trigger("click"):$(".prev_photo").trigger("click")})}var user_album_height_interval=null,user_album_height_interval_count=0;
function transition_trophy_view(a){var b=$(window).width(),c=$("#album_cont").height(),d=$("#profile_nav_cont");$(d).attr("value","trophies");$("h2",d).text("Profile");$("#album_right_arrow").hide();$("#album_left_arrow").show();$("#album_cont").show();$("#user_profile_cont").css({"min-height":c});clearInterval(user_album_height_interval);user_album_height_interval=setInterval(function(){if(user_album_height_interval_count<20){var e=$("#album_cont").height(),f=$("#user_profile_cont").css("min-height");
if(f!=e||f<e){$("#user_profile_cont").css("min-height",e);user_album_height_interval_count+=1}else{clearInterval(user_album_height_interval);user_album_height_interval_count+=0}}else{clearInterval(user_album_height_interval);user_album_height_interval_count+=0}},50);if(!mobile&&!a)$("#user_profile_cont").animate({right:b/2+480},300);else if(tablet)$("#user_profile_cont").css({right:b/2+480});else{$("#profile_nav_cont").css({right:"-100px"});$("#user_profile_cont").css({right:"520px"})}$("#profile_nav_cont").css("right",
0)}function transition_album_view(a){var b=$("#profile_nav_cont");$(b).attr("value","albums");$("h2",b).text("Albums");$("#album_right_arrow").show();$("#album_left_arrow").hide();$("#user_profile_cont").css({"min-height":""});if(!mobile&&!a)$("#user_profile_cont").animate({right:"0px"},300);else{tablet||$("#profile_nav_cont").css({right:"10px"});$("#user_profile_cont").css({right:"0px"})}$("#profile_nav_cont").css("right",10)}
function attach_user_profile_handlers(){$("#user_friends a").live("mouseover mouseout",function(a){a.type=="mouseover"?show_like_tooltip(this):hide_like_tooltip(this)});$("#profile_nav_cont").live("click",function(){$(this).attr("value")=="albums"?transition_trophy_view():transition_album_view()})}
function attach_album_handlers(){if(!mobile){$(".img_thumbs").live("mousedown",function(a){album=this;peek_ended=false;click_hold_timer=setTimeout(album_peek,200);a.stopPropagation();return false});$(document).bind("mouseup",function(){first_touch=mouse_up=true;reset_peek();clearTimeout(click_hold_timer)})}$("#load_more_fb_albums").live("click",function(){$(this).text("Hide");$(this).attr("id","hide_more_fb_albums");load_more_fb_albums(7);user_album_height_interval_count=0;clearInterval(user_album_height_interval);
user_album_height_interval=setInterval(function(){if(user_album_height_interval_count<20){var a=$("#album_cont").height(),b=$("#user_profile_cont").css("height");if(b!=a||b<a){$("#user_profile_cont").css("height",a);user_album_height_interval_count+=1}else{clearInterval(user_album_height_interval);user_album_height_interval_count+=0}}else{clearInterval(user_album_height_interval);user_album_height_interval_count+=0}},50)});$("#hide_more_fb_albums").live("click",function(){$(this).text("Load More");
$(this).attr("id","load_more_fb_albums");if(view_active=="main"){$("#user_profile_cont").css("height","auto");$("#user_profile_cont").css("min-height","auto");hide_more_fb_albums(5)}else hide_more_fb_albums(7)});$(".winning_trophy_cont").live("mouseover mouseout",function(a){a.type=="mouseover"?$(".winning_trophy_count",this).css("opacity","1"):$(".winning_trophy_count",this).css("opacity","0.8")});$("#user_info_view").live("click",function(){if(view_active!="info"){init_info_view();transition_to_info()}});
$("#user_photo_view").live("click",function(){view_active!="album"&&transition_to_album()});$("#user_wall_view").live("click",function(){if(view_active!="profile"){init_profile_view();transition_to_profile()}});$(".photo_album").live("click",function(){if(!peek_on&&!peek_ended){$("#photo_list").html("");selected_photo="";selected_album_id=$(this).attr("id");update_urls()}});$(".portrit_photo, #to_portrit_photos").live("click",function(){$("#photo_list").html("");selected_photo="";selected_album_id=
"portrit-photos";update_urls()});$(".photo_album").live("mouseover mouseout",function(a){a.type=="mouseover"?$(this).children(".album_title").css("background-color","#222"):$(this).children(".album_title").css("background-color","#444")});$(".trophy_album").live("click",function(){var a=$(this).attr("name").replace(" ","_").toLowerCase(),b=getUrlVars().user;if(!b)b=me.id;window.location.href="/#/trophy/user="+b+"/trophy="+a})}
function attach_list_handlers(){$(".photo_thumbs").live("click",photo_click_handler);$(window).bind("scroll",function(){if($(window).scrollTop()>=$("#photo_list").height()-$(window).height()*2)if(photo_load_once)album_completed||init_list_view()})}var nominate_photo_html='<div id="new_nom_wrap"><div id="new_nom_top_cont"><h1>Nominate Photo For A Trophy</h1><div id="inactive_trophy_cont"><ul><li class="active" id="hot_cont"><div class="trophy_img medium hot"></div><h3 class="nom_cat_hot_text">Hot</h3></li><li class="active" id="lol_cont"><div class="trophy_img medium lol"></div><h3 class="nom_cat_lol_text">LOL</h3></li><li class="active" id="artsy_cont"><div class="trophy_img medium artsy"></div><h3 class="nom_cat_artsy_text">Artsy</h3></li><li class="active" id="fail_cont"><div class="trophy_img medium fail"></div><h3 class="nom_cat_fail_text">Fail</h3></li><li class="active" id="party_animal_cont"><div class="trophy_img medium party_animal"></div><h3 class="nom_cat_party_animal_text">Party Animal</h3></li><li class="active" id="cute_cont"><div class="trophy_img medium cute"></div><h3 class="nom_cat_cute_text">Cute</h3></li><li class="active" id="wtf_cont"><div class="trophy_img medium wtf"></div><h3 class="nom_cat_wtf_text">WTF</h3></li><li class="active" id="creepy_cont"><div class="trophy_img medium creepy"></div><h3 class="nom_cat_creepy_text">Creepy</h3></li><li class="active" id="awesome_cont"><div class="trophy_img medium awesome"></div><h3 class="nom_cat_awesome_text">Awesome</h3></li><li class="active" id="yummy_cont"><div class="trophy_img medium yummy"></div><h3 class="nom_cat_yummy_text">Yummy</h3></li></ul></div></div><div id="new_nom_middle_cont"><div id="selected_nom_image_cont"><div><p>Selected Photo</p><img id="selected_img"/></div></div><div id="selected_nom_cont"><h2>Selected Nominations</h2><div id="selected_noms"><h4>No nominations selected.</h4></div></div><div class="clear"></div></div><div id="new_nom_bottom_cont"><div id="selected_photo_triangle"></div><textarea id="nom_caption">Add a caption to this nomination.</textarea><div id="text_remail_cont"><p>0/90</p></div><div id="nom_controls_cont"><a id="cancel_nom" class="sick large">Cancel</a><a id="post_nomination" class="sick large">Post Nomination</a></div><div class="clear"></div></div></div>';
function attach_gallery_handlers(){if(mobile){tablet||addSwipeListener(document.body,function(a){a.direction=="left"?load_next_picture():load_previous_picture()});$("#back_gallery, #back_gallery_mobile").live("touchend",function(a){a.stopPropagation();load_previous_picture();return false});$("#forward_gallery, #forward_gallery_mobile").live("touchend",function(a){a.stopPropagation();load_next_picture();return false})}else{$("#back_gallery, #back_gallery_mobile").live("click",function(a){if(!mobile){$(this).queue([]).stop();
$(this).animate({opacity:1},100,function(){$(this).animate({opacity:0.5},125)})}a.stopPropagation();load_previous_picture();return false});$("#forward_gallery, #forward_gallery_mobile").live("click",function(a){if(!mobile){$(this).queue([]).stop();$(this).animate({opacity:1},100,function(){$(this).animate({opacity:0.5},125)})}a.stopPropagation();load_next_picture();return false})}$("#nominate_photo").live("click",function(){comment_form_shown=true;$("#context_overlay_cont").addClass("nominate_photo");
$("#context_overlay_cont > div").append(nominate_photo_html);$("#selected_img").attr("src",$("#photo_large_inline").attr("src"));show_context_overlay(true,true);$("#forward_gallery, #back_gallery").hide();$(".photo_thumbs").die("click",photo_click_handler);return false});$("#go_nom_detail").live("click",function(){var a=$(this).attr("value");window.location.href=winning_user_photo_dict[selected_photo]?"/#/nom_id="+a+"/won":"/#/nom_id="+a});$("#cancel_nom").live("click",function(){$("#close_overlay").click();
return false});$("#inactive_trophy_cont li").live("click",function(){if($(this).hasClass("active"))if($("#selected_noms > div").length<3){$("#selected_noms h4").hide();$("#selected_noms > div").length+1==3?$("#inactive_trophy_cont li").removeClass("active").addClass("inactive"):$(".inactive").removeClass("inactive");$(this).removeClass("active").addClass("selected");var a=$(this).find("h3").text().replace(" ","_").toLowerCase(),b=$(this).html();b='<div id="'+a+'">'+b+'<span class="kill_nomination close_img '+
close_size+'"></span></div>';$("#selected_noms").append(b);setTimeout(function(){$("#"+a).css({opacity:"1.0"})},50)}});$("#selected_noms > div").live("mouseover mouseout",function(a){a.type=="mouseover"?$(this).find(".kill_nomination").show():$(this).find(".kill_nomination").hide()});mobile?$("#selected_noms > div").live("touchend",function(){var a=$(this).attr("id");a="#"+a+"_cont";$(a).addClass("active").removeClass("selected");$(this).remove();$("#active_nominations_cont").children().length<3&&
$(".inactive").removeClass("inactive").addClass("active");$("#selected_noms > div").length==0&&$("#selected_noms > h4").show()}):$("#selected_noms > div").live("click",function(){var a=$(this).attr("id");a="#"+a+"_cont";$(a).addClass("active").removeClass("selected");$(this).remove();$("#active_nominations_cont").children().length<3&&$(".inactive").removeClass("inactive").addClass("active");$("#selected_noms > div").length==0&&$("#selected_noms > h4").show()});$("#nom_caption").live("focus",function(){if(this.value==
this.defaultValue)this.value="";this.value!=this.defaultValue&&this.select()});$("#nom_caption").live("blur",function(){if($.trim(this.value)=="")this.value=this.defaultValue?this.defaultValue:""});$("#nom_caption").live("keydown",function(a){var b=$(this).val().length;$("#text_remail_cont").text(b+"/90");if(b>=90&&a.keyCode!=8)return false});$("#post_nomination").live("click",function(){var a="";if($("#selected_noms > div").length>0&&!$(this).hasClass("sick_hover_lock")){tut_on&&update_tut("nom");
$("#selected_noms > div > h3").each(function(){a+=$(this).text()+","});$(this).text("Saving...");$(this).addClass("sick_hover_lock");var b=$("#photo_large_inline").attr("src"),c=$('.photo_thumbs[name="selected"] img').attr("src"),d=$('.photo_thumbs[name="selected"] img').height(),e=$('.photo_thumbs[name="selected"] img').width(),f=$("#photo_large_inline").height(),g=$("#photo_large_inline").width(),h=$("#nom_caption").val();if(h=="Add a caption to this nomination.")h="";b={nominations:a,comment_text:h,
photo_id:selected_photo,photo_src:b,photo_src_small:c,photo_small_height:d,photo_small_width:e,photo_height:f,photo_width:g,album_id:selected_album.album.id,owner:selected_user};if(getUrlVars().album=="portrit-photos")b.portrit_photo_id=selected_photo;$.post("/nominate_photo/",b,function(j){for(var m="",l=0;l<j.length;l++){m=j[l].nomination_category.replace(" ","_").toLowerCase();if(active_noms_cache){active_noms_cache[j[l].id]=j[l];if(active_nom_cats_map[m])active_nom_cats_map[m].push(j[l].id);else active_nom_cats_map[m]=
[j[l].id];if(my_feed)for(m=0;m<my_feed.length;m++)my_feed[m].cat_name==j[l].nomination_category&&my_feed[m].noms.push(j[l])}if(user_winning_noms_cache[selected_user])user_winning_noms_cache[selected_user].active_nom_objs.push(j[l]);else{user_winning_noms_cache[selected_user]={active_nom_objs:[j[l]],winning_nom_objs:[]};if(!user_winning_noms_cache[selected_user].winning_nom_objs)user_winning_noms_cache[selected_user].winning_nom_objs=[]}active_user_nom_cache[selected_photo]={cat:j[l].nomination_category,
nom_id:j[l].id};$("#nominate_photo, #go_nom_detail").attr("id","go_nom_detail").attr("value",active_user_nom_cache[selected_photo].nom_id).text("Active")}render_share_nom(j,h)});typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Post Nom","Click",""]);$("#close_overlay").click()}});$("#close_nom_success").live("click",function(){if(mobile){$("#nom_complete_cont").hide();$(".nom_complete_cat_cont").remove();$("#nominate_photo, #go_nom_detail").show();$("#forward_gallery, #back_gallery").show()}else{$("#nom_complete_cont").fadeOut("fast",
function(){$(".nom_complete_cat_cont").remove()});$("#nominate_photo, #go_nom_detail").fadeIn("fast");$("#forward_gallery, #back_gallery").fadeIn("fast")}$("#new_nomination_cont li").removeClass("selected").addClass("unselected");$(".inactive").removeClass("inactive");$("#active_nominations #active_empty").is(":hidden")&&$("#active_nominations #active_empty").show();$("#active_nominations_cont").html("");$("#nomination_comment").text("Add a caption to this nomination.");$(".photo_thumbs").live("click",
photo_click_handler)});$(".photo_thumbs").live("click",photo_click_handler)}
function render_share_nom(a){var b="",c="",d="",e=c="";publish_story_html=d="";c=me.name.split(" ")[0];e=a[0].nominatee==me.id?c:friends[a[0].nominatee].name.split(" ")[0];for(var f=0;f<a.length;f++){b=a[f].nomination_category.replace(" ","_").toLowerCase();d+=f+1<a.length?a[f].nomination_category+", ":" and "+a[f].nomination_category}if(a.length==1){c=a[0].nominatee==me.id?"I nominated one of my photos for the "+a[0].nomination_category+" trophy":c+" nominated one of "+e+"'s photos for the "+a[0].nomination_category+
" trophy";d="http://portrit.s3.amazonaws.com/img/invite/"+b+".png"}else{c=a[0].nominatee==me.id?"I nominated one of my photos for the "+d+" trophies":c+" nominated one of "+e+"'s photos for the "+d+" trophies";d="http://portrit.s3.amazonaws.com/img/invite/blank.png"}b="http://portrit.com/#/nom_id="+a[0].id+"/ref=facebook";f=a[0].caption;if(f=="Add a caption to this nomination.")f="";var g="iframe";if(mobile&&!tablet)g="touch";FB.ui({method:"feed",display:g,to:a[0].nominatee,name:c,link:b,picture:d,
message:f,caption:"Click the trophy to see "+e+"'s nominated photo."},function(h){if(h&&h.post_id)typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Nom","Shared",""]);else typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Nom","Not Shared",""]);$("#nom_complete_cont").fadeIn()})}
function reset_nomination_overlay(){$("#new_nomination_cont li").removeClass("selected").addClass("unselected");$(".inactive").removeClass("inactive");$("#active_nominations #active_empty").is(":hidden")&&$("#active_nominations #active_empty").show();$("#active_nominations_cont").html("");$("#nomination_comment").text("Add a caption to this nomination.");$("#nom_complete_cont").hide();$("#nom_complete_cont .nom_complete_cat_cont").remove();$("#post_nomination").text("Post Nomination").removeClass("sick_hover_lock");
$("#tagged_users").hide();$("#tagged_users > div").html("")}
function append_wall_html(a){var b="",c="",d="",e="",f="";mobile||(f='<a class="sick red large" id="show_upload">Post Photo</a>');if(a=="recent"){b="latest_photos";c="active_nominations";d="Latest Photos";e="Active Nominations"}if($("#main_view_control").length==0){a='<div id="main_view_control"><a id="friend_view" class="main_control sick large">Friends</a><a id="wall_view" class="main_control sick large main_control_active">Stream</a><a id="profile_view" class="main_control sick large">Profile</a>'+f;
$("#cont").prepend(a)}b='<div id="profile_wrap"><div id="activate_recent_winners">Recent Winners</div><div id="activate_latest_photos">Latest Photos</div><ul><h1 id="active_stream_view" name="'+b+'">'+d+'</h1><div class="clear"></div><div id="drop_down_cont" style="display:none;"><li name="'+c+'" class="activate_stream"><h1>'+e+'</h1></li><div class="clear"></div></div></ul><div id="active_stream_text_cont" style="display:none;"><a id="top_noms" class="sick large">Top</a><a id="recent_noms" class="sick large">Most Recent</a></div><div class="clear"></div><div id="profile_cont_wrap"><div id="scroller"><div id="profile_cont"></div></div></div></div>';
$("#wall_cont").append(b);stream_view=="top_noms"?$("#top_noms").addClass("selected"):$("#recent_noms").addClass("selected")}
function clear_event_handles(){$(".img_thumbs").die("click");$(".img_thumbs").die("mousedown");$(".clear_profile").die("click");$(".photo_thumbs").die("click");$("#clear_db").die("click");$("#allow_notifications, #allow_portrit_album").die("click");$(".friend").die("click");$(".alpha_key_wall").die("click");$(".friend").die("mousedown");$(".profile_link").die("click");$(".photo_album").die("click");$("#load_more").die("click");$("#user_info_view").die("click");$("#user_photo_view").die("click");$("#user_wall_view").die("click");
$(".comment, .comment_self").die("mouseover");$(".comment, .comment_self").die("mouseout");$(".add_comment_peek").die("click");$(".cancel_comment").die("click");$(".comment_body").die("focus");$(".comment_body").die("blur");$(".load_more_comments").die("click");$(".hide_more_comments").die("click");$("#profile_cont_wrap").unbind("scroll");$(".photo_post a").die("click");$(".photo_post img").die("click");$(".vote_up").die("click");$(".vote_down").die("click");$(".nom_photo_thumbnail").die("click");
$("#profile_wrap  > ul > h1").die("mouseover mouseout");$("#activate_latest_photos").die("click");$("#activate_recent_winners").die("click");$(".voted_cont a, .new_photo_cont").die("mouseover mouseout");$(".new_photo_cont").die("click");$(".next_photo").die("click");$(".prev_photo").die("click");$("#close_upload, #cancel_upload").die("click");$("#show_upload").die("click");$(".kill_photo").die("click");$(".photo_caption").die("focus");$(".photo_caption").die("blur");$("#profile_nav_cont").die("click");
$(".add_new_comment").die("click");$(".comment_body").die("focus");$(".comment_body").die("blur");$(".cancel_new_comment").die("click");$(".post_new_comment").die("click");$("#user_friends img").die("mouseover mouseout");$("#post_upload").die("click");$(".winning_trophy_cont").die("mouseover mouseout");$(".trophy_album").die("click");$(".portrit_photo, #to_portrit_photos").die("click");$("#load_more_fb_albums").die("click");$("#hide_more_fb_albums").die("click");$(".nom_photo_thumbnail").die("click");
$("#add_new_comment").die("click");$(".photo_thumbs").die("mousedown");$(window).unbind("scroll");if(mobile){$("#back_gallery, #back_gallery_mobile").die("touchend");$("#forward_gallery, #forward_gallery_mobile").die("touchend")}else{$("#back_gallery, #back_gallery_mobile").die("click");$("#forward_gallery, #forward_gallery_mobile").die("click")}$(".like_photo").die("click");$("#photo_large_inline_cont").die("click");$("#nominate_photo").die("click");$("#go_nom_detail").die("click");$("#cancel_nom").die("click");
$("#inactive_trophy_cont li").die("click");$("#nom_caption").die("focus");$("#nom_caption").die("blur");$("#nom_caption").die("keydown");$("#post_nomination").die("click");$("#selected_noms > div").die("click");$("#close_nom_success").die("click");$("#selected_noms > div").die("mouseover mouseout");if(mobile){$("#selected_noms > div").die("touchstart");$(".img_thumbs").die("touchstart");$(".img_thumbs").die("touchend");document.body.removeEventListener("touchmove",onTouchMove);document.body.removeEventListener("touchend",
onTouchEnd);document.body.removeEventListener("touchstart",onTouchStart)}$(document).unbind("mouseup")}function push_scroll_pos(){var a=getScrollXY();scroll_pos_stack.push(a[1])}function pop_scroll_pos(){var a=scroll_pos_stack.pop();mobile?setTimeout(function(){$("html, body").scrollTop(a)},150):$("html, body").scrollTop(a)}
function clear_canvas(a){$("#wall_cont").html("");$("#canvas_cont").html("");$("#context_cont").html("");$("#friend_album_cont").html("");$(".photos_loading").remove();a.mobile_alpha||$("#main_view_control").remove();$("#profile_wrap").remove();if(clear_profile){$(window).unbind("scroll");$("#profile_cont").html("");$("#album_cont").html("");user_feed=user_profile=null;clear_profile=false}album_completed=added_swipe_once=comment_form_shown=false;initial_feed_load=true;user_feed=null;if(!mobile||view_active!=
"gallery"||view_active!="list")high_photo_offset=100;$("#photo_list").css({"padding-top":"0","margin-bottom":"0"});$("#photo_cont").css({"min-height":""});$("#friend_album_cont").css({height:"","min-height":"","max-width":""});$("#right_quick_nav").hide();$("#left_quick_nav").hide();$("#context_cont").hide();$("#new_nomination_wrap").hide();$("#title").hide();$("#title").html("");$("#top").hide();$("#login_loader").hide();if(a.gallery===undefined&&a.album===undefined||a.context!==undefined)$("#photo_cont").hide()}
var scroll_to_toggle=false,photo_load_wait=null,view_count=0;
function update_view(){var a=getUrlVars(),b=view_active;view_count+=1;$("#context_overlay").is(":visible")&&view_count>1&&$("#close_overlay").click();view_count==1&&render_notifications(notification_data);clear_event_handles();if(view_active=="main"||view_active=="list"){push_scroll_pos();scroll_to_toggle=true}if(a.user!==undefined&&a.album===undefined&&a.gallery===undefined&&a.trophy==undefined&&a.nom_id==undefined){clear_canvas(a);scroll_to_user=a.user;if(scroll_to_user==me.id){default_view="profile";
window.location.href="#/"}else main_photo_view();$("html, body").scrollTop(0)}else if(a.album!==undefined&&a.gallery===undefined){clear_canvas(a);selected_album_id=a.album;attach_list_handlers();$("#photo_cont").css({"max-width":""});selected_photo="";photo_list_view();if(scroll_to_toggle&&b=="gallery"){pop_scroll_pos();scroll_to_toggle=false;scroll_to_user=null}}else if(a.gallery!==undefined){clear_canvas(a);attach_gallery_handlers();$("#friend_album_cont").css({height:"","min-height":""});$("#photo_cont").css({"max-width":"1200px",
"min-height":"680px",margin:"0 auto"});$("#photo_large").css({"min-height":"400px"});selected_album_id=getUrlVars().album;if(a.album!=="video_album"){$("#photo_cont").show();if($("#photo_list").children().length===0){$("#friend_cont").hide();photo_list_view(true);view_active="gallery";$("#photo_cont").css("height","auto");var c="";selected_user=a.user;if(selected_user=="me")c="Your";else if(selected_user!==undefined&&selected_user!=""&&selected_user!=undefined)c=friends[selected_user].name.split(" ",
1)+"'s";$("#photo_list").append('<div id="album_link_loader"><h2>Loading '+c+' Albums...</h2><div id="loader"><img src="http://portrit.s3.amazonaws.com/img/album-loader-dark.gif"/></div></div>');clearInterval(photo_load_wait);photo_load_wait=setInterval(function(){if(album_completed||a.album=="tagged"){clearInterval(photo_load_wait);if(selected_photo=="")photo_id=selected_photo=$(".photo_thumbs:first > img").attr("id");c="";if(selected_user==me.id||selected_user=="me"){c="Your";selected_user=me.id}else c=
friends[selected_user].name.split(" ")[0]+"'s";$("#album_link_loader").remove();$("#title").hide();$("#right_quick_nav").show().find("#top_quick_nav").attr("href","#/user="+selected_user).text("To "+c+" profile \u2192");$("#right_quick_nav").show().find("#bottom_quick_nav").attr("href","#/user="+selected_user+"/album="+selected_album_id).text("To album");$(".photo_thumbs").show().css({opacity:"0.6",position:"absolute"});reset_nomination_overlay();photo_gallery_view()}},100)}else{c="";if(selected_user==
me.id||selected_user=="me"){c="Your";selected_user=me.id}else c=friends[selected_user].name.split(" ")[0]+"'s";if(selected_photo=="")photo_id=selected_photo=$(".photo_thumbs:first > img").attr("id");$(".photo_thumbs").css({position:"absolute"});$("#title").hide();$("#right_quick_nav").show().find("#top_quick_nav").attr("href","#/user="+selected_user).text("To "+c+" profile \u2192");$("#right_quick_nav").show().find("#bottom_quick_nav").attr("href","#/user="+selected_user+"/album="+selected_album_id).text("To album");
$(".photo_thumbs").css({opacity:"0.6"});reset_nomination_overlay();photo_gallery_view()}}else{$("#photo_cont").show();if($("#photo_list").children().length===0){$("#friend_cont").hide();photo_list_view();view_active="gallery";$("#photo_cont").css("height","auto")}if(selected_photo==="")photo_id=selected_photo=$(".photo_thumbs:first > img").attr("id");$(".photo_thumbs").css({position:"absolute"});$(".photo_thumbs").css({opacity:"0.6"});reset_nomination_overlay();video_gallery_view()}$("html, body").scrollTop(0)}else if(a.settings!==
undefined){clear_canvas(a);attach_settings_handlers();info_context_delagate("settings")}else if(a.context!==undefined){clear_canvas(a);info_context_delagate(a.context)}else if(a.upgrade!==undefined){clear_canvas(a);attach_upgrade_handlers();render_upgrade(a.upgrade)}else if(a.tour!==undefined){clear_canvas(a);render_tour()}else if(a.alpha!==undefined){clear_canvas(a);attach_alpha_handlers()}else if(a.alpha_key!==undefined){clear_canvas(a);attach_main_handlers();attach_profile_handlers();attach_mobile_alpha_handlers();
render_alpha_wall(a.alpha_key);$("html, body").scrollTop(0)}else if(a.won!==undefined&&a.nom_id!==undefined&&a.user!==undefined){clear_canvas(a);attach_nom_detail_handlers();typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","User Nom Won","Shown",""]);append_load($("#canvas_cont"),"dark");get_user_feed(nom_detail_view,"temp");$("html, body").scrollTop(0)}else if(a.won!==undefined&&a.nom_id!==undefined){clear_canvas(a);attach_nom_detail_handlers();typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent",
"Nom Won","Shown",""]);if(isEmpty(winners_feed)||winning_noms_cache[a.nom_id]==undefined){append_load($("#canvas_cont"),"dark");get_user_feed(nom_detail_view,"won")}else nom_detail_view();$("html, body").scrollTop(0)}else if(a.nom_id!==undefined){clear_canvas(a);attach_nom_detail_handlers();typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Nom Detail","Shown",""]);if(isEmpty(active_noms_cache)){append_load($("#canvas_cont"),"dark");get_user_feed(nom_detail_view,"user_stream")}else nom_detail_view();
$("html, body").scrollTop(0)}else if(a["recent-winners"]!=undefined){$("html, body").scrollTop(0);clear_canvas(a);attach_recent_winner_handlers();init_winners_view()}else if(a["latest-photos"]!=undefined){$("html, body").scrollTop(0);$("#profile_cont").html("");if(b=="gallery"||b==""){$("#photo_cont").html("").css({"min-height":""});$("#friend_cont").show();$("#active_stream_text_cont").hide();attach_main_handlers();attach_profile_handlers();append_wall_html("recent")}init_latest_photos()}else if(a.trophy!=
undefined){clear_canvas(a);attach_nom_detail_handlers();trophy_view(a.cat)}else if(default_view==="friend"){clear_canvas(a);attach_main_handlers();attach_profile_handlers();main_view();$("#friend_view").addClass("main_control_active");$("html, body").scrollTop(0)}else if(default_view==="wall"){b=="latest_photos"||b=="winners_view"?$("#profile_cont").html(""):clear_canvas(a);attach_main_handlers();attach_profile_handlers();main_view();$("#wall_view").addClass("main_control_active");$("html, body").scrollTop(0)}else if(default_view===
"profile"){clear_canvas(a);attach_main_handlers();attach_profile_handlers();main_view();$("#profile_view").addClass("main_control_active");$("html, body").scrollTop(0)}else{clear_canvas(a);attach_main_handlers();attach_profile_handlers();main_view();if(scroll_to_toggle){var d=null;if(scroll_to_user!=null&&b=="alpha"){b=$(window).height()/2-240;d=$(".friend[value="+scroll_to_user+"]");scroll_pos_stack.push($(d).position().top-b)}pop_scroll_pos(d);scroll_to_toggle=false}}}
function watch_hashtag(){var a=$(window.location).attr("hash");if(global_hash_tag!==a){global_hash_tag=a;setTimeout(update_view)}};